(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{597:function(s,a,t){"use strict";t.r(a);var n=t(22),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"jetlinks-开源物联网平台"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jetlinks-开源物联网平台"}},[s._v("#")]),s._v(" JetLinks 开源物联网平台")]),s._v(" "),t("p",[s._v("http://doc.jetlinks.cn/")]),s._v(" "),t("p",[s._v("JetLinks 基于Java8,Spring Boot 2.x,WebFlux,Netty,Vert.x,Reactor等开发, 是一个开源的企业级物联网基础开发平台，实现了物联网相关以及相关业务开发的众多基础功能, 能帮助你快速建立物联网相关业务系统。")]),s._v(" "),t("p",[s._v("点击添加官方QQ:①群(已满)"),t("a",{attrs:{href:"https://qm.qq.com/cgi-bin/qm/qr?k=LGf0OPQqvLGdJIZST3VTcypdVWhdfAOG&jump_from=webapi",target:"_blank",rel:"noopener noreferrer"}},[s._v("2021514 (opens new window)"),t("OutboundLink")],1),s._v(",②群"),t("a",{attrs:{href:"https://qm.qq.com/cgi-bin/qm/qr?k=IMas2cH-TNsYxUcY8lRbsXqPnA2sGHYQ&jump_from=webapi",target:"_blank",rel:"noopener noreferrer"}},[s._v("324606263(opens new window)"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("在线演示地址: "),t("a",{attrs:{href:"http://demo.jetlinks.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://demo.jetlinks.cn (opens new window)"),t("OutboundLink")],1),s._v("用户名:"),t("code",[s._v("test")]),s._v(" 密码: "),t("code",[s._v("test123456")]),s._v(". 测试用户未开放全部权限,建议本地运行社区版体验或者联系商务试用企业版.")]),s._v(" "),t("h2",{attrs:{id:"核心特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#核心特性"}},[s._v("#")]),s._v(" 核心特性")]),s._v(" "),t("p",[t("strong",[s._v("开放源代码")])]),s._v(" "),t("p",[s._v("全部源代码开放,可自由拓展功能,不再受制于人.前后端分离,接口全开放.")]),s._v(" "),t("p",[t("strong",[s._v("统一设备接入,海量设备管理")])]),s._v(" "),t("p",[s._v("TCP/UDP/MQTT/HTTP、TLS/DTLS、不同厂商、不同设备、不同报文、统一接入，统一管理.")]),s._v(" "),t("p",[t("strong",[s._v("规则引擎")])]),s._v(" "),t("p",[s._v("灵活的规则模型配置,支持多种规则模型以及"),t("a",{attrs:{href:"http://doc.jetlinks.cn/dev-guide/rule-engine.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("自定义规则模型"),t("OutboundLink")],1),s._v(". 设备告警,场景联动,均由统一的规则引擎管理.")]),s._v(" "),t("p",[s._v("强大的可视化规则设计器. "),t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52a2e42334.png",alt:"rule-engine.png"}})]),s._v(" "),t("p",[s._v("说明")]),s._v(" "),t("p",[s._v("可视化规则设计器基于node-red,后端使用纯java实现.")]),s._v(" "),t("p",[t("strong",[s._v("数据权限控制")])]),s._v(" "),t("p",[s._v("灵活的非侵入"),t("a",{attrs:{href:"http://doc.jetlinks.cn/dev-guide/assets.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据权限控制"),t("OutboundLink")],1),s._v("。可实现不同机构,不同用户共享数据。 可控制单条数据的操作权限。支持自定义维度(公司,部门...)")]),s._v(" "),t("p",[t("strong",[s._v("多种数据存储策略")])]),s._v(" "),t("p",[s._v("支持灵活的设备"),t("a",{attrs:{href:"http://doc.jetlinks.cn/best-practices/start.html#%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据存储策略"),t("OutboundLink")],1),s._v("，可将不同类型的设备数据存储到不同的地方。")]),s._v(" "),t("h2",{attrs:{id:"技术栈"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#技术栈"}},[s._v("#")]),s._v(" 技术栈")]),s._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://spring.io/projects/spring-boot",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spring Boot 2.3.x(opens new window)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://spring.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spring WebFlux (opens new window)"),t("OutboundLink")],1),s._v("响应式Web支持")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://r2dbc.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("R2DBC (opens new window)"),t("OutboundLink")],1),s._v("响应式关系型数据库驱动")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://projectreactor.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Project Reactor (opens new window)"),t("OutboundLink")],1),s._v("响应式编程框架")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://netty.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Netty (opens new window)"),t("OutboundLink")],1),s._v(","),t("a",{attrs:{href:"https://vertx.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vert.x (opens new window)"),t("OutboundLink")],1),s._v("高性能网络编程框架")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.elastic.co/cn/products/enterprise-search",target:"_blank",rel:"noopener noreferrer"}},[s._v("ElasticSearch (opens new window)"),t("OutboundLink")],1),s._v("全文检索，日志，时序数据存储")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis (opens new window)"),t("OutboundLink")],1),s._v("Redis,设备配置,状态管理,缓存.")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.postgresql.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PostgreSQL (opens new window)"),t("OutboundLink")],1),s._v("业务功能数据管理")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/hs-web",target:"_blank",rel:"noopener noreferrer"}},[s._v("hsweb framework 4 (opens new window)"),t("OutboundLink")],1),s._v("业务功能基础框架")])]),s._v(" "),t("h2",{attrs:{id:"架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[s._v("#")]),s._v(" 架构")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52abeeb50e.png",alt:"image-20220624110846011"}})]),s._v(" "),t("h2",{attrs:{id:"设备接入流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设备接入流程"}},[s._v("#")]),s._v(" 设备接入流程")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52ad156dcc.png",alt:"image-20220624110904433"}})]),s._v(" "),t("p",[s._v("使用Docker快速启动")]),s._v(" "),t("h2",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("p",[s._v("根据不同操作系统选择安装docker-ce或者Docker Desktop。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://hub.docker.com/editions/community/docker-ce-desktop-mac",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mac(opens new window)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://hub.docker.com/search?q=&type=edition&offering=community&sort=updated_at&order=desc&operating_system=linux",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux(opens new window)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://hub.docker.com/editions/community/docker-ce-desktop-windows",target:"_blank",rel:"noopener noreferrer"}},[s._v("Windows(opens new window)"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"获取源代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取源代码"}},[s._v("#")]),s._v(" 获取源代码")]),s._v(" "),t("p",[s._v("jetlinks源代码托管在"),t("a",{attrs:{href:"https://github.com/jetlinks/jetlinks-community",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub (opens new window)"),t("OutboundLink")],1),s._v("和"),t("a",{attrs:{href:"https://gitee.com/jetlinks/jetlinks-community",target:"_blank",rel:"noopener noreferrer"}},[s._v("gitee (opens new window)"),t("OutboundLink")],1),s._v("，可直接前往克隆或者下载。")]),s._v(" "),t("p",[s._v("建议使用git clone。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/jetlinks/jetlinks-community.git "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" jetlinks-community\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://doc.jetlinks.cn/install-deployment/docker-start.html#%E8%8E%B7%E5%8F%96%E6%BA%90%E4%BB%A3%E7%A0%81",target:"_blank",rel:"noopener noreferrer"}},[s._v("获取源代码"),t("OutboundLink")],1),s._v("成功后，进入docker/run-all目录。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docker/run-all\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("docker-compose中的jetlinks、jetlinks-ui-antd镜像持续更新中，启动docker之前请及时下载更新。")]),s._v(" "),t("h2",{attrs:{id:"启动成功后访问系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动成功后访问系统"}},[s._v("#")]),s._v(" 启动成功后访问系统")]),s._v(" "),t("p",[s._v("地址: "),t("code",[s._v("http://localhost:9000")]),s._v(", 用户名:"),t("code",[s._v("admin")]),s._v(",密码:"),t("code",[s._v("admin")]),s._v("。")]),s._v(" "),t("h1",{attrs:{id:"部署到服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署到服务器"}},[s._v("#")]),s._v(" 部署到服务器")]),s._v(" "),t("h2",{attrs:{id:"前端部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前端部署"}},[s._v("#")]),s._v(" 前端部署")]),s._v(" "),t("p",[s._v("环境要求")]),s._v(" "),t("ul",[t("li",[s._v("nodeJs v12.xx")]),s._v(" "),t("li",[s._v("npm v6.xx")])]),s._v(" "),t("ol",[t("li",[s._v("获取源代码")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/jetlinks/jetlinks-ui-antd.git\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("使用npm打包,并将打包后的文件复制到项目的docker目录下（命令在项目根目录下执行）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run-script build \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r dist docker/       \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"使用docker部署前端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用docker部署前端"}},[s._v("#")]),s._v(" 使用docker部署前端")]),s._v(" "),t("ol",[t("li",[s._v("构建docker镜像")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -t registry.cn-shenzhen.aliyuncs.com/jetlinks/jetlinks-ui-antd:1.10.0 ./docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("运行docker镜像")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --rm -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v(":80 -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"API_BASE_PATH=http://xxx:8848/"')]),s._v(" registry.cn-shenzhen.aliyuncs.com/jetlinks/jetlinks-ui-antd:1.10.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意")]),s._v(" "),t("p",[s._v("环境变量"),t("code",[s._v("API_BASE_PATH")]),s._v("为后台API根地址. 由docker容器内进行自动代理. 请根据自己的系统环境配置环境变量: "),t("code",[s._v("API_BASE_PATH")])]),s._v(" "),t("h3",{attrs:{id:"使用nginx部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用nginx部署"}},[s._v("#")]),s._v(" 使用nginx部署")]),s._v(" "),t("ol",[t("li",[s._v("复制"),t("code",[s._v("dist")]),s._v("目录下到文件到"),t("code",[s._v("/usr/share/nginx/html")])]),s._v(" "),t("li",[s._v("添加nginx配置文件")])]),s._v(" "),t("p",[s._v("nginx配置参考：")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('server {\n    listen 80;\n    # gzip config\n    gzip on;\n    gzip_min_length 1k;\n    gzip_comp_level 9;\n    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;\n    gzip_vary on;\n    gzip_disable "MSIE [1-6]\\.";\n\n    root /usr/share/nginx/html;\n    include /etc/nginx/mime.types;\n    location / {\n        index  index.html;\n    }\n\n    location ^~/jetlinks/ {\n        proxy_pass http://jetlinks:8848/; #修改此地址为后台服务地址\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header Host $host:$server_port;\n        proxy_set_header X-Real-IP  $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n        proxy_connect_timeout   1;\n        proxy_buffering off;\n        chunked_transfer_encoding off;\n        proxy_cache off;\n        proxy_send_timeout      30m;\n        proxy_read_timeout      30m;\n        client_max_body_size    100m;\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h2",{attrs:{id:"后端部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后端部署"}},[s._v("#")]),s._v(" 后端部署")]),s._v(" "),t("h3",{attrs:{id:"使用docker部署后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用docker部署后端"}},[s._v("#")]),s._v(" 使用docker部署后端")]),s._v(" "),t("ol",[t("li",[s._v("使用maven命令将项目打包\n在代码根目录执行：")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mvn clean package -Dmaven.test.skip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("使用docker构建镜像")])]),s._v(" "),t("p",[s._v("注意")]),s._v(" "),t("p",[s._v("请自行准备docker镜像仓库，此处以registry.cn-shenzhen.aliyuncs.com阿里云私有仓库为例。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ./jetlinks-standalone\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -t registry.cn-shenzhen.aliyuncs.com/jetlinks/jetlinks-standalone:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",[t("li",[s._v("推送镜像")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push registry.cn-shenzhen.aliyuncs.com/jetlinks/jetlinks-standalone:latest\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("创建docker-compose文件")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\nservices:\n  redis:\n    image: redis:5.0.4\n    container_name: jetlinks-ce-redis\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ports:")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "6379:6379"')]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-volume:/data"')]),s._v("\n    command: redis-server --appendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --requirepass "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redispassword"')]),s._v("\n    environment:\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TZ")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Asia/Shanghai\n  elasticsearch:\n    image: elasticsearch:6.8.11\n    container_name: jetlinks-ce-elasticsearch\n    environment:\n      ES_JAVA_OPTS: -Djava.net.preferIPv4Stack"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -Xms1g -Xmx1g\n      transport.host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n      discovery.type: single-node\n      bootstrap.memory_lock: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n      discovery.zen.minimum_master_nodes: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      discovery.zen.ping.unicast.hosts: elasticsearch\n    volumes:\n      - elasticsearch-volume:/usr/share/elasticsearch/data\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ports:")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "9200:9200"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "9300:9300"')]),s._v("\n  kibana:\n    image: kibana:6.8.11\n    container_name: jetlinks-ce-kibana\n    environment:\n      ELASTICSEARCH_URL: http://elasticsearch:9200\n    links:\n      - elasticsearch:elasticsearch\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5602:5601"')]),s._v("\n    depends_on:\n      - elasticsearch\n  postgres:\n    image: postgres:11-alpine\n    container_name: jetlinks-ce-postgres\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"postgres-volume:/var/lib/postgresql/data"')]),s._v("\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5432:5432"')]),s._v("\n    environment:\n      POSTGRES_PASSWORD: jetlinks\n      POSTGRES_DB: jetlinks\n      TZ: Asia/Shanghai\n  ui:\n    image: registry.cn-shenzhen.aliyuncs.com/jetlinks/jetlinks-ui-antd:latest\n    container_name: jetlinks-ce-ui\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v(":80\n    environment:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"API_BASE_PATH=http://jetlinks:8848/"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#API根路径")]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jetlinks-volume:/usr/share/nginx/html/upload"')]),s._v("\n    links:\n      - jetlinks:jetlinks\n  jetlinks:\n    image: registry.cn-shenzhen.aliyuncs.com/jetlinks/jetlinks-standalone:latest\n    container_name: jetlinks-ce\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v(":8848 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# API端口")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1883")]),s._v("-1890:1883-1890 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 预留")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("-8010:8000-8010 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 预留")]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jetlinks-volume:/application/static/upload"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 持久化上传的文件")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jetlinks-protocol-volume:/application/data/protocols"')]),s._v("\n    environment:\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "JAVA_OPTS=-Xms4g -Xmx18g -XX:+UseG1GC"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TZ=Asia/Shanghai"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hsweb.file.upload.static-location=http://127.0.0.1:8848/upload"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传的静态文件访问根地址,为ui的地址.")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.r2dbc.url=r2dbc:postgresql://postgres:5432/jetlinks"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库连接地址")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.r2dbc.username=postgres"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.r2dbc.password=jetlinks"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.redis.host=redis"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.redis.port=6379"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.redis.password=redispassword"')]),s._v("#生产环境请配置redis密码\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生产环境下请配置es的密码，或者关闭公网访问")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring.data.elasticsearch.client.reactive.endpoints=elasticsearch:9200"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "spring.data.elasticsearch.client.reactive.username=admin"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "spring.data.elasticsearch.client.reactive.password=admin" ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "spring.reactor.debug-agent.enabled=false" #设置为false能提升性能')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "jetlinks.device.storage.enable-last-data-in-db=true" # 开启记录最新数据到数据库，但是会降低吞吐量')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logging.level.io.r2dbc=warn"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logging.level.org.springframework.data=warn"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logging.level.org.springframework=warn"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logging.level.org.jetlinks=warn"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logging.level.org.hswebframework=warn"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logging.level.org.springframework.data.r2dbc.connectionfactory=warn"')]),s._v("\n    links:\n      - redis:redis\n      - postgres:postgres\n      - elasticsearch:elasticsearch\n    depends_on:\n      - postgres\n      - redis\n      - elasticsearch\nvolumes:\n  postgres-volume:\n  redis-volume:\n  elasticsearch-volume:\n  jetlinks-volume:\n  jetlinks-protocol-volume:\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("jetlinks docker镜像版本更新和源代码根目录下文件pom.xml中的版本号同步。")]),s._v(" "),t("p",[s._v("6.运行docker-compose文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"jar包方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jar包方式"}},[s._v("#")]),s._v(" jar包方式")]),s._v(" "),t("p",[s._v("1.使用maven命令将项目打包，在代码根目录执行：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./mvnw clean package -Dmaven.test.skip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2.将jar包上传到需要部署的服务器上。")]),s._v(" "),t("p",[s._v("jar包文件地址: "),t("code",[s._v("jetlinks-standalone/target/jetlinks-standalone.jar")])]),s._v(" "),t("p",[s._v("3.使用java命令运行jar包")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ java -jar jetlinks-standalone.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意")]),s._v(" "),t("p",[s._v("请根据情况调整jvm参数等信息.")]),s._v(" "),t("h1",{attrs:{id:"集群部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群部署"}},[s._v("#")]),s._v(" 集群部署")]),s._v(" "),t("p",[s._v("jetlinks以及所需中间件的集群部署")]),s._v(" "),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("仅企业版以上支持。\n本文档以172.16.4.13、172.16.4.12、172.16.4.11三台服务器来搭建集群。")]),s._v(" "),t("h2",{attrs:{id:"集群架构图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群架构图"}},[s._v("#")]),s._v(" 集群架构图")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52b1047cb5.png",alt:"image-20220624111007351"}})]),s._v(" "),t("h2",{attrs:{id:"redis集群安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis集群安装配置"}},[s._v("#")]),s._v(" redis集群安装配置")]),s._v(" "),t("p",[s._v("这里准备在一台服务器上搭建一个三主三从的redis集群。")]),s._v(" "),t("ol",[t("li",[s._v("安装redis 先"),t("a",{attrs:{href:"http://download.redis.io/releases/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载redis (opens new window)"),t("OutboundLink")],1),s._v(",本文档以redis5.0.5为例。\n下载完成后进行解压、编译、安装。")])]),s._v(" "),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("redis是由C语言编写的，它的运行需要C环境，所以编译前需安装 gcc。")]),s._v(" "),t("ol",[t("li",[s._v("新建一个cluster文件夹，用来存放集群节点目录。\n分别在172.16.4.11上创建7000、7003、7001、7004、7002、7005六文件夹，，这些节点分别使用7000、7003、7001、7004、7002、7005端口，以7000节点为例配置如下：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes_7000.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\nappendonly no\ndaemonize  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("其他节点只需修改端口和文件名，依次按此进行配置即可，配置完成后启动节点。")]),s._v(" "),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("建议appendonly在从节点开启，主节点关闭。")]),s._v(" "),t("ol",[t("li",[s._v("主从节点分配")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli --cluster create "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7000 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7001 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7002 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7003 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7004 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7005 --cluster -replicas "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("其中-replicas 1表示每个主节点1个从节点")]),s._v(" "),t("ol",[t("li",[s._v("查看集群节点信息")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ops@jetlinks-server-3:~/data/redis-5.0.5$ redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11  -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(" cluster nodes\n562558e5afa0575d1059c47b9531a37cd75a9190 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7003@17003 slave 9174a3ebcdbda174ec9189fbae0e38d9bbeeff5f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1594368796612")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" connected\nbd974dbdd2f8447b27375c832c4c9c99328f4487 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7005@17005 slave 3ab893f4cdcfaa52254a8cece2b54b561de29990 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1594368797514")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" connected\n9174a3ebcdbda174ec9189fbae0e38d9bbeeff5f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7002@17002 master - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1594368797615")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383\n3ab893f4cdcfaa52254a8cece2b54b561de29990 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7001@17001 master - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1594368797000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" connected "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922\n238585a079196b0ab15ebb47ac681d42c083cdaf "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7000@17000 myself,master - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1594368796000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" connected "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460\nd1ae6c623694c5f1fafc64d7abbeac4a9926ff49 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11:7004@17004 slave 238585a079196b0ab15ebb47ac681d42c083cdaf "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1594368796000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" connected\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("redis集群搭建请参考"),t("a",{attrs:{href:"https://redis.io/topics/cluster-tutorial",target:"_blank",rel:"noopener noreferrer"}},[s._v("redis官方文档(opens new window)"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"elasticsearch集群安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch集群安装配置"}},[s._v("#")]),s._v(" elasticsearch集群安装配置")]),s._v(" "),t("ol",[t("li",[s._v("分别在三台服务器上安装elasticsearch 前往官网"),t("a",{attrs:{href:"https://www.elastic.co/cn/downloads/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载 (opens new window)"),t("OutboundLink")],1),s._v("。\n下载完成后安装es。")]),s._v(" "),t("li",[s._v("配置elasticsearch.yml文件")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ops@jetlinks-server-3:~/elasticsearch/config$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" elasticsearch.yml \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ======================== Elasticsearch Configuration =========================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NOTE: Elasticsearch comes with reasonable defaults for most settings.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       Before you set out to tweak and tune the configuration, make sure you")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       understand what are you trying to accomplish and the consequences.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The primary way of configuring a node is via this file. This template lists")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the most important settings you may want to configure for a production cluster.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please consult the documentation for further information on configuration options:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://www.elastic.co/guide/en/elasticsearch/reference/index.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---------------------------------- Cluster -----------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a descriptive name for your cluster:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\ncluster.name: es-cluster\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------------------ Node ------------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a descriptive name for the node:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nnode.name: node-3\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add custom attributes to the node:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#node.attr.rack: r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ----------------------------------- Paths ------------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Path to directory where to store the data (separate multiple locations by comma):")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#path.data: /path/to/data")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Path to log files:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#path.logs: /path/to/logs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ----------------------------------- Memory -----------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Lock the memory on startup:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bootstrap.memory_lock: true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Make sure that the heap size is set to about half the memory available")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# on the system and that the owner of the process is allowed to use this")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limit.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Elasticsearch performs poorly when the system is swapping the memory.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---------------------------------- Network -----------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the bind address to a specific IP (IPv4 or IPv6):")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nnetwork.host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".4.11\n\ntransport.tcp.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set a custom port for HTTP:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nhttp.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For more information, consult the network module documentation.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --------------------------------- Discovery ----------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pass an initial list of hosts to perform discovery when new node is started:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# The default list of hosts is ["127.0.0.1", "[::1]"]')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\ndiscovery.zen.ping.unicast.hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.4.13:9300"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.4.12:19300"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.4.11:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Prevent the "split brain" by configuring the majority of nodes (total number of master-eligible nodes / 2 + 1):')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\ndiscovery.zen.minimum_master_nodes: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For more information, consult the zen discovery module documentation.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---------------------------------- Gateway -----------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Block initial recovery after a full cluster restart until N nodes are started:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gateway.recover_after_nodes: 3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For more information, consult the gateway module documentation.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---------------------------------- Various -----------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Require explicit names when deleting indices:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#action.destructive_requires_name: true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br")])]),t("p",[s._v("三台服务器不同的配置：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#172.16.4.11")]),s._v("\nnode.name: node-3  \nnetwork.host:172.16.4.11    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#172.16.4.12")]),s._v("\nnode.name: node-2  \nnetwork.host:172.16.4.12 \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#172.16.4.13")]),s._v("\nnode.name: node-1  \nnetwork.host:172.16.4.13 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("3 在三台服务器上分别启动es")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/elasticsearch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"数据库启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库启动"}},[s._v("#")]),s._v(" 数据库启动")]),s._v(" "),t("p",[s._v("本文档案例使用docker启动postgresql，可参考"),t("a",{attrs:{href:"https://github.com/jetlinks/jetlinks-community/blob/master/docker/run-all/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-compose.yml (opens new window)"),t("OutboundLink")],1),s._v("文件中的postgresql配置。")]),s._v(" "),t("h2",{attrs:{id:"jetlinks集群安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jetlinks集群安装配置"}},[s._v("#")]),s._v(" jetlinks集群安装配置")]),s._v(" "),t("p",[s._v("1.修改application.yml,并将jetlinks打成jar包")]),s._v(" "),t("p",[s._v("application.yml文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8844")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-http-header-size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 64KB\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("profiles")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("active")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jetlinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("platform\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jackson")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("date-format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yyyy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("MM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dd HH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ss\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("time-zone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Asia/Shanghai\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serialization")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("WRITE_DATES_AS_TIMESTAMPS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default-property-inclusion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" non_null\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static-locations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("./static"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/META"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("INF/resources/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/resources/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/static/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/public/\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("   \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis集群配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-redirects")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lettuce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-active")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 20s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jdk "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置fst时,redis key使用string序列化,value使用 fst序列化.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("r2dbc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" r2dbc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("postgresql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//172.16.4.12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5432/jetlinks    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库地址 本文档数据库为docker启动")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jetlinks\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("codec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-in-memory-size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 50MB\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启了device.message.writer.rabbitmq.enabled=true时生效")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" admin\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jetlinks\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启了device.message.writer.kafka.enabled=true时生效")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("consumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("server.port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-poll-records")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("producer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("producer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("server.port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("acks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bootstrap-servers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:9092"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reactor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug-agent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启调试代理,在打印异常时将会生成调用踪栈信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reactive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//172.16.4.13"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//172.16.4.12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19200")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//172.16.4.11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-in-memory-size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100MB\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("socket-timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10s\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("connection-timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("easyorm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default-schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" public "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库默认的schema")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dialect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库方言")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default-strategy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("by"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("month "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认es的索引按月进行分表")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("settings")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number-of-shards")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# es 分片数量")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number-of-replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 副本数量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("device")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("writer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("time-series")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接写出设备消息数据到时序数据库")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送设备消息到kafka")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("consumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从kafka订阅消息并写入到时序数据库")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("topic-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" device.message\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送设备消息到rabbitMQ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("consumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从rabbitMQ订阅消息并写入到时序数据库")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thread-size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 消费线程数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auto-ack")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定应答,为true可能导致数据丢失,但是性能最高。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("topic-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" device.message  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exchange名称")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ignore-message-types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include-message-types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hsweb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /"),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowed-headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowed-methods")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PUT"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PATCH"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DELETE"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPTIONS"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowed-origins")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allow-credentials")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-age")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1800")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enum-packages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" org.jetlinks\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("upload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static-file-path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./static/upload\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static-location")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//demo2.jetlinks.org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080/upload   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此地址为服务器域名，将通过nginx代理到固定服务器上")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("webflux")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("response-wrapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" enabled "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启响应包装器(将返回值包装为ResponseMessage)")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  auth:   #默认的用户配置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    users:")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      admin:")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        username: admin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        password: admin")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        name: 超级管理员")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auto-parse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("local-cache-type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" guava\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jetlinks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("server.port"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设备服务网关服务ID,不同服务请设置不同的ID")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("logging")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("system")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为true时开启自动加载通过依赖引入的协议包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("engine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jetlinks.server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("logging")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.jetlinks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" info\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule.engine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" info\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.hswebframework")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" debug\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.springframework.transaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" debug\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.springframework.data.r2dbc.connectionfactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" debug\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("io.micrometer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.hswebframework.expands")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" error\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("system")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.jetlinks.rule.engine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" info\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.jetlinks.gateway")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" info\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.springframework")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.apache.kafka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("org.jetlinks.pro.device.message.writer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" debug\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    org.elasticsearch: error")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("logback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring.xml\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vertx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-event-loop-execute-time-unit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" seconds\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-event-loop-execute-time")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-worker-execute-time-unit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" seconds\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-worker-execute-time")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefer-native-transport")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("micrometer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("time-series")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.application.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("step")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br"),t("span",{staticClass:"line-number"},[s._v("140")]),t("br"),t("span",{staticClass:"line-number"},[s._v("141")]),t("br"),t("span",{staticClass:"line-number"},[s._v("142")]),t("br"),t("span",{staticClass:"line-number"},[s._v("143")]),t("br"),t("span",{staticClass:"line-number"},[s._v("144")]),t("br"),t("span",{staticClass:"line-number"},[s._v("145")]),t("br"),t("span",{staticClass:"line-number"},[s._v("146")]),t("br"),t("span",{staticClass:"line-number"},[s._v("147")]),t("br"),t("span",{staticClass:"line-number"},[s._v("148")]),t("br"),t("span",{staticClass:"line-number"},[s._v("149")]),t("br"),t("span",{staticClass:"line-number"},[s._v("150")]),t("br"),t("span",{staticClass:"line-number"},[s._v("151")]),t("br"),t("span",{staticClass:"line-number"},[s._v("152")]),t("br"),t("span",{staticClass:"line-number"},[s._v("153")]),t("br"),t("span",{staticClass:"line-number"},[s._v("154")]),t("br"),t("span",{staticClass:"line-number"},[s._v("155")]),t("br"),t("span",{staticClass:"line-number"},[s._v("156")]),t("br"),t("span",{staticClass:"line-number"},[s._v("157")]),t("br"),t("span",{staticClass:"line-number"},[s._v("158")]),t("br"),t("span",{staticClass:"line-number"},[s._v("159")]),t("br"),t("span",{staticClass:"line-number"},[s._v("160")]),t("br"),t("span",{staticClass:"line-number"},[s._v("161")]),t("br"),t("span",{staticClass:"line-number"},[s._v("162")]),t("br"),t("span",{staticClass:"line-number"},[s._v("163")]),t("br"),t("span",{staticClass:"line-number"},[s._v("164")]),t("br"),t("span",{staticClass:"line-number"},[s._v("165")]),t("br"),t("span",{staticClass:"line-number"},[s._v("166")]),t("br"),t("span",{staticClass:"line-number"},[s._v("167")]),t("br"),t("span",{staticClass:"line-number"},[s._v("168")]),t("br"),t("span",{staticClass:"line-number"},[s._v("169")]),t("br"),t("span",{staticClass:"line-number"},[s._v("170")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("在多台服务器上启动jetlinks，配置中的jetlinks.server-id必须互不相同。")]),s._v(" "),t("p",[s._v("在项目根目录执行：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mvn clean package -DskipTests\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("分别在三台服务器上启动jetlinks 文档以脚本方式启动，脚本如下：")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" java -jar -Dspring.application.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jetlinks-cluster-test-3   jetlinks-standalone.jar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jetlinks-pro.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("三台服务启动的jetlinks.server-id应该互不相同，在application.yml中jetlinks.server-id引用了spring.application.name，所以此处的name应不相同。")]),s._v(" "),t("h2",{attrs:{id:"nginx配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[s._v("#")]),s._v(" nginx配置")]),s._v(" "),t("p",[s._v("通过nginx来代理前后端。")]),s._v(" "),t("ol",[t("li",[s._v("安装nginx\n前往官网"),t("a",{attrs:{href:"https://nginx.org/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载 (opens new window)"),t("OutboundLink")],1),s._v("下载完成后解压、编译、安装。")]),s._v(" "),t("li",[s._v("修改配置文件")])]),s._v(" "),t("p",[s._v("配置文件如下：")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('upstream iotserver {\n  server 172.16.4.11:8844;\n  server 172.16.4.12:8844;\n  server 172.16.4.13:8844;\n}\n\nupstream webserver {\n  server 172.16.4.11:9000;\n}\n\nupstream fileserver {\n  server 172.16.4.11:8844; #此处指定文件上传到该服务器上\n}\n\nserver {\n\n  listen       8080;\n  server_name  demo2.jetlinks.cn;\n\n  location ^~/upload/ {\n    proxy_pass http://fileserver;\n    proxy_set_header Host $host:$server_port;\n    proxy_set_header X-Real-IP  $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n  location ^~/jetlinks/file/static {\n    proxy_pass http://fileserver/file/static;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header Host $host:$server_port;\n    proxy_set_header X-Real-IP  $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_send_timeout      30m;\n    proxy_read_timeout      30m;\n    client_max_body_size    100m;\n  }\n\n  location ^~/jetlinks/ {\n    proxy_pass http://iotserver/;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header Host $host:$server_port;\n    proxy_set_header X-Real-IP  $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n    proxy_connect_timeout   1;\n    proxy_buffering off;\n    chunked_transfer_encoding off;\n    proxy_cache off;\n    proxy_send_timeout      30m;\n    proxy_read_timeout      30m;\n    client_max_body_size    100m;\n  }\n\n  location / {\n    proxy_pass http://webserver/;\n  }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br")])]),t("ol",[t("li",[s._v("启动")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl status nginx.service\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"tcp负载均衡配置方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp负载均衡配置方式"}},[s._v("#")]),s._v(" tcp负载均衡配置方式")]),s._v(" "),t("p",[s._v("用于代理设备连接。此处使用nginx作为演示,也可以使用LVS,haProxy等方式。")]),s._v(" "),t("p",[s._v("配置文件：")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("load_module /usr/lib/nginx/modules/ngx_stream_module.so;\nuser  root;\nworker_processes  1;\n\nerror_log  /etc/nginx/log/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\nstream {\n   \n   upstream tcp-test {\n       hash $remote_addr consistent;\n       server 172.16.4.13:1889 max_fails=3 fail_timeout=10s;\n       #server 172.16.4.12:1889 max_fails=3 fail_timeout=10s;\n       server 172.16.4.11:1889 max_fails=3 fail_timeout=10s;\n   }\n\n   server {\n     \n       listen 1884;\n     \n       proxy_pass tcp-test;\n  \n       proxy_connect_timeout 30s;\n  \n       proxy_timeout 30s;\n   }\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("此配置监听的MQTT的1884端口，代理到服务器上的1889。如需代理自定义端口需保持代理端口与jetlinks平台中网络组件开启的端口一致。 如此处平台中MQTT服务网络组件设置的端口应为1889。")]),s._v(" "),t("h1",{attrs:{id:"启动大屏"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动大屏"}},[s._v("#")]),s._v(" 启动大屏")]),s._v(" "),t("p",[s._v("jetlinks的可视化数据大屏的前端是独立的，启动完jetlinks的平台前端和后端服务，如果你需要使用大屏可视化，还需要启动大屏前端。")]),s._v(" "),t("p",[s._v("注意")]),s._v(" "),t("p",[s._v("可视化数据大屏设计器基于"),t("a",{attrs:{href:"https://www.avuejs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Avue (opens new window)"),t("OutboundLink")],1),s._v("二次开发,暂未免费开源 (企业版中提供)")]),s._v(" "),t("h2",{attrs:{id:"本地启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地启动"}},[s._v("#")]),s._v(" 本地启动")]),s._v(" "),t("p",[s._v("下载大屏前端代码：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/jetlinks/jetlinks-big-screen.git\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" jetlinks-big-screen\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("修改后台接口地址：进入vue.config.js，修改后端请求地址")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"/jetlinks"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("target")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://demo.jetlinks.cn/jetlinks"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 你的后端地址")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("changeOrigin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("ws")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ws://demo.jetlinks.cn/jetlinks"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 你的后端websocket地址")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("pathRewrite")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'^/jetlinks'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("启动：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" jetlinks-big-screen\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run serve \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"docker启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker启动"}},[s._v("#")]),s._v(" docker启动")]),s._v(" "),t("p",[s._v("可通过docker镜像启动大屏，执行性如下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"API_BASE_PATH=http://host.docker.internal:8844/"')]),s._v(" --name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("big-screen -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9002")]),s._v(":80 registry.cn-shenzhen.aliyuncs.com/jetlinks-pro/jetlinks-big-screen:1.0.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或者在docker-compose.yml中加入如下配置：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("big-screen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry.cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("shenzhen.aliyuncs.com/jetlinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pro/jetlinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("screen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.0.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("screen\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9002"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"API_BASE_PATH=http://192.168.3.25:8844/"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#API根路径")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("API_BASE_PATH为jetlinks服务地址。")]),s._v(" "),t("h2",{attrs:{id:"jetlinks配置修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jetlinks配置修改"}},[s._v("#")]),s._v(" jetlinks配置修改")]),s._v(" "),t("p",[s._v("在jetlinks中修改大屏跳转地址： jetlinks-pro/jetlinks-standalone/src/main/resources/application.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("urls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("big-screen-path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("9002/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#localhost根据大屏实际部署地址修改")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("创建大屏权限：进入平台，系统设置=>权限管理=>新建")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52b23a3747.png",alt:"创建权限"}})]),s._v(" "),t("p",[s._v("赋权：进入平台，系统设置=>用户管理=>赋权，给用户赋权：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52b23e26fe.png",alt:"image-20201123170823171"}})]),s._v(" "),t("p",[s._v("然后通过平台的大屏管理进入大屏：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52b2432d75.png",alt:"image-20201123151335501"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);