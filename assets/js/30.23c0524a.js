(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{525:function(s,t,a){"use strict";a.r(t);var n=a(22),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h5",{attrs:{id:"_1、传统网站部署流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、传统网站部署流程"}},[s._v("#")]),s._v(" 1、传统网站部署流程")]),s._v(" "),a("p",[s._v("需求》开发》测试》部署》备份》上线》测试")]),s._v(" "),a("p",[s._v("MAKE、ANT、MAVEN、Eclipse")]),s._v(" "),a("p",[s._v("jenkins部署流程")]),s._v(" "),a("p",[s._v("提交代码》测试代码》合并代码构建 》部署(晚上定时发布) 》回滚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528852833d.png",alt:"image-20210929172824279"}})]),s._v(" "),a("p",[s._v("Jenkins+Docker+SpringCloud持续集成流程说明")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52885c0c5c.png",alt:"image-20210929181105923"}})]),s._v(" "),a("p",[s._v("Kubernates+Docker+Jenkins持续集成架构图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528860d938.png",alt:"image-20210929182035446"}})]),s._v(" "),a("p",[s._v("大致工作流程：手动/自动构建 -> Jenkins 调度 K8S API -＞动态生成 Jenkins Slave pod -＞ Slave pod 拉取 Git 代码／编译／打包镜像 -＞推送到镜像仓库 Harbor -＞ Slave 工作完成，Pod 自动销毁 -＞部署 到测试或生产 Kubernetes平台。（完全自动化，无需人工干预）")]),s._v(" "),a("p",[s._v("SonarQube代码审查")]),s._v(" "),a("h5",{attrs:{id:"_2、jenkins安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、jenkins安装"}},[s._v("#")]),s._v(" 2、jenkins安装")]),s._v(" "),a("p",[s._v("yum -y install java\njava -version 版本8.0以上")]),s._v(" "),a("p",[s._v('wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins.io/redhat-stable/jenkins.repo\nrpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key\nyum -y install jenkins\nyum install xorg-x11-server-Xvfb\nvim /etc/sysconfig/jenkins\nJENKINS_USER="jenkins"\nJENKINS_PORT ="8080"')]),s._v(" "),a("p",[s._v("chown -R jenkins.jenkins /var/lib/jenkins/\nchown -R jenkins.jenkins /var/log/jenkins/")]),s._v(" "),a("p",[s._v("java -jar /usr/lib/jenkins/jenkins.war --httpPort=8888")]),s._v(" "),a("p",[s._v("war包下载")]),s._v(" "),a("p",[s._v("https://updates.jenkins-ci.org/download/war/")]),s._v(" "),a("h5",{attrs:{id:"_3、基础知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、基础知识"}},[s._v("#")]),s._v(" 3、基础知识")]),s._v(" "),a("p",[s._v("什么是持续集成(CI-Continuous integration)\n持续集成是指多名开发者在开发不同功能代码的过程当中，可以频繁的将代码行合并到一起并切相互不影响工作。")]),s._v(" "),a("p",[s._v("什么是持续部署(CD-continuous deployment)\n是基于某种工具或平台实现代码自动化的构建、测试和部署到线上环境以实现交付高质量的产品,持续部署在某种程度上代表了一个开发团队的更新迭代速率。")]),s._v(" "),a("p",[s._v("什么是持续交付(Continuous Delivery)\n持续交付是在持续部署的基础之上，将产品交付到线上环境，因此持续交付是产品价值的一种交付，是产品价值的一种盈利的实现。")]),s._v(" "),a("p",[s._v("jenkins是一个开源持续集成工具\n1.支持主流软件配置管理，配合实现软件配置管理，持续集成功能\n2.主流的运维开发平台，兼容所有主流开发环境\n3.插件市场可与海量业内主流开发工具实现集成\n4.Job为配置单位与日志管理，使运维与开发人员能协同工作\n5.权限管理划分不同job不同角色\n6.强大的负载均衡功能，保证我们项目的可靠性")]),s._v(" "),a("p",[s._v("freestyle job:\n1.需在页面添加模块配置项与参数完成配置\n2.每个job仅能实现一个开发功能\n3.无法将配置代码化，不利于Job配置迁移与版本控制\n4.逻辑相对简单，无需额外学习成本")]),s._v(" "),a("p",[s._v("pipeline job:\n匹配持续集成与持续交付的概念\n1.所有模块，参数配置都可以体现为一个pipeline脚本\n2.可以定义多个stage构建一个管道工作集\n3.所有配置代码化，方便job配置迁移与版本控制\n4.需要pipeline脚本语法基础")]),s._v(" "),a("h5",{attrs:{id:"_4、jenkins-job构建配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、jenkins-job构建配置"}},[s._v("#")]),s._v(" 4、jenkins job构建配置")]),s._v(" "),a("p",[s._v("1.配置jenkins server 本地gitlab DNS\n2.安装git client,curl工具依赖\n3.关闭系统git http.sslVerfiy安全认证\n4.添加jenkins后台 git client user与email\n5.添加jenkins后台 git Credential凭据")]),s._v(" "),a("h6",{attrs:{id:"_4-1-jenkinx配置构建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-jenkinx配置构建触发器"}},[s._v("#")]),s._v(" 4.1 jenkinx配置构建触发器")]),s._v(" "),a("p",[s._v("安装插件\ngit\ngitlab hook\nRole-based Authorization Strategy")]),s._v(" "),a("p",[s._v("openssl rand -hex 12")]),s._v(" "),a("p",[s._v("http://jenkins.ops.com/job/testproject-app/build?token=93a09ec625469417d29219c1")]),s._v(" "),a("p",[s._v("取消跨站请求伪造保护")]),s._v(" "),a("p",[s._v("高版本jenkins不能界面禁用跨站请求伪造保护。")]),s._v(" "),a("p",[s._v("禁用跨站请求伪造保护操作如下：")]),s._v(" "),a("p",[s._v("修改jenkins的配置文件。vim /etc/sysconfig/jenkins")]),s._v(" "),a("p",[s._v('JENKINS_JAVA_OPTIONS="-Djava.awt.headless=true -Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION=true"')]),s._v(" "),a("p",[s._v("配置后重启jenkins。service jenkins restart")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('cd /var/lib/jenkins/workspace/testproject-app \nssh 192.168.200.237 "rm -rf /opt/tomcat2"\nscp -r tomcat 192.168.200.237:/opt/tomcat2\nssh 192.168.200.237 "java -version"\nssh 192.168.200.237 "mkdir /opt/tomcat2/logs"\nssh 192.168.200.237 "/opt/tomcat2/bin/startup.sh start"\n\n\ncd /var/lib/jenkins/workspace/testproject-app\ntar czvf code.tar.gz *\nscp code.tar.gz 192.168.200.212:/data/tomcat/tomcat_appdir/\nssh 192.168.200.212 "systemctl stop tomcat && rm -rf /data/tomcat/tomcat_webdir/myapp/* && cd /data/tomcat/tomcat_appdir && tar xf code.tar.gz -C /data/tomcat/tomcat_webdir/myapp/"\nssh 192.168.200.212 "systemctl start tomcat"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("视图插件\nbuild pipeline")]),s._v(" "),a("h5",{attrs:{id:"_5-docker安装jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-docker安装jenkins"}},[s._v("#")]),s._v(" 5.docker安装jenkins")]),s._v(" "),a("p",[s._v("docker run --name jenkins -u root -p 8083:8080 -p 50000:50000 -d  --restart=always -v /data/jenkins:/var/jenkins_home  jenkins:2.19.3")]),s._v(" "),a("h5",{attrs:{id:"_6-jenkins-pipeline-job编写规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-jenkins-pipeline-job编写规范"}},[s._v("#")]),s._v(" 6.jenkins pipeline job编写规范")]),s._v(" "),a("p",[s._v("pipeline基础架构\n◆所有代码包裹在pipeline{}层内\n◆stages{}层用来包含该pipeline所有stage子层\n◆stage{}层用来包含具体我们需要编写任务的steps{}子层")]),s._v(" "),a("p",[s._v("agent区域\n◆agent定义pipeline在哪里运行\n可以使用any, none,或具体的Jenkins node主机名等\n例:如果我们要特指在node1.上执行,可以写成:\nagent {node {label 'node1'}}")]),s._v(" "),a("p",[s._v("agent any")]),s._v(" "),a("p",[s._v('environment区域\n◆"变 量名称=变量值"定义我们的环境变量')]),s._v(" "),a("p",[s._v("◆可以定义全局环境变量,应用所有stages任务")]),s._v(" "),a("p",[s._v("◆可以定义stage环境变量,应用单独的stage任务")]),s._v(" "),a("p",[s._v("script区域(可选)\n◆在steps内定义script{}\n◆groovy脚本语言\n◆用来进行脚本逻辑运算")]),s._v(" "),a("p",[s._v("常用steps区域\n◆echo: 打印输出\n◆sh: 调用Linux系统shell命令\n◆git url:调用git模块进行git相关操作")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[s._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("label "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins-slave1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    environment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        JAVA_HOME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/jdk"')])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clone 代码"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tsteps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n             sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rm -rf /home/jenkins/workspace/pipeline-test2/*'")]),s._v("\n        git credentialsId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d8106f36-80b1-4847-a93e-2b88ffa70a31'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://gitee.com/opstand/cloud.git'")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码打包"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tsteps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \tsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cd /home/jenkins/workspace/pipeline-test2/ && tar zcf /opt/code.tar.gz *'")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码复制"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tsteps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   \t\t sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cp /opt/code.tar.gz /opt/tomcat8/webapps/'")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat重启"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tsteps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \tsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/tomcat8/bin/shutdown.sh && sleep 10s'")]),s._v("\n    \tsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/tomcat8/bin/startup.sh'")]),s._v("\n        sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ps -ef|grep tomcat'")]),s._v("\n        sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ss -tnl'")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("p",[s._v("jenkins shell命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, my name is '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Sorry, I am not '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/system-release\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -m\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("py_cmd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" python"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$py_cmd")]),s._v(" --version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("jenkins集成ansible")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@192.168.200.210 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cat >/tmp/1.sh<<EOF \\\n#!/bin/bash\nansible --version\nansible-playbook --version\ncat /etc/ansible/hosts\nansible web -m command -a '),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("ip addr"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('\nEOF"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@192.168.200.210 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bash /tmp/1.sh"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h5",{attrs:{id:"_7-pipline-job示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-pipline-job示例"}},[s._v("#")]),s._v(" 7.pipline job示例")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jenkins-slave1"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clone代码"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rm -rf /var/lib/jenkins/workspace/pipeline-test/*'")]),s._v("\ngit branch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'develop'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" credentialsId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b0c0dd45-e628-44ad-be1c-42693fdedf6c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git@gitlab.example.com:testgroup/testproject.git'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码打包"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cd /var/lib/jenkins/workspace/pipeline-test/ && tar czvf code.tar.gz *'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码复制"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scp code.tar.gz 192.168.200.212:/data/tomcat/tomcat_appdir/'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"停止tomcat服务"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ssh 192.168.200.212 \"systemctl stop tomcat\"'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码部署"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ssh 192.168.200.212 \"rm -rf /data/tomcat/tomcat_webdir/myapp/* && cd /data/tomcat/tomcat_appdir && tar xvf code.tar.gz -C /data/tomcat/tomcat_webdir/myapp/\"'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动tomcat服务"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ssh 192.168.200.212 \"systemctl start tomcat\"'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h5",{attrs:{id:"jenkinsfile-基础语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkinsfile-基础语法"}},[s._v("#")]),s._v(" JenkinsFile 基础语法")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 前端项目JenkinsFile配置，后端项目配置稍有不同，后面会区分说明")]),s._v("\npipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  agent any\n  environment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    HOST_TEST "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root@121.41.16.183'")]),s._v("\n    HOST_ONLINE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins@39.101.219.110'")]),s._v("\n    SOURCE_DIR "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dist/*'")]),s._v("\n    TARGET_DIR "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/www/kuaimen-yunying-front'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  parameters "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("choice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      description"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你需要选择哪个环境进行部署 ?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'env'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      choices"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'测试环境'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'线上环境'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" defaultValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" description"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'本次更新内容?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  triggers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("GenericTrigger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n     genericVariables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ref'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$.ref'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     causeString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Triggered on $ref'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'runcenter-front-q1w2e3r4t5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     tokenCredentialId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     printContributedVariables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     printPostContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     silentResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     regexpFilterText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$ref'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     regexpFilterExpression"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'refs/heads/'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" BRANCH_NAME\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'获取git commit message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GIT_COMMIT_MSG "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git log -1 --pretty=%B ${GIT_COMMIT}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" returnStdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trim")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'打包'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nodejs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nodejs-12.16'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'开始安装依赖'")]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yarn'")]),s._v("\n          echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'开始打包'")]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yarn run build'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'部署'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      when "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        expression "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'测试环境'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sshagent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'km-test2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -o StrictHostKeyChecking=no ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("HOST_TEST")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(' uname -a"')])]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scp -r ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("SOURCE_DIR")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(" ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("HOST_TEST")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("TARGET_DIR")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo \"部署成功~\"'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'发布'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      when "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        expression "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'线上环境'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sshagent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'km-online'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -o StrictHostKeyChecking=no ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("HOST_ONLINE")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(' uname -a"')])]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scp -r ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("SOURCE_DIR")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(" ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("HOST_ONLINE")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("TARGET_DIR")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),s._v("\n          sh "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo \"发布成功~\"'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  post "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    success "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      dingtalk "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        robot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'77d4c82d-3794-4583-bc7f-556902fee6b0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MARKDOWN'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        atAll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你有新的消息，请注意查收'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'# 运营管理系统发布通知'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'---'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#### **所属：前端**'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#### **构建任务：')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BUILD_DISPLAY_NAME")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('**"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#### **Git commit：')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GIT_COMMIT_MSG")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('**"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#### **本次更新内容：')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('**"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#### **部署环境：')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('**"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#### **构建结果：成功**'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br")])]),a("ul",[a("li",[s._v("pipeline 必须在最外层")]),s._v(" "),a("li",[s._v("agent 定义了在哪个环境里执行，默认any")]),s._v(" "),a("li",[s._v("stages 阶段，标识构建流程的标签块，子节点是stage")]),s._v(" "),a("li",[s._v("steps 执行步骤")]),s._v(" "),a("li",[s._v("post 所有阶段执行完成后执行一些逻辑")]),s._v(" "),a("li",[s._v("when 可以控制该阶段是否执行")]),s._v(" "),a("li",[s._v("environment 环境变量，在这里定义的变量，JenkinsFile的任何地方都可以访问")]),s._v(" "),a("li",[s._v("tools 项目使用到的构建工具，声明系统配置中已经定义好的工具，如maven")]),s._v(" "),a("li",[s._v("parameters 定义参数，可以提供用户输入或者选择")]),s._v(" "),a("li",[s._v("post 构建结束后会执行这里，有success、failure、success，本示例将在success（构建成功时）发起钉钉通知")])]),s._v(" "),a("h5",{attrs:{id:"_8-shell自动发布脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-shell自动发布脚本"}},[s._v("#")]),s._v(" 8.shell自动发布脚本")]),s._v(" "),a("p",[s._v("自动上传war包")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/jenkins_home/workspace/cjpt_222_sd/web/target\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.222 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl stop tomcat && rm -f /opt/tomcat8/webapps/web.war && rm -rf /opt/tomcat8/webapps/web"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" *.war "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.222:/opt/tomcat8/webapps/web.war\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.222 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl start tomcat"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h5",{attrs:{id:"_9-jenkins-设置中文显示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-jenkins-设置中文显示"}},[s._v("#")]),s._v(" 9.jenkins 设置中文显示")]),s._v(" "),a("p",[s._v("这里使用的方法是安装中文语言包，安装的插件名称是：Localization: Chinese (Simplified)\n1.在插件管理，搜索 Localization: Chinese (Simplified)，然后点击Install without restart")]),s._v(" "),a("p",[s._v("好记性不如烂笔头,仅用来记录")]),s._v(" "),a("h5",{attrs:{id:"_10-jenkins构建maven项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-jenkins构建maven项目"}},[s._v("#")]),s._v(" 10.jenkins构建maven项目")]),s._v(" "),a("p",[s._v("一、linux的环境")]),s._v(" "),a("p",[s._v("jdk 、maven 、tomcat版本按照所定需求安装好")]),s._v(" "),a("p",[s._v("二、jenkins安装")]),s._v(" "),a("p",[s._v("这里就忽略了")]),s._v(" "),a("p",[s._v("三、jenkins所需要的插件")]),s._v(" "),a("p",[s._v("Deploy to container")]),s._v(" "),a("p",[s._v("Maven Intergration plugin")]),s._v(" "),a("p",[s._v("四、全局工具配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528864dc26.jpg",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528868a662.jpg",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52886c0aec.jpg",alt:"img"}})]),s._v(" "),a("p",[s._v("五、创建任务")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528870e069.jpg",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b5288752375.jpg",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528879190f.jpg",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52887dabd4.jpg",alt:"img"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('打开tomcat下conf/tomcat-users.xml，在</tomcat-users>之前增加以下配置:\n\n<role rolename="manager"/>\n\n<role rolename="manager-gui"/>\n\n<role rolename="manager-script"/>\n\n<role rolename="manager-status"/>\n\n<user username="xxx" password="xxxx" roles="tomcat,admin-gui,admin,manager,manager-gui,manager-script"/>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b5288829036.jpg",alt:"img"}})]),s._v(" "),a("p",[s._v("之后点击构建得到以下结果就是完满成功了~")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b5288866cfc.jpg",alt:"img"}})]),s._v(" "),a("p",[s._v("如果Jenkins报错：The username you provided is not allowed to use the text-based Tomcat Manager (error 403)：")]),s._v(" "),a("p",[s._v("在tomcat目录修改两个文件！")]),s._v(" "),a("p",[s._v("webapps/manager/META-INF/context.xml")]),s._v(" "),a("p",[s._v("webapps/host-manager/META-INF/context.xml")]),s._v(" "),a("p",[s._v("将只允许本机访问的限制注释掉即可，")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52888a3c60.jpg",alt:"img"}})]),s._v(" "),a("p",[s._v("如果jenkins报错：")]),s._v(" "),a("p",[s._v("ERROR: Maven JVM terminated unexpectedly with exit code 137")]),s._v(" "),a("p",[s._v("1、查看内存使用情况：free -m")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b52888ddcda.jpg",alt:"img"}})]),s._v(" "),a("p",[s._v("2、创建虚拟内存磁盘卷")]),s._v(" "),a("p",[s._v("mkdir /swap")]),s._v(" "),a("p",[s._v("dd if=/dev/zero of=/swap/swapadd bs=1024 count=2024288")]),s._v(" "),a("p",[s._v("3、将磁盘卷转为虚拟内存卷")]),s._v(" "),a("p",[s._v("mkswap /swap/swapadd")]),s._v(" "),a("p",[s._v("4、启用虚拟内存服务")]),s._v(" "),a("p",[s._v("swapon /swap/swapadd")]),s._v(" "),a("p",[s._v("5、再次查看内存情况")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.aomtop.com/i/2022/06/24/62b528892466e.jpg",alt:"img"}})]),s._v(" "),a("h5",{attrs:{id:"_11-jenkins版本回滚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-jenkins版本回滚"}},[s._v("#")]),s._v(" 11.jenkins版本回滚")]),s._v(" "),a("h5",{attrs:{id:"一、新建一个自由风格项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、新建一个自由风格项目"}},[s._v("#")]),s._v(" 一、新建一个自由风格项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-a108ab1f36ecd0f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/961/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("h5",{attrs:{id:"二、配置参数化构建过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、配置参数化构建过程"}},[s._v("#")]),s._v(" 二、配置参数化构建过程")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("添加选项参数")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-2e02048f5c44c73e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1080/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("p",[s._v("填入以下内容")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-d92b90cf02394370.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/932/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("p",[s._v("2.添加字符参数")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-fb7d94687c85fa8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/981/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")])])]),s._v(" "),a("h5",{attrs:{id:"三、配置svn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、配置svn"}},[s._v("#")]),s._v(" 三、配置SVN")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-5f07deb042e0775b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1116/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("h5",{attrs:{id:"四、配置构建步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、配置构建步骤"}},[s._v("#")]),s._v(" 四、配置构建步骤")]),s._v(" "),a("h6",{attrs:{id:"_1-maven打包配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-maven打包配置"}},[s._v("#")]),s._v(" 1. maven打包配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("选择调用顶层Maven目标，Maven版本之前已经在全局工具配置中设置过，目标中填入打包命令")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-367ecfbc81f77708.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/940/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")])])]),s._v(" "),a("h6",{attrs:{id:"_2-执行shell配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-执行shell配置"}},[s._v("#")]),s._v(" 2. 执行shell配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("此脚本为打包备份，回滚脚本")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-757547f8453fdfab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1029/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("p",[s._v("填入以下脚本")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-a90ca577c7fd6e40.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/973/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("备份回滚脚本")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Status")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n  Deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Status")]),s._v('"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/bak/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_NUMBER}")]),s._v('"')]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建每次要备份的目录")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"The files is already  exists "')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$path")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("cp -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/target/*.war "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$path")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将打包好的war包备份到相应目录,覆盖已存在的目标")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Completing!"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Rollback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Status")]),s._v('"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Version:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Version")]),s._v('"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/bak/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Version")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入备份目录")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("cp -f *.war "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/target/       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将备份拷贝到程序打包目录中，并覆盖之前的war包")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("这样发布后以后，就会备份如下")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-8eb71eb8e32b149f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/438/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-48e84ec4ca604b12.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")])])]),s._v(" "),a("h6",{attrs:{id:"_3-定期删除脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-定期删除脚本"}},[s._v("#")]),s._v(" 3. 定期删除脚本")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("项目备份不可能无限制备份，这样很快就会占满磁盘，所以我们必须有清除老旧备份的机制。此处配置一个脚本，每次发布都执行一次，判断备份数是否超过5个，如果超过，则删除老旧备份，只保留最新的5个。")])]),s._v(" "),a("li",[a("p",[s._v("再添加一个执行shell步骤，填入以下脚本，其中备份数量可以自行修改减小或加大")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-6f94e72e5e418530.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/950/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("删除老旧备份脚本")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ReservedNum")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保留文件数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FileDir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/bak/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("date")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"+%Y%m%d-%H%M%S"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FileDir")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入备份目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FileNum")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^d'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前有几个文件夹，即几个备份")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" $FileNum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" $ReservedNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OldFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -rt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -1"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取最旧的那个备份文件夹")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Delete File:"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OldFile")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FileDir")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OldFile")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("let")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FileNum--"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h5",{attrs:{id:"五、配置发送到远程tomcat目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、配置发送到远程tomcat目录"}},[s._v("#")]),s._v(" 五、配置发送到远程tomcat目录")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-c7beb037bddad4f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1055/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("p",[s._v("其中Source files要注意配置正确，否则发送不了war包，我的jenkins该项目的workspace如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-819b6ed8eb89107e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/810/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")]),s._v(" "),a("h6",{attrs:{id:"六、发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、发布"}},[s._v("#")]),s._v(" 六、发布")]),s._v(" "),a("ul",[a("li",[s._v("回到项目主界面，点击Build with Parameters")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-4fef7f366d2c4582.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1083/format/webp",alt:"img"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("发布选择Deploy---\x3e开始构建，即可开始发布。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-fe8a4b1e7436a3c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/999/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("image.png")])]),s._v(" "),a("li",[a("p",[s._v("回滚选择Rollback---\x3e输入回滚版本----\x3e开始构建，版本号从构建历史中选择一个输入")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/7802645-1461ea688e7b5d62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1105/format/webp",alt:"img"}})])])]),s._v(" "),a("h5",{attrs:{id:"_12-关于execute-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-关于execute-shell"}},[s._v("#")]),s._v(" 12.关于execute shell")]),s._v(" "),a("p",[s._v("请在“Execute shell”构建步骤中添加以下行。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token hashbang comment"}},[s._v("#!/bin/sh")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("现在让我解释一下为什么我们需要这行“Execute Shell”构建作业的原因。")]),s._v(" "),a("p",[s._v("默认情况下，Jenkins采取"),a("code",[s._v("/bin/sh -xe")]),s._v("这种方式"),a("code",[s._v("-x")]),s._v("将打印每一个命令。另一个选项"),a("code",[s._v("-e")]),s._v("，当任何命令以非零值（当任何命令失败时）退出代码时，这会导致shell立即停止运行脚本。")]),s._v(" "),a("p",[s._v("所以通过添加"),a("code",[s._v("#!/bin/sh")]),s._v("将让你执行没有选择。")])])}),[],!1,null,null,null);t.default=e.exports}}]);