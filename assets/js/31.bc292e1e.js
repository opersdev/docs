(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{526:function(e,n,l){"use strict";l.r(n);var r=l(22),t=Object(r.a)({},(function(){var e=this,n=e.$createElement,l=e._self._c||n;return l("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[l("p",[e._v("firewalld服务\nfirewalld 介绍\nfirewalld是CentOS 7.0新推出的管理netfilter的用户空间软件工具\nfirewalld是配置和监控防火墙规则的系统守护进程。可以实iptables,ip6tables,ebtables的功能\nfirewalld服务由firewalld包提供\nfirewalld支持划分区域zone,每个zone可以设置独立的防火墙规则")]),e._v(" "),l("p",[e._v("归入zone顺序：")]),e._v(" "),l("p",[e._v("先根据数据包中源地址，将其纳为某个zone\n纳为网络接口所属zone\n纳入默认zone，默认为public zone,管理员可以改为其它zone\n网卡默认属于public zone,lo网络接口属于trusted zone")]),e._v(" "),l("p",[e._v("firewalld zone分类")]),e._v(" "),l("p",[e._v("zone名称\t默认配置\ntrusted\t允许所有流量\nhome\t拒绝除和传出流量相关的，以及ssh,mdsn,ipp-client,samba-client,dhcpv6-client预定义服务之外其它所有传入流量\ninternal\t和home相同\nwork\t拒绝除和传出流量相关的，以及ssh,ipp-client,dhcpv6-client预定义服务之外的其它所有传入流量\npublic\t拒绝除和传出流量相关的，以及ssh,dhcpv6-client预定义服务之外的其它所有传入流量，新加的网卡默认属于public zone\nexternal\t拒绝除和传出流量相关的，以及ssh预定义服务之外的其它所有传入流量，属于external zone的传出ipv4流量的源地址将被伪装为传出网卡的地址。\ndmz\t拒绝除和传出流量相关的，以及ssh预定义服务之外的其它所有传入流量\nblock\t拒绝除和传出流量相关的所有传入流量\ndrop\t拒绝除和传出流量相关的所有传入流量（甚至不以ICMP错误进行回应）\n预定义服务")]),e._v(" "),l("p",[e._v("服务名称\t配置\nssh\tLocal SSH server. Traffic to 22/tcp\ndhcpv6-client\tLocal DHCPv6 client. Traffic to 546/udp on the fe80::/64 IPv6 network\nipp-client\tLocal IPP printing. Traffic to 631/udp.\nsamba-client\tLocal Windows file and print sharing client. Traffic to 137/udp and 138/udp.\nmdns\tMulticast DNS (mDNS) local-link name resolution. Traffic to 5353/udp to the 224.0.0.251 (IPv4) or ff02::fb (IPv6) multicast addresses.\nfirewalld预定义服务配置")]),e._v(" "),l("p",[e._v("firewall-cmd –get-services 查看预定义服务列表\n/usr/lib/firewalld/services/*.xml预定义服务的配置\nfirewalld 三种配置方法")]),e._v(" "),l("p",[e._v("firewall-config （firewall-config包）图形工具\nfirewall-cmd （firewalld包）命令行工具\n/etc/firewalld 配置文件，一般不建议\nfirewall-cmd 命令\nfirewall-cmd 格式")]),e._v(" "),l("p",[e._v("Usage: firewall-cmd [OPTIONS...]")]),e._v(" "),l("p",[e._v("--get-zones     列出所有可用区域\n--get-default-zone  查询默认区域\n--set-default-zone=<ZONE> 设置默认区域\n--get-active-zones  列出当前正使用的区域\n--add-source=<CIDR>[--zone=<ZONE>]  添加源地址的流量到指定区域，如果无--zone= 选项，使用默认区域\n--remove-source=<CIDR> [--zone=<ZONE>]  从指定区域删除源地址的流量，如无--zone= 选项，使用默认区域\n--add-interface=<INTERFACE>[--zone=<ZONE>]  添加来自于指定接口的流量到特定区域，如果无--zone= 选项，使用默认区域\n--change-interface=<INTERFACE>[--zone=<ZONE>]   改变指定接口至新的区域，如果无--zone= 选项，使用默认区域\n--add-service=<SERVICE> [--zone=<ZONE>] 允许服务的流量通过，如果无--zone= 选项，使用默认区域\n--add-port=<PORT/PROTOCOL>[--zone=<ZONE>] 允许指定端口和协议的流量，如果无--zone= 选项，使用默认区域\n--remove-service=<SERVICE> [--zone=<ZONE>]  从区域中删除指定服务，禁止该服务流量，如果无--zone= 选项，使用默认区域\n--remove-port=<PORT/PROTOCOL>[--zone=<ZONE>]    从区域中删除指定端口和协议，禁止该端口的流量，如果无--zone= 选项，使用默认区域\n--reload    删除当前运行时配置，应用加载永久配置\n--list-services  查看开放的服务\n--list-ports   查看开放的端口\n--list-all [--zone=<ZONE>]     列出指定区域的所有配置信息，包括接口，源地址，端口，服务等，如果无--zone= 选项，使用默认区域")]),e._v(" "),l("p",[e._v("#查看默认zone\nfirewall-cmd --get-default-zone\n#默认zone设为dmz\nfirewall-cmd --set-default-zone=dmz\n#在internal zone中增加源地址192.168.0.0/24的永久规则\nfirewall-cmd --permanent --zone=internal  --add-source=192.168.0.0/24\n#在internal zone中增加协议mysql的永久规则\nfirewall-cmd --permanent --zone=internal  --add-service=mysql\n#加载新规则以生效\nfirewall-cmd  --reload")]),e._v(" "),l("p",[e._v("systemctl mask iptables\nsystemctl mask ip6tables\nsystemctl status firewalld\nsystemctl enable firewalld\nsystemctl start firewalld\nfirewall-cmd  --get-default-zone\nfirewall-cmd  --set-default-zone=public\nfirewall-cmd  --permanent  --zone=public  --list-all\nfirewall-cmd  --permanent  --zone=public  --add-port  8080/tcp\nfirewall-cmd   ---reload")]),e._v(" "),l("p",[e._v("其它规则\n当基本firewalld语法规则不能满足要求时，可以使用以下更复杂的规则")]),e._v(" "),l("p",[e._v("rich-rules 富规则，功能强,表达性语言\nDirect configuration rules 直接规则，灵活性差, 帮助：man 5 firewalld.direct\n管理rich规则\nrich规则比基本的firewalld语法实现更强的功能，不仅实现允许/拒绝，还可以实现日志syslog和auditd，也可以实现端口转发，伪装和限制速率")]),e._v(" "),l("p",[e._v("规则实施顺序：")]),e._v(" "),l("p",[e._v("该区域的端口转发，伪装规则\n该区域的日志规则\n该区域的允许规则\n该区域的拒绝规则\n每个匹配的规则生效，所有规则都不匹配，该区域默认规则生效")]),e._v(" "),l("p",[e._v("rich语法：")]),e._v(" "),l("p",[e._v("rule\n[source]\n[destination]\nservice|port|protocol|icmp-block|masquerade|forward-port\n[log]\n[audit]\n[accept|reject|drop]")]),e._v(" "),l("p",[e._v("–add-rich-rule=’‘\tAdd to the specified zone, or the default zone if no zone is specified.\n–remove-rich-rule=’‘\tRemove to the specified zone, or the default zone if no zone is specified.\n–query-rich-rule=’‘\tQuery if has been added to the specified zone, or the default zone if no zone is specified. Returns 0 if the rule is present, otherwise 1.\n–list-rich-rules\tOutputs all rich rules for the specified zone, or the default zone if no zone is specified.\nrich规则实现\n拒绝从192.168.0.11的所有流量，当address 选项使用source 或 destination时，必须用family= ipv4 |ipv6")]),e._v(" "),l("p",[e._v("firewall-cmd --permanent --zone=public --add-rich-rule='rule   family=ipv4 source address=192.168.0.11/32 reject'")]),e._v(" "),l("p",[e._v("限制每分钟只有两个连接到ftp服务\nfirewall-cmd --add-rich-rule=‘rule service name=ftp limit value=2/m accept’")]),e._v(" "),l("p",[e._v("抛弃esp（ IPsec 体系中的一种主要协议）协议的所有数据包\nfirewall-cmd --permanent --add-rich-rule='rule protocol value=esp drop'")]),e._v(" "),l("p",[e._v("接受所有192.168.1.0/24子网端口5900-5905范围的TCP流量")]),e._v(" "),l("p",[e._v("firewall-cmd --permanent --zone=vnc --add-rich-rule='rule family=ipv4 source address=192.168.1.0/24 port port=5900-5905 protocol=tcp accept'")]),e._v(" "),l("p",[e._v("伪装和端口转发\nNAT网络地址转换，firewalld支持伪装和端口转发两种NAT方式")]),e._v(" "),l("p",[e._v("伪装NAT")]),e._v(" "),l("p",[e._v("firewall-cmd --permanent --zone=<ZONE> --add-masquerade\nfirewall-cmd --query-masquerade  #检查是否允许伪装\nfirewall-cmd --add-masquerade   #允许防火墙伪装IP\nfirewall-cmd --remove-masquerade #禁止防火墙伪装IP")]),e._v(" "),l("p",[e._v("firewall-cmd --add-rich-rule='rule family=ipv4 source address=192.168.0.0/24 masquerade'")]),e._v(" "),l("p",[e._v("端口转发")]),e._v(" "),l("p",[e._v("端口转发：将发往本机的特定端口的流量转发到本机或不同机器的另一个端口。通常要配合地址伪装才能实现")]),e._v(" "),l("p",[e._v("firewall-cmd --permanent --zone=<ZONE> --add-forward-port=port=<PORTNUMBER>:proto=<PROTOCOL>[:toport=<PORTNUMBER>][:toaddr=]")]),e._v(" "),l("p",[e._v("说明：toport= 和toaddr= 至少要指定一个")]),e._v(" "),l("p",[e._v("范例：")]),e._v(" "),l("p",[e._v("#转发传入的连接9527/TCP，到防火墙的80/TCP到public zone 的192.168.0.254\nfirewall-cmd --add-masquerade  启用伪装\nfirewall-cmd --zone=public --add-forward-port=port=9527:proto=tcp:toport=80:toaddr=192.168.0.254")]),e._v(" "),l("p",[e._v("范例：限制ssh服务非标准端口访问")]),e._v(" "),l("p",[e._v('cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/ssh.xml\nvim /etc/firewalld/services/ssh.xml\n<port protocol="tcp" port="999"/>\nsystemctl restart sshd.service\nsystemctl status -l sshd.service\nsealert -a /var/log/audit/audit.log\nsemanage port -a -t ssh_port_t -p tcp 999\nsystemctl restart sshd.service\nss -tulpn | grep sshd\nfirewall-cmd --permanent --zone=work --add-source=172.25.X.0/24\nfirewall-cmd --permanent --zone=work --add-port=999/tcp\nfirewall-cmd --reload')])])}),[],!1,null,null,null);n.default=t.exports}}]);