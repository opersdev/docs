(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{532:function(s,n,t){"use strict";t.r(n);var a=t(22),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ftp服务概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ftp服务概述"}},[s._v("#")]),s._v(" ftp服务概述")]),s._v(" "),t("p",[s._v("ftp连接及传输模式")]),s._v(" "),t("p",[s._v("控制连接：tcp 21，用于发送ftp命令信息 ……也叫服务端连接")]),s._v(" "),t("p",[s._v("数据连接：tcp 20，用于上传，下载数据 ……也叫客户端连接")]),s._v(" "),t("p",[s._v("数据连接的建立类型：")]),s._v(" "),t("p",[s._v("主动模式：服务端主动向客户端发起连接")]),s._v(" "),t("p",[s._v("被动模式：服务端指定某个端口被动等待客户端连接")]),s._v(" "),t("p",[s._v("注：主动模式下客户端未关闭firewall则接收不到服务器20端口的发送请求。此模式应用于未运行firewall的客户端。另客户端关闭firewall如果网络环境的firewall未关闭也将屏蔽20端口的连接请求。")]),s._v(" "),t("p",[s._v("ftp传输模式：")]),s._v(" "),t("p",[s._v("文本模式：ascii模式，以文本序列传输数据")]),s._v(" "),t("p",[s._v("二进制模式：binaty模式，以二进制序列传输数据")]),s._v(" "),t("p",[s._v("ftp用户的类型：")]),s._v(" "),t("p",[s._v("匿名用户：anonymous或ftp")]),s._v(" "),t("p",[s._v("本地用户：账号密码保存在passwd和shadow文件中")]),s._v(" "),t("p",[s._v("虚拟用户：使用独立的帐号和密码数据文件")]),s._v(" "),t("p",[s._v("常见的ftp服务器程序")]),s._v(" "),t("p",[s._v("iis (windows)  serv-u (third windows )  wu-ftpd proftpd")]),s._v(" "),t("p",[s._v("vsftpd (very secure ftp daemon)")]),s._v(" "),t("p",[s._v("常见的ftp 客户端程序")]),s._v(" "),t("p",[s._v("ftp命令行")]),s._v(" "),t("p",[s._v("cuteftp  flashfxp leapftp filezilla")]),s._v(" "),t("p",[s._v("gftp  kuftp")]),s._v(" "),t("p",[s._v("vsftpd服务基础")]),s._v(" "),t("p",[s._v("vsftpd软件包")]),s._v(" "),t("p",[s._v("官方站点：http://vsftpd.beasts.org/")]),s._v(" "),t("p",[s._v("主程序：/usr/sbin/vsftpd")]),s._v(" "),t("p",[s._v("服务名：vsftpd")]),s._v(" "),t("p",[s._v("用户控制列表文件")]),s._v(" "),t("p",[s._v("/etc/vsftpd/ftpusers   ……黑名单")]),s._v(" "),t("p",[s._v("/etc/vsftpd/user_list   ……可黑可白，取决于主配置文件")]),s._v(" "),t("p",[s._v("主配置文件：")]),s._v(" "),t("p",[s._v("/etc/vsftpd/vsftpd.conf")]),s._v(" "),t("h1",{attrs:{id:"主配置文件vsftpd-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主配置文件vsftpd-conf"}},[s._v("#")]),s._v(" 主配置文件vsftpd.conf")]),s._v(" "),t("p",[s._v("常用的全局配置项：")]),s._v(" "),t("p",[s._v("listen=yes:是否以独立运行的方式监听服务")]),s._v(" "),t("p",[s._v("listen_address=192.168.1.20:设置监听的ip地址")]),s._v(" "),t("p",[s._v("注：多网卡服务器ftp针对不同ip地址")]),s._v(" "),t("p",[s._v("listen_pror=21:设置监听ftp服务的端口号")]),s._v(" "),t("p",[s._v("注：面向外网，不要改；面向内网，且不对外，最好还是改换。")]),s._v(" "),t("p",[s._v("write_enable=yes:是否启用写入权限(上传)")]),s._v(" "),t("p",[s._v("download_enable=yes:是否允许下载文件")]),s._v(" "),t("p",[s._v("userlist_enable=yes:是否启用user_list列表文件")]),s._v(" "),t("p",[s._v("userlist_deny=yes:是否禁用user_list列表中的用户")]),s._v(" "),t("p",[s._v("注：userlist_deny=no,不禁用，但仅允许这些")]),s._v(" "),t("p",[s._v("max_clients=0:限制并发客户端连接数")]),s._v(" "),t("p",[s._v("注：0为不限制，个体服务器能承载的并发连接数有上限，无论面向内外网，最好设置承载个数，以防ddos攻击。")]),s._v(" "),t("p",[s._v("max_pre_ip=0:限制同一ip地址的并发连接数")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[s._v("local_enable=yes\n\nwrite_enable=yes\n\nanon_umask=022\n\nguest_enable=yes 启用用户映射功能\n\nguest_username=virtual 指定映射的系统用户名称\n\npam_service_name=vsftpd.vu 指定新的pam认证文件\n\n开启被动模式：\n\nconnect_from_port_20=NO(默认为YES) "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置是否允许主动模式")]),s._v("\npasv_enable=YES(默认为YES) "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置是否允许被动模式")]),s._v("\npasv_min_port=50000(default:0(use any port))\npasv_max_port=60000(default:0(use any port))\n\n开启主动模式：\n\nconnect_from_port_20=YES\npasv_enable=NO\n\n\n多用户配置文件\nuser_config_dir=/etc/vsftpd/userconfig\ntouch /etc/vsftpd/userconfig/admin\n\n单用户多目录\nmount --bind /mnt/CSFS/SYNC /var/ftp/admin/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表明FTP服务器记录上传下载的情况")]),s._v("\nxferlog_enable=YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表明将记录的上传下载情况写在xferlog_file所指定的文件中， 即xferlog_file选项指定的文件中")]),s._v("\nxferlog_std_format=YES\nxferlog_file=/var/log/xferlog\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用双份日志。在用xferlog文件记录服务器上传下载情况的同时，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vsftpd_log_file所指定的文件，即/var/log/vsftpd.log也将用来 记录服务器的传输情况")]),s._v("\ndual_log_enable=YES\nvsftpd_log_file=/var/log/vsftpd.log\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br")])]),t("h2",{attrs:{id:"常用匿名ftp配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用匿名ftp配置项"}},[s._v("#")]),s._v(" 常用匿名ftp配置项")]),s._v(" "),t("p",[s._v("anonymous_enable=yes:启用匿名访问")]),s._v(" "),t("p",[s._v("anon_umask=022:匿名用户所上传文件的权限掩码")]),s._v(" "),t("p",[s._v("注：各项用7去减，得755，即上传文件权限")]),s._v(" "),t("p",[s._v("anon_root=/var/ftp:匿名用户的根目录")]),s._v(" "),t("p",[s._v("anon_upload_enable=yes:允许上传文件")]),s._v(" "),t("p",[s._v("anon_mkdir_write_enable=yes:允许创建目录")]),s._v(" "),t("p",[s._v("注:只能创建,不能删除和重命名")]),s._v(" "),t("p",[s._v("anon_other_write_enable=yes:开放其它写入权限")]),s._v(" "),t("p",[s._v("注:可以删除和重命名")]),s._v(" "),t("p",[s._v("anon_max_rate=0:限制最大传输速率(字节/秒)")]),s._v(" "),t("p",[s._v("注：计算机中的位：二进制中，每个0或1就是一个位(bit)，它是数据存储的最小单位，其中每8个位等于一个字节(byte)")]),s._v(" "),t("p",[s._v("故1byte=8bit即1mb=1024kb=1024"),t("em",[s._v("1024b=1024")]),s._v("1024*8b")]),s._v(" "),t("h2",{attrs:{id:"常用的本地用户ftp配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用的本地用户ftp配置项"}},[s._v("#")]),s._v(" 常用的本地用户ftp配置项")]),s._v(" "),t("p",[s._v("local_enable=yes:是否启用本地系统用户")]),s._v(" "),t("p",[s._v("local_umask=022:本地用户所上传文件的权限掩码")]),s._v(" "),t("p",[s._v("local_root=/var/ftp:设置本地用户的ftp根目录")]),s._v(" "),t("p",[s._v("chroot_local_user=yes:是否将用户禁锢在主目录")]),s._v(" "),t("p",[s._v("注：启用local一定要禁锢，否则如果用户权限够大，系统将面临风险。")]),s._v(" "),t("p",[s._v("local_max_rate=0:限制最大传输速率(字节/秒)")]),s._v(" "),t("h1",{attrs:{id:"构建匿名用户访问的ftp服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建匿名用户访问的ftp服务"}},[s._v("#")]),s._v(" 构建匿名用户访问的ftp服务")]),s._v(" "),t("p",[s._v("思路：先准备匿名ftp访问的目录，并开放权限，然后编辑匿名用户配置，再启动服务")]),s._v(" "),t("p",[s._v("⑴挂载光盘，安装服务端软件")]),s._v(" "),t("p",[s._v("mount /dev/cdrom /media")]),s._v(" "),t("p",[s._v("rpm -ivh /media/packages/vsftpd-\\t")]),s._v(" "),t("p",[s._v("⑵准备匿名ftp访问目录，并开放权限")]),s._v(" "),t("p",[s._v("chown ftp /var/ftp/pub")]),s._v(" "),t("p",[s._v("ls -ld /var/ftp/pub")]),s._v(" "),t("p",[s._v("⑶编辑ftp配置文件")]),s._v(" "),t("p",[s._v("anonymous_enable=yes")]),s._v(" "),t("p",[s._v("local_enable=no")]),s._v(" "),t("p",[s._v("write_enable=yes")]),s._v(" "),t("p",[s._v("anon_umask=022")]),s._v(" "),t("p",[s._v("anon_upload_enable=yes")]),s._v(" "),t("p",[s._v("anon_mkdir_write_enable=yes")]),s._v(" "),t("p",[s._v("anon_other_write_enable=yes开放其他写入权")]),s._v(" "),t("p",[s._v("dirmessage_enable=yes")]),s._v(" "),t("p",[s._v("⑷启动服务")]),s._v(" "),t("p",[s._v("service vsftpd  start")]),s._v(" "),t("p",[s._v("⑸命令行进行验证")]),s._v(" "),t("p",[s._v("rpm -ivh  /media/packages/ftp-\\t")]),s._v(" "),t("p",[s._v("ftp：// 192.168.1.86")]),s._v(" "),t("h1",{attrs:{id:"构建本地访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建本地访问"}},[s._v("#")]),s._v(" 构建本地访问")]),s._v(" "),t("p",[s._v("思路：启动vsftpd.conf配置文件中本地用户，并进行相关配置，然后重新加载配置；编辑user_list，添加用户，再重新加载。")]),s._v(" "),t("p",[s._v("⑴安装ftp服务端软件，编辑配置文件")]),s._v(" "),t("p",[s._v("local_enable=yes")]),s._v(" "),t("p",[s._v("write_enable=yes")]),s._v(" "),t("p",[s._v("local_umask=077")]),s._v(" "),t("p",[s._v("chroot_local_user=yes")]),s._v(" "),t("p",[s._v("⑵重新加载服务配置文件")]),s._v(" "),t("p",[s._v("service vsftpd reload")]),s._v(" "),t("p",[s._v("⑶启用user_list列表并向user_list添加用户")]),s._v(" "),t("p",[s._v("vi /etc/vsftpd/vsftpd.conf")]),s._v(" "),t("p",[s._v("userlist_enable=yes")]),s._v(" "),t("p",[s._v("userlist_deny=no")]),s._v(" "),t("p",[s._v("cat  an  >>/etc/vsftpd/user_list")]),s._v(" "),t("p",[s._v("⑷重新加载服务配置文件")]),s._v(" "),t("p",[s._v("service vsftpd reload")]),s._v(" "),t("p",[s._v("⑸windows客户端访问")]),s._v(" "),t("p",[s._v("ftp://192.168.1.86")]),s._v(" "),t("h1",{attrs:{id:"构建基于虚拟用户的ftp服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建基于虚拟用户的ftp服务"}},[s._v("#")]),s._v(" 构建基于虚拟用户的ftp服务")]),s._v(" "),t("p",[s._v("创建帐号数据")]),s._v(" "),t("p",[s._v("1 建立虚拟ftp用户的帐号数据 库文件")]),s._v(" "),t("p",[s._v("2 创建ftp根目录及虚拟用户映射的系统用户")]),s._v(" "),t("p",[s._v("3 建立支持虚拟用户的pam认证文件")]),s._v(" "),t("p",[s._v("添加虚拟用户支持")]),s._v(" "),t("p",[s._v("1在vsftpd.conf文件中添加支持配置")]),s._v(" "),t("p",[s._v("2为个别虚拟用户建立独立的配置文件")]),s._v(" "),t("p",[s._v("启动服务并测试")]),s._v(" "),t("p",[s._v("1重新加载vsftpd配置")]),s._v(" "),t("p",[s._v("2使用虚拟ftp帐户访问测试")]),s._v(" "),t("p",[s._v("⑴建立虚拟ftp用户的帐号数据库文件")]),s._v(" "),t("p",[s._v("vi /etc/vsftpd/vuser.list")]),s._v(" "),t("p",[s._v("mike")]),s._v(" "),t("p",[s._v("123")]),s._v(" "),t("p",[s._v("tom")]),s._v(" "),t("p",[s._v("456")]),s._v(" "),t("p",[s._v("jim")]),s._v(" "),t("p",[s._v("789")]),s._v(" "),t("p",[s._v("cd /etc/vsftpd/")]),s._v(" "),t("p",[s._v("db_load -T -t hash -f vuser.list vuser.db")]),s._v(" "),t("p",[s._v("注:db_load -t 允许应用程序能够将文本文件转译入数据库，由于我们之后是将虚拟用户的信息以文本方式存储在文件中，为了让vsftpd这个应用程序能够通过文本来载入用户数据，必须使用此选项。")]),s._v(" "),t("p",[s._v("如果指定了t就必须追加-t，用来指定转译时的加密算法，有btree,hash,queue,recon")]),s._v(" "),t("p",[s._v("-f指向包含用户名和密码的文本文件，奇名偶密，后跟要转换成的文件名。")]),s._v(" "),t("p",[s._v("file vuser.db")]),s._v(" "),t("p",[s._v("注：file命令用来查看文件的格式")]),s._v(" "),t("p",[s._v("chmod 600 /etc/vsftpd/vuser.*")]),s._v(" "),t("p",[s._v("注：可能是600，否则认证会出错")]),s._v(" "),t("p",[s._v("ls  /etc/vsftpd/vuser.*")]),s._v(" "),t("p",[s._v("⑵创建帐号数据")]),s._v(" "),t("p",[s._v("创建ftp根目录及虚拟用户映射的系统用户")]),s._v(" "),t("p",[s._v("useradd -d /var/ftproot -s /sbin/nologin  virtual")]),s._v(" "),t("p",[s._v("chmod  755 /var/ftproot")]),s._v(" "),t("p",[s._v("⑶建立支持虚拟用户的pam认证文件")]),s._v(" "),t("p",[s._v("vi  /etc/pam.d/vsftpd.vu")]),s._v(" "),t("p",[s._v("#%pam-1.0")]),s._v(" "),t("p",[s._v("auth  required  pam_userdb.so db=/etc/vsftpd/vuser")]),s._v(" "),t("p",[s._v("account required pam_userdb.so db=/etc/vsftpd/vuser")]),s._v(" "),t("p",[s._v("注：pam为linux的认证模块")]),s._v(" "),t("p",[s._v("⑷在vsftpd.conf文件中添加支持配置")]),s._v(" "),t("p",[s._v("vi /etc/vsftpd/vsftpd.conf")]),s._v(" "),t("p",[s._v("local_enable=yes")]),s._v(" "),t("p",[s._v("write_enable=yes")]),s._v(" "),t("p",[s._v("anon_umask=022")]),s._v(" "),t("p",[s._v("guest_enable=yes         启用用户映射功能")]),s._v(" "),t("p",[s._v("guest_username=virtual     指定映射的系统用户名称")]),s._v(" "),t("p",[s._v("pam_service_name=vsftpd.vu    指定新的pam认证文件")]),s._v(" "),t("p",[s._v("⑸为不同的虚拟用户建立独立的配置文件")]),s._v(" "),t("p",[s._v("在vsftpd.conf文件中添加用户配置目录支持")]),s._v(" "),t("p",[s._v("user_config_dir=/etc/vsftpd/vuser_dir")]),s._v(" "),t("p",[s._v("为用户mike,john建立独立的配置目录及文件")]),s._v(" "),t("p",[s._v("注：配置文件名与用户名相同")]),s._v(" "),t("p",[s._v("mkdir /etc/vsftpd/vuser_dir/")]),s._v(" "),t("p",[s._v("cd /etc/vsftpd/vuser_dir/")]),s._v(" "),t("p",[s._v("vi john")]),s._v(" "),t("p",[s._v("anon_upload_enable=yes")]),s._v(" "),t("p",[s._v("anon_mkdir_enable=yes")]),s._v(" "),t("p",[s._v("touch mike")]),s._v(" "),t("p",[s._v("注:配置文件名与用户名相同")]),s._v(" "),t("p",[s._v("⑹重新加载vsftpd配置")]),s._v(" "),t("p",[s._v("service vsftpd reload")]),s._v(" "),t("p",[s._v("⑺使用虚拟ftp帐户访问测试")]),s._v(" "),t("p",[s._v("mike用户可以登录浏览下载但无法上传")]),s._v(" "),t("p",[s._v("john用户可以登录浏览下载也可以上传")]),s._v(" "),t("p",[s._v("匿名用户或其他系统用户将不能登录")]),s._v(" "),t("h1",{attrs:{id:"vsftpd报错"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftpd报错"}},[s._v("#")]),s._v(" vsftpd报错")]),s._v(" "),t("p",[s._v("登录vsftpd报530错误解决方法")]),s._v(" "),t("p",[s._v("（1）先创建了一个不允许登录系统但可以登录FTP服务器的用户：sudo useradd -d /var/www -s /sbin/nologin ftp1")]),s._v(" "),t("p",[s._v("（2）配置vsftpd服务器：sudo vi /etc/vsftpd.conf")]),s._v(" "),t("p",[s._v("可增加如下选项：userlist_deny=NO\nuserlist_enable=YES\nuserlist_file=/etc/vsftpd_userlist //允许登录服务器的账号列表文件")]),s._v(" "),t("p",[s._v("allow_writeable_chroot=YES //解决500 OOPS: vsftpd: refusing to run with writable root inside chroot() 错误")]),s._v(" "),t("p",[s._v("（3）创建vsftpd_userlist文件，并在里面加上ftp1")]),s._v(" "),t("p",[s._v("但在客户端登录vsftpd时报530 login incorret 错误，后上网搜索相关资料发现是PAM鉴权造成的，解决方法如下：")]),s._v(" "),t("p",[s._v("方法（1）：注释掉/etc/pam.d/vsftpd文件里这后一行：")]),s._v(" "),t("p",[s._v("auth  required    pam_shells.so，这样不去鉴权")]),s._v(" "),t("h1",{attrs:{id:"vsftpd配置文件参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftpd配置文件参考"}},[s._v("#")]),s._v(" vsftpd配置文件参考")]),s._v(" "),t("h4",{attrs:{id:"配置1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置1"}},[s._v("#")]),s._v(" 配置1")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[s._v("anonymous_enable=NO\n\nlocal_enable=YES\nwrite_enable=YES\nlocal_umask=022\nlocal_root=/home/admin/ftp\n\ndirmessage_enable=YES\nxferlog_enable=YES\nconnect_from_port_20=YES\nxferlog_std_format=YES\n\nlisten=YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#listen_ipv6=YES")]),s._v("\n\npam_service_name=vsftpd\nuserlist_enable=YES\ntcp_wrappers=YES\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置被动模式")]),s._v("\npasv_enable=yes\npasv_min_port=50000\npasv_max_port=60000\n\ndual_log_enable=YES\nvsftpd_log_file=/var/log/vsftpd.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h4",{attrs:{id:"配置2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置2"}},[s._v("#")]),s._v(" 配置2")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟用户设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用用户映射功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#guest_enable=yes          ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定映射的系统用户名称      ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#guest_username=virtual  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定新的pam认证文件        ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pam_service_name=vsftpd.vu ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户配置目录支持")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user_config_dir=/etc/vsftpd/vuser_dir")]),s._v("\n     \n\t \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用匿名访问")]),s._v("\nanonymous_enable=NO\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用匿名访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anonymous_enable=YES")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#匿名用户所上传文件的权限掩码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anon_umask=022")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#匿名用户的根目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anon_root=/var/ftp")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许上传文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anon_upload_enable=yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anon_mkdir_write_enable=yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注:只能创建,不能删除和重命名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开放其它写入权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anon_other_write_enable=yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注:可以删除和重命名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制最大传输速率(字节/秒)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#anon_max_rate=0")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否启用本地系统用户")]),s._v("\nlocal_enable=yes\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本地用户所上传文件的权限掩码")]),s._v("\nlocal_umask=022\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置本地用户的ftp根目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#local_root=/var/ftp/admin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否将用户禁锢在主目录")]),s._v("\nchroot_local_user=yes\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注：启用local一定要禁锢，否则如果用户权限够大，系统将面临风险。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否启用写入权限(上传)")]),s._v("\nwrite_enable=yes\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许下载文件")]),s._v("\ndownload_enable=yes\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制并发客户端连接数")]),s._v("\nmax_clients=0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置监听")]),s._v("\nlisten=yes\nlisten_port=21\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否启用user_list列表文件")]),s._v("\nuserlist_enable=yes\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否禁用user_list列表中的用户")]),s._v("\nuserlist_deny=no\n\nuserlist_file=/etc/vsftpd/user_list \n\nchroot_list_enable=yes\nchroot_list_file=/etc/vsftpd/chroot_list\nallow_writeable_chroot=YES\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置被动模式")]),s._v("\npasv_enable=yes\npasv_min_port=50000\npasv_max_port=60000\n     \nconnect_from_port_20=YES\npam_service_name=vsftpd\n\t \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br")])]),t("h1",{attrs:{id:"pure-ftpd安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pure-ftpd安装"}},[s._v("#")]),s._v(" pure-ftpd安装")]),s._v(" "),t("p",[s._v("访问 pure-ftpd 官方网站：")]),s._v(" "),t("p",[s._v("https://download.pureftpd.org/pub/pure-ftpd/releases/，当前最新版本为 1.0.47。")]),s._v(" "),t("p",[s._v("进入到要下载的目录：")]),s._v(" "),t("p",[s._v("[root@ryan plugins]# cd /usr/local/src")]),s._v(" "),t("p",[s._v("使用 wget 下载源码包：")]),s._v(" "),t("p",[s._v("[root@ryan src]# "),t("strong",[s._v("wget")]),s._v(" https://download.pureftpd.org/pub/pure-ftpd/releases/pure-ftpd-1.0.47.tar.gz")]),s._v(" "),t("p",[s._v("解压：")]),s._v(" "),t("p",[s._v("[root@ryan src]# "),t("strong",[s._v("tar zxvf")]),s._v(" pure-ftpd-1.0.47.tar.gz")]),s._v(" "),t("p",[s._v("进入解压后的目录：")]),s._v(" "),t("p",[s._v("[root@ryan src]# cd pure-ftpd-1.0.47")]),s._v(" "),t("p",[s._v("通过设置不同的参数，定制相应的功能，生成 Makefile 文件：")]),s._v(" "),t("p",[s._v("[root@ryan pure-ftpd-1.0.47]# *"),t("em",[s._v("./configure *")]),s._v("\n–prefix=/usr/local/pureftpd "),t("br"),s._v("\n–without-inetd "),t("br"),s._v("\n–with-altlog "),t("br"),s._v("\n–with-puredb "),t("br"),s._v("\n–with-throttling "),t("br"),s._v("\n–with-peruserlimits "),t("br"),s._v("\n–with-tls")]),s._v(" "),t("p",[s._v("注意：")]),s._v(" "),t("p",[s._v("我们在这里可能会遇到错误，在配置之后系统会提示：configure: error: OpenSSL headers not found.")]),s._v(" "),t("p",[s._v("解决方法是：")]),s._v(" "),t("p",[t("strong",[s._v("yum install -y openssl openssl-devel")]),s._v("，如果找不到这两个包，则需要安装 yum 的扩展源："),t("strong",[s._v("yum install -y epel-release")])]),s._v(" "),t("p",[s._v("注意：不要随意修改域名解析文件 "),t("strong",[s._v("/etc/resolv.conf")]),s._v("，否则可能导致 yum 源地址无法解析，而出现 "),t("strong",[s._v("[Errno 256] No more mirrors to try")]),s._v(" 。")]),s._v(" "),t("p",[s._v("/etc/resolv.conf 是 DNS 客户机配置文件，用于设置 DNS 服务器的 IP 地址及 DNS 域名，还包含了主机的域名搜索顺序。该文件是由域名解析 器（resolver，一个根据主机名解析IP地址的库）使用的配置文件。它的格式很简单，每行以一个关键字开头，后接一个或多个由空格隔开的参数。")]),s._v(" "),t("p",[s._v("编译并安装：")]),s._v(" "),t("p",[s._v("[root@ryan pure-ftpd-1.0.47]# "),t("strong",[s._v("make && make install")])]),s._v(" "),t("p",[s._v("验证上一步是否执行成功：")]),s._v(" "),t("p",[s._v("[root@ryan pure-ftpd-1.0.47]# "),t("strong",[s._v("echo $?")]),s._v("\n0")]),s._v(" "),t("p",[s._v("这里返回值是”0″说明执行成功，否则就是没有成功。")]),s._v(" "),t("p",[t("strong",[s._v("2.3 修改配置文件")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[s._v("vim /usr/local/pureftpd/etc/pure-ftpd.conf \n\nChrootEveryone              yes\nBrokenClientsCompatibility  no\nMaxClientsNumber            50\nDaemonize                   yes\nMaxClientsPerIP             8\nVerboseLog                  no\nDisplayDotFiles             yes\nAnonymousOnly               no\nNoAnonymous                 no\nSyslogFacility              ftp\nDontResolve                 yes\nMaxIdleTime                 15\nPureDB                       /usr/local/pureftpd/etc/pureftpd.pdb\nLimitRecursion              10000 8\nAnonymousCanCreateDirs      no\nMaxLoad                     4\nAntiWarez                   yes\nUmask                       133:022\nMinUID                      100\nAllowUserFXP                no\nAllowAnonymousFXP           no\nProhibitDotFilesWrite       no\nProhibitDotFilesRead        no\nAutoRename                  no\nAnonymousCantUpload         no\nPIDFile                      /usr/local/pureftpd/var/run/pure-ftpd.pid\nMaxDiskUsage                99\nCustomerProof               yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[t("strong",[s._v("三、使用 pure-ftpd")])]),s._v(" "),t("p",[s._v("启动 pure-ftpd：")]),s._v(" "),t("p",[s._v("[root@ryan pure-ftpd-1.0.47]# /usr/local/pureftpd/sbin/pure-ftpd /usr/local/pureftpd/etc/pure-ftpd.conf")]),s._v(" "),t("p",[s._v("创建系统用户：")]),s._v(" "),t("p",[s._v("useradd pure-ftp")]),s._v(" "),t("p",[s._v("更改所属主和所属组：")]),s._v(" "),t("p",[s._v("chown -R pure-ftp: pure-ftp /data0/www/www.***.com")]),s._v(" "),t("p",[s._v("创建ftp用户，注意ftp用户是虚拟用户。")]),s._v(" "),t("p",[s._v("/usr/local/pureftpd/bin/pure-pw useradd ftp_test -u pure-ftp -d /data0/www/www.***.com")]),s._v(" "),t("p",[s._v("此时会出现为该ftp新用户创建密码的提示：")]),s._v(" "),t("p",[s._v("Password:xxxxxx\nEnter it again:xxxxxx")]),s._v(" "),t("p",[s._v("其中，-u选项将虚拟用户ftp_test与系统用户 pure-ftp关联在一起，即使用ftp_test账号登录FTP后，会以 pure-ftp的身份来读取和下载文件，-d选项后面的目录为ftp_test账户的根目录，这样可以使ftp_test只能访问其根目录/data0/www/www.***.com")]),s._v(" "),t("p",[s._v("注意：一般情况下web网站的系统用户为www,为了保障ftp上传修改的文件和目录能够不影响网站系统的使用权限，可以把上面提到的pure-ftp改为www。这样ftp上传到服务器的文件属性就是www了。")]),s._v(" "),t("p",[s._v("创建用户信息数据库文件：")]),s._v(" "),t("p",[s._v("/usr/local/pureftpd/bin/pure-pw mkdb")]),s._v(" "),t("p",[s._v("查看用户列表：")]),s._v(" "),t("p",[s._v("/usr/local/pureftpd/bin/pure-pw list")]),s._v(" "),t("p",[s._v("显示如下：")]),s._v(" "),t("p",[s._v("ftp_test /data0/www/www.***.com/./")]),s._v(" "),t("p",[s._v("删除账号的命令为：")]),s._v(" "),t("p",[s._v("/usr/local/pureftpd/bin/pure-pw userdel ftp_test")])])}),[],!1,null,null,null);n.default=e.exports}}]);