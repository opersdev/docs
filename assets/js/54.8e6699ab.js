(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{548:function(e,t,n){"use strict";n.r(t);var _=n(22),o=Object(_.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[n("strong",[e._v("MySQLdump备份失败以及解决方法汇总")])]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Error: Query execution was interrupted, maximum statement execution time exceeded when trying to dump tablespaces")]),e._v(" "),n("strong",[e._v("〇 mysqldump: Error 3024: Query execution was interrupted, maximum statement execution time exceeded when dumping table "),n("code",[e._v("$tb_name")]),e._v(" at row: xxxx")])]),e._v(" "),n("p",[n("strong",[e._v("版本：")]),e._v("\nMySQL 5.7.8+\n"),n("strong",[e._v("原因：")]),e._v("\nmax_execution_time过小\n"),n("strong",[e._v("处理思路：")]),e._v("\n① 通过hints，增大N值（文档说，在hints用法中，将N改为0为无限制，但我测下来不生效，可设置成一个较大值如999999解决）\nSELECT /*+ MAX_EXECUTION_TIME(N) */ * FROM t1 LIMIT 100000;\n② 修改max_execution_time值，将该值设置为较大一个值，或设置为0（不限制）\n附录：\n该参数5.7.8被添加，单位为ms，动态参数，默认为0，设置为0时意味着SELECT超时不被设置（不限制超时时间）。不作用于存储过程中的SELECT语句，并且只作用于只读的SELECT，如INSERT ... SELECT ... 是不被作用的。\n"),n("strong",[e._v("for more information:")])]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldnt execute SHOW FIELDS FROM "),n("code",[e._v("$view_name")]),e._v(": View $db_name.$view_name references invalid table(s) or column(s) or function(s) or definer/invoker of view lack rights to use them (1356)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n该view引用了无效的表，列，函数或者定义者。\n"),n("strong",[e._v("处理思路：")]),e._v("\n可以根据报错信息，进入db，执行SHOW CREATE VIEW $view_name\\G，查看该view的定义，逐一检查该view的基表，列，或相关函数与用户是否具有相关权限。考虑重建或删除视图。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldnt execute show create table "),n("code",[e._v("$view_name")]),e._v(": Illegal mix of collations for operation UNION (1271)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n创建view时，使用UNION时存在非法的排序规则组合。\n"),n("strong",[e._v("处理思路：")]),e._v("\n检查该视图定义，检查字符集，考虑重建或删除视图。")]),e._v(" "),n("p",[e._v("**")]),e._v(" "),n("p",[n("strong",[e._v("〇")]),e._v(" "),n("strong",[e._v("mysqldump: Couldnt execute SHOW FIELDS FROM "),n("code",[e._v("$view_name")]),e._v(": The user specified as a definer ($user@$host) does not exist (1449)")]),e._v(" "),n("strong",[e._v("〇 mysqldump: Couldnt execute show table status like $view_name: SELECT command denied to user @% for column $col_name in table $tb_name (1143)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n该视图的定义者$user@$host不存在。\n"),n("strong",[e._v("处理思路：")]),e._v("\n检查mysql.user表，确认用户是否存在，考虑重建或删除视图。")]),e._v(" "),n("p",[n("strong",[e._v("〇 Error: Couldnt read status information for table Income_config ()mysqldump: Couldnt execute show create table "),n("code",[e._v("Tser_table")]),e._v(": Table $db_name.test_table doesnt exist (1146)")]),e._v(" "),n("strong",[e._v("〇 mysqldump: Got error: 1049: Unknown database $db_name when selecting the database")])]),e._v(" "),n("p",[n("strong",[e._v("原因一：")]),e._v("\n从lower_case_table_names的0设置成1，导致部分原来含有大写字母的库表“找不到”。\n"),n("strong",[e._v("处理思路：")]),e._v("\n将lower_case_table_names设置回0。\n若有必须将lower_case_table_names设置为1，需先设置为0，并将含有大写字母的库表改成小写，再设置为1。")]),e._v(" "),n("p",[n("strong",[e._v("原因二（MySQL 5.5及以下版本可能出现）：")]),e._v("\n表损坏导致该表找不到（InnoDB）。frm和ibd文件都在，但无法SHOW CREATE TABLE xxx\\G\nerror log一则：")]),e._v(" "),n("ol",[n("li",[e._v("170820 17:43:17 [Note] Event Scheduler: scheduler thread started with id 1")]),e._v(" "),n("li",[e._v("170820 17:44:48 InnoDB: error: space object of table '$db_name/$tb_name',")]),e._v(" "),n("li",[e._v("InnoDB: space id 4335 did not exist in memory. Retrying an open.")]),e._v(" "),n("li",[e._v("170820 17:44:48 InnoDB: Error: tablespace id and flags in file './$db_name/$tb_name.ibd' are 0 and 0, but in the InnoDB")]),e._v(" "),n("li",[e._v("InnoDB: data dictionary they are 4335 and 0.")]),e._v(" "),n("li",[e._v("InnoDB: Have you moved InnoDB .ibd files around without using the")]),e._v(" "),n("li",[e._v("InnoDB: commands DISCARD TABLESPACE and IMPORT TABLESPACE?")]),e._v(" "),n("li",[e._v("InnoDB: Please refer to")]),e._v(" "),n("li",[e._v("InnoDB: http://dev.mysql.com/doc/refman/5.5/en/innodb-troubleshooting-datadict.html")]),e._v(" "),n("li",[e._v("InnoDB: for how to resolve the issue.")]),e._v(" "),n("li",[e._v("170820 17:44:48 InnoDB: cannot calculate statistics for table $db_name/$tb_name")]),e._v(" "),n("li",[e._v("InnoDB: because the .ibd file is missing. For help, please refer to")]),e._v(" "),n("li",[e._v("InnoDB: http://dev.mysql.com/doc/refman/5.5/en/innodb-troubleshooting.html")]),e._v(" "),n("li",[e._v("170820 17:44:48 [ERROR] MySQL is trying to open a table handle but the .ibd file for")]),e._v(" "),n("li",[e._v("table $db_name/$tb_name does not exist.")]),e._v(" "),n("li",[e._v("Have you deleted the .ibd file from the database directory under")]),e._v(" "),n("li",[e._v("the MySQL datadir, or have you used DISCARD TABLESPACE?")]),e._v(" "),n("li",[e._v("See http://dev.mysql.com/doc/refman/5.5/en/innodb-troubleshooting.html")]),e._v(" "),n("li",[e._v("how you can resolve the problem.")])]),e._v(" "),n("p",[n("strong",[e._v("处理思路：")]),e._v("\n从完整备份+binlog还原，对于有主或从的实例，可通过物理备份还原。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Error 2020: Got packet bigger than max_allowed_packet bytes when dumping table "),n("code",[e._v("$tb_name")]),e._v(" at row: xxxx")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n默认的max_allowed_packet过小\n"),n("strong",[e._v("处理思路：")]),e._v("\n在mysqldump时增加max_allowed_packet的大小，如mysqldump --max-allowed-packet=268435456")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Error 1412: Table definition has changed, please retry transaction when dumping table "),n("code",[e._v("$tb_name")]),e._v(" at row: 0")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n在备份该表时，表定义被修改。FLUSH TABLE WITH READ LOCK只保证数据一致性，并不保证schema不被修改。\n"),n("strong",[e._v("处理思路：")]),e._v("\n备份时期不做DDL操作。\n"),n("strong",[e._v("复现一：")])]),e._v(" "),n("ol",[n("li",[e._v("① session1> CREATE TABLE a (id int) ENGINE=InnoDB;")]),e._v(" "),n("li",[e._v("② session2> START TRANSACTION WITH CONSISTENT SNAPSHOT;")]),e._v(" "),n("li",[e._v("③ session1> ALTER TABLE a ADD COLUMN name varchar(32);")]),e._v(" "),n("li",[e._v("④ session2> SELECT * FROM a;")]),e._v(" "),n("li",[e._v("ERROR 1412 (HY000): Table definition has changed, please retry transaction")])]),e._v(" "),n("p",[e._v("p.s. 如果③和④调换顺序，则ALTER TABLE无法成功，则会等待MDL。\n"),n("strong",[e._v("复现二：")])]),e._v(" "),n("ol",[n("li",[e._v("① session1> START TRANSACTION WITH CONSISTENT SNAPSHOT;")]),e._v(" "),n("li",[e._v("② session2> CREATE TABLE b (id int) ENGINE=InnoDB;")]),e._v(" "),n("li",[e._v("③ session1> SELECT * FROM b;")]),e._v(" "),n("li",[e._v("ERROR 1412 (HY000): Table definition has changed, please retry transaction")])]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldnt execute show create table "),n("code",[e._v("$tb_name")]),e._v(": Unable to open underlying table which is differently defined or of non-MyISAM type or doesnt exist (1168)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n出现在表引擎为MERGE时，备份到该表时，发现该表定义存在问题。可能merge的表不存在，或者该表合并的基表包含非MyISAM引擎的表。\n"),n("strong",[e._v("处理思路：")]),e._v("\n删除或者重建该MERGE表。\n"),n("strong",[e._v("复现一（merge表中定义包含了非MyISAM表）：")])]),e._v(" "),n("ol",[n("li",[e._v("CREATE TABLE t1(id int) ENGINE=InnoDB;")]),e._v(" "),n("li",[e._v("CREATE TABLE t2(id int) ENGINE=MyISAM;")]),e._v(" "),n("li",[e._v("CREATE TABLE merge_t(id int)ENGINE=MERGE UNION=(t1, t2);")]),e._v(" "),n("li",[e._v("SELECT * FROM merge_t;")]),e._v(" "),n("li",[e._v("ERROR 1168 (HY000): Unable to open underlying table which is differently defined or of non-MyISAM type or doesn't exist")])]),e._v(" "),n("p",[n("strong",[e._v("复现二（表不存在）：")])]),e._v(" "),n("ol",[n("li",[e._v("CREATE TABLE t1(id int) ENGINE=MyISAM;")]),e._v(" "),n("li",[e._v("CREATE TABLE t2(id int) ENGINE=MyISAM;")]),e._v(" "),n("li",[e._v("CREATE TABLE merge_t(id int)ENGINE=MERGE UNION=(t1, t2);")]),e._v(" "),n("li",[e._v("SELECT * FROM merge_t;")]),e._v(" "),n("li",[e._v("Empty set (0.00 sec)  -- 正常返回")]),e._v(" "),n("li",[e._v("DROP TABLE t1;")]),e._v(" "),n("li",[e._v("SELECT * FROM merge_t;")]),e._v(" "),n("li",[e._v("ERROR 1168 (HY000): Unable to open underlying table which is differently defined or of non-MyISAM type or doesn't exist")])]),e._v(" "),n("p",[n("strong",[e._v("附录：")]),e._v("\n通过check table merge_t可以检查是哪张表有问题，如此处是t1：")]),e._v(" "),n("ol",[n("li",[e._v("[15:20:12] root@localhost [test]> check table merge_t\\G")]),e._v(" "),n("li",[e._v("*************************** 1. row ***************************")]),e._v(" "),n("li",[e._v("Table: test.merge_t")]),e._v(" "),n("li",[e._v("Op: check")]),e._v(" "),n("li",[e._v("Msg_type: Error")]),e._v(" "),n("li",[e._v("Msg_text: Table 'test.t1' is differently defined or of non-MyISAM type or doesn't exist")]),e._v(" "),n("li",[e._v("*************************** 2. row ***************************")]),e._v(" "),n("li",[e._v("Table: test.merge_t")]),e._v(" "),n("li",[e._v("Op: check")]),e._v(" "),n("li",[e._v("Msg_type: Error")]),e._v(" "),n("li",[e._v("Msg_text: Unable to open underlying table which is differently defined or of non-MyISAM type or doesn't exist")]),e._v(" "),n("li",[e._v("*************************** 3. row ***************************")]),e._v(" "),n("li",[e._v("Table: test.merge_t")]),e._v(" "),n("li",[e._v("Op: check")]),e._v(" "),n("li",[e._v("Msg_type: error")]),e._v(" "),n("li",[e._v("Msg_text: Corrupt")]),e._v(" "),n("li",[e._v("3 rows in set (0.00 sec)")])]),e._v(" "),n("p",[e._v("通过cat表MGR定义结构文件可以检查MERGE表的基表：")]),e._v(" "),n("ol",[n("li",[e._v("[root@host test]# pwd")]),e._v(" "),n("li",[e._v("/data/mysql-data/mysql57/data/test")]),e._v(" "),n("li",[e._v("[root@host test]# cat merge_t.MRG")]),e._v(" "),n("li",[e._v("t1")]),e._v(" "),n("li",[e._v("t2")])]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldnt execute show create table "),n("code",[e._v("$tb_name")]),e._v(": Table ./$db_name/$tb_name is marked as crashed and last (automatic?) repair failed (144)")]),e._v(" "),n("strong",[e._v("〇 mysqldump: Couldnt execute show create table "),n("code",[e._v("$tb_name")]),e._v(": Table ./$db_name/$tb_name is marked as crashed and should be repaired (145)")]),e._v(" "),n("strong",[e._v("〇 mysqldump: Error 1194: Table throne_tower is marked as crashed and should be repaired when dumping table "),n("code",[e._v("$tb_name")]),e._v(" at row: xxxxx")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\nmysqldump在拉取表定义时报错，表损坏。\n"),n("strong",[e._v("处理思路：")]),e._v("\n该损坏发生在非事务表如MyISAM，通过mysqlcheck或者repair table修复即可。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldnt execute SHOW FUNCTION STATUS WHERE Db = $db_name: Cannot load from mysql.$tb_name. The table is probably corrupted (1728)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n字典表不正确，可能是表本身损坏，也有可能是导入了其他版本的mysql schema盖掉了字典表。\n"),n("strong",[e._v("处理思路：")]),e._v("\nrepair table修复，若仍无用，则可以尝试mysql_upgrade来修复，或找到对应版本的mysql_system_tables_fix.sql来导入。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldnt execute show events: Cannot proceed because system tables used by Event Scheduler were found damaged at server start (1577)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n字典表不正确，极大可能是导入了其他版本的mysql schema盖掉了字典表。\n"),n("strong",[e._v("处理思路：")]),e._v("\n尝试mysql_upgrade来修复，或找到对应版本的mysql_system_tables_fix.sql来导入。该报错可能在upgrade操作之后重启实例。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Error: Got error 28 from storage engine when trying to dump tablespaces")]),e._v(" "),n("strong",[e._v("mysqldump: Couldnt execute show fields from "),n("code",[e._v("$tb_name")]),e._v(": Got error 28 from storage engine (1030)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\n@@tmpdir满了。\n"),n("strong",[e._v("处理思路：")]),e._v("\n清除@@tmpdir，可以通过SELECT @@tmpdir;检查具体目录。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Lost connection to MySQL server during query (2013)")]),e._v(" "),n("strong",[e._v("ERROR 2002 (HY000): Can't connect to local MySQL server through socket '@@socket' (111)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\nmysqldump执行过程中mysqld被关闭。\n"),n("strong",[e._v("处理思路：")]),e._v("\n检查mysqld被关闭的原因，一般常见原因是发生OOM。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldn't execute 'SHOW SLAVE STATUS': Access denied; you need (at least one of) the SUPER, REPLICATION CLIENT privilege(s) for this operation (1227)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\nmysqldump加了--dump-slave参数，缺少SUPER或REPLICATION CLIENT来执行SHOW SLAVE STATUS。\n"),n("strong",[e._v("处理思路：")]),e._v("\n检查mysqldump的用户权限。")]),e._v(" "),n("p",[n("strong",[e._v("〇 mysqldump: Couldn't execute 'STOP SLAVE SQL_THREAD': Access denied for user 'dump'@'localhost' (using password: YES) (1045)")])]),e._v(" "),n("p",[n("strong",[e._v("原因：")]),e._v("\nmysqldump加了--dump-slave参数，缺少SUPER权限使用STOP SLAVE SQL_THREAD。\n"),n("strong",[e._v("处理思路：")]),e._v("\n检查mysqldump的用户权限。")])])}),[],!1,null,null,null);t.default=o.exports}}]);