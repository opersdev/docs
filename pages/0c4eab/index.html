<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>shell正则表达式 | 小诺文档中心</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <meta name="description" content="运维技术文档,mysql,k8s,docker,linux,shell,python等技术文章。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="运维技术文档,mysql,k8s,docker,linux,shell,python,技术文档,学习,面试,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.92233c96.css" as="style"><link rel="preload" href="/assets/js/app.38f1b0a4.js" as="script"><link rel="preload" href="/assets/js/2.6beb1dc7.js" as="script"><link rel="preload" href="/assets/js/13.161be064.js" as="script"><link rel="prefetch" href="/assets/js/10.4365b950.js"><link rel="prefetch" href="/assets/js/100.8dac6c81.js"><link rel="prefetch" href="/assets/js/101.a5556ac1.js"><link rel="prefetch" href="/assets/js/102.e3ff38b9.js"><link rel="prefetch" href="/assets/js/103.3bcf44f5.js"><link rel="prefetch" href="/assets/js/104.6d56e53e.js"><link rel="prefetch" href="/assets/js/105.4fc9762e.js"><link rel="prefetch" href="/assets/js/106.f507561a.js"><link rel="prefetch" href="/assets/js/107.6c94c756.js"><link rel="prefetch" href="/assets/js/108.f7ff1945.js"><link rel="prefetch" href="/assets/js/109.aeb1e532.js"><link rel="prefetch" href="/assets/js/11.fe1ff844.js"><link rel="prefetch" href="/assets/js/110.dda67b83.js"><link rel="prefetch" href="/assets/js/111.5b990f24.js"><link rel="prefetch" href="/assets/js/112.0a27d3a0.js"><link rel="prefetch" href="/assets/js/113.972cd001.js"><link rel="prefetch" href="/assets/js/114.875814a1.js"><link rel="prefetch" href="/assets/js/115.ec235d59.js"><link rel="prefetch" href="/assets/js/116.03bd2386.js"><link rel="prefetch" href="/assets/js/117.68765825.js"><link rel="prefetch" href="/assets/js/118.9d6d0255.js"><link rel="prefetch" href="/assets/js/119.ff84a82f.js"><link rel="prefetch" href="/assets/js/12.aa21f453.js"><link rel="prefetch" href="/assets/js/120.20639785.js"><link rel="prefetch" href="/assets/js/121.6c546150.js"><link rel="prefetch" href="/assets/js/122.48e85de5.js"><link rel="prefetch" href="/assets/js/123.fc931745.js"><link rel="prefetch" href="/assets/js/124.797d5fda.js"><link rel="prefetch" href="/assets/js/125.b23a31c7.js"><link rel="prefetch" href="/assets/js/126.d7a182fd.js"><link rel="prefetch" href="/assets/js/127.167a63d6.js"><link rel="prefetch" href="/assets/js/128.878d4a7e.js"><link rel="prefetch" href="/assets/js/129.a8957dfa.js"><link rel="prefetch" href="/assets/js/130.3961a295.js"><link rel="prefetch" href="/assets/js/131.9c4e7a56.js"><link rel="prefetch" href="/assets/js/132.41d26584.js"><link rel="prefetch" href="/assets/js/133.6d91047e.js"><link rel="prefetch" href="/assets/js/134.121ecf0e.js"><link rel="prefetch" href="/assets/js/135.6e30234c.js"><link rel="prefetch" href="/assets/js/136.6fab7ce4.js"><link rel="prefetch" href="/assets/js/137.209af36e.js"><link rel="prefetch" href="/assets/js/138.660f236e.js"><link rel="prefetch" href="/assets/js/139.81c29d19.js"><link rel="prefetch" href="/assets/js/14.d0f13635.js"><link rel="prefetch" href="/assets/js/140.d8f594ca.js"><link rel="prefetch" href="/assets/js/141.89fbea1c.js"><link rel="prefetch" href="/assets/js/142.643bccec.js"><link rel="prefetch" href="/assets/js/143.f270bffc.js"><link rel="prefetch" href="/assets/js/144.cf6f4c9a.js"><link rel="prefetch" href="/assets/js/145.093699b5.js"><link rel="prefetch" href="/assets/js/146.876575d0.js"><link rel="prefetch" href="/assets/js/147.dc120635.js"><link rel="prefetch" href="/assets/js/148.4a3ba80f.js"><link rel="prefetch" href="/assets/js/149.4afb7469.js"><link rel="prefetch" href="/assets/js/15.af46dbb5.js"><link rel="prefetch" href="/assets/js/150.4eb38cf2.js"><link rel="prefetch" href="/assets/js/151.4fe6a931.js"><link rel="prefetch" href="/assets/js/16.4cbf8beb.js"><link rel="prefetch" href="/assets/js/17.1da2b6ae.js"><link rel="prefetch" href="/assets/js/18.0402bfbf.js"><link rel="prefetch" href="/assets/js/19.230bfe93.js"><link rel="prefetch" href="/assets/js/20.0d20ddb2.js"><link rel="prefetch" href="/assets/js/21.9dbdbc8b.js"><link rel="prefetch" href="/assets/js/22.1410508d.js"><link rel="prefetch" href="/assets/js/23.63089216.js"><link rel="prefetch" href="/assets/js/24.e6fe9306.js"><link rel="prefetch" href="/assets/js/25.1240d0c9.js"><link rel="prefetch" href="/assets/js/26.0f4fb46d.js"><link rel="prefetch" href="/assets/js/27.5b193a22.js"><link rel="prefetch" href="/assets/js/28.90e27733.js"><link rel="prefetch" href="/assets/js/29.cdb75f6c.js"><link rel="prefetch" href="/assets/js/3.1229de89.js"><link rel="prefetch" href="/assets/js/30.23c0524a.js"><link rel="prefetch" href="/assets/js/31.bc292e1e.js"><link rel="prefetch" href="/assets/js/32.79645dcf.js"><link rel="prefetch" href="/assets/js/33.53e29142.js"><link rel="prefetch" href="/assets/js/34.7ce01d2e.js"><link rel="prefetch" href="/assets/js/35.bcdc888c.js"><link rel="prefetch" href="/assets/js/36.00ce19aa.js"><link rel="prefetch" href="/assets/js/37.e53fea30.js"><link rel="prefetch" href="/assets/js/38.1b84e50f.js"><link rel="prefetch" href="/assets/js/39.ed0470cb.js"><link rel="prefetch" href="/assets/js/4.93dbb352.js"><link rel="prefetch" href="/assets/js/40.010f2420.js"><link rel="prefetch" href="/assets/js/41.7aefa9d2.js"><link rel="prefetch" href="/assets/js/42.eadeaa1f.js"><link rel="prefetch" href="/assets/js/43.012419aa.js"><link rel="prefetch" href="/assets/js/44.aa86bffd.js"><link rel="prefetch" href="/assets/js/45.b7ce8c1a.js"><link rel="prefetch" href="/assets/js/46.bd51c47b.js"><link rel="prefetch" href="/assets/js/47.71d2a52e.js"><link rel="prefetch" href="/assets/js/48.71b9430b.js"><link rel="prefetch" href="/assets/js/49.d92deee5.js"><link rel="prefetch" href="/assets/js/5.9228d2a8.js"><link rel="prefetch" href="/assets/js/50.2827e7a9.js"><link rel="prefetch" href="/assets/js/51.94c41d82.js"><link rel="prefetch" href="/assets/js/52.73681932.js"><link rel="prefetch" href="/assets/js/53.4db7ebcf.js"><link rel="prefetch" href="/assets/js/54.8e6699ab.js"><link rel="prefetch" href="/assets/js/55.3d832a8c.js"><link rel="prefetch" href="/assets/js/56.43282683.js"><link rel="prefetch" href="/assets/js/57.ea8d4f37.js"><link rel="prefetch" href="/assets/js/58.12ff8ca5.js"><link rel="prefetch" href="/assets/js/59.47100612.js"><link rel="prefetch" href="/assets/js/6.341b2c5d.js"><link rel="prefetch" href="/assets/js/60.914e7e2d.js"><link rel="prefetch" href="/assets/js/61.d9414480.js"><link rel="prefetch" href="/assets/js/62.a3747f73.js"><link rel="prefetch" href="/assets/js/63.1a2e54c1.js"><link rel="prefetch" href="/assets/js/64.d9f9224a.js"><link rel="prefetch" href="/assets/js/65.53e3f7bd.js"><link rel="prefetch" href="/assets/js/66.92d44566.js"><link rel="prefetch" href="/assets/js/67.67aba1d2.js"><link rel="prefetch" href="/assets/js/68.acce7dfb.js"><link rel="prefetch" href="/assets/js/69.3dacbd45.js"><link rel="prefetch" href="/assets/js/7.3d063b98.js"><link rel="prefetch" href="/assets/js/70.b40c0f61.js"><link rel="prefetch" href="/assets/js/71.51b34635.js"><link rel="prefetch" href="/assets/js/72.498f4ff0.js"><link rel="prefetch" href="/assets/js/73.b22c0978.js"><link rel="prefetch" href="/assets/js/74.823f2a12.js"><link rel="prefetch" href="/assets/js/75.d24d261d.js"><link rel="prefetch" href="/assets/js/76.44db605e.js"><link rel="prefetch" href="/assets/js/77.efce42e9.js"><link rel="prefetch" href="/assets/js/78.11405a06.js"><link rel="prefetch" href="/assets/js/79.9f0076d7.js"><link rel="prefetch" href="/assets/js/8.812a9a47.js"><link rel="prefetch" href="/assets/js/80.4fc1dc52.js"><link rel="prefetch" href="/assets/js/81.f8963444.js"><link rel="prefetch" href="/assets/js/82.627d5503.js"><link rel="prefetch" href="/assets/js/83.49c45765.js"><link rel="prefetch" href="/assets/js/84.b2045805.js"><link rel="prefetch" href="/assets/js/85.420cfd4a.js"><link rel="prefetch" href="/assets/js/86.06ff7ec2.js"><link rel="prefetch" href="/assets/js/87.4dfb234a.js"><link rel="prefetch" href="/assets/js/88.079f044f.js"><link rel="prefetch" href="/assets/js/89.bb76f78f.js"><link rel="prefetch" href="/assets/js/9.8be13208.js"><link rel="prefetch" href="/assets/js/90.ae61c8f3.js"><link rel="prefetch" href="/assets/js/91.8728eb6a.js"><link rel="prefetch" href="/assets/js/92.0d8581e8.js"><link rel="prefetch" href="/assets/js/93.e05baea5.js"><link rel="prefetch" href="/assets/js/94.c661a216.js"><link rel="prefetch" href="/assets/js/95.5414604a.js"><link rel="prefetch" href="/assets/js/96.529def2c.js"><link rel="prefetch" href="/assets/js/97.fb2d6168.js"><link rel="prefetch" href="/assets/js/98.69e544d7.js"><link rel="prefetch" href="/assets/js/99.a7993a79.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92233c96.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="小诺文档中心" class="logo"> <span class="site-name can-hide">小诺文档中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://opersdev.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小诺博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/devops/" class="nav-link">DevOps</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">云原生</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/wzdh/" class="nav-link">网址导航</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/opersdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/opersdev/docs/img/touxiang.jpg"> <div class="blogger-info"><h3>kevin</h3> <span>运维界的菜鸟</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://opersdev.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小诺博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/devops/" class="nav-link">DevOps</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">云原生</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/wzdh/" class="nav-link">网址导航</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/opersdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>shell编程</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8a368c/" class="sidebar-link">shell编程</a></li><li><a href="/pages/0c4eab/" aria-current="page" class="active sidebar-link">shell正则表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#正则表达式的分类" class="sidebar-link">正则表达式的分类</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#基本组成部分" class="sidebar-link">基本组成部分</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#posix字符类" class="sidebar-link">POSIX字符类</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#元字符" class="sidebar-link">元字符</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#awk命令格式和选项" class="sidebar-link">awk命令格式和选项</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#awk模式和操作" class="sidebar-link">awk模式和操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#模式" class="sidebar-link">模式</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#操作" class="sidebar-link">操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#awk脚本基本结构" class="sidebar-link">awk脚本基本结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#awk的工作原理" class="sidebar-link">awk的工作原理</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#awk内置变量-预定义变量" class="sidebar-link">awk内置变量（预定义变量）</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#将外部变量值传递给awk" class="sidebar-link">将外部变量值传递给awk</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#awk运算与判断" class="sidebar-link">awk运算与判断</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#算术运算符" class="sidebar-link">算术运算符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#赋值运算符" class="sidebar-link">赋值运算符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#逻辑运算符" class="sidebar-link">逻辑运算符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#正则运算符" class="sidebar-link">正则运算符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#关系运算符" class="sidebar-link">关系运算符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#其它运算符" class="sidebar-link">其它运算符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#运算级优先级表" class="sidebar-link">运算级优先级表</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#awk高级输入输出" class="sidebar-link">awk高级输入输出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#读取下一条记录" class="sidebar-link">读取下一条记录</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#简单地读取一条记录" class="sidebar-link">简单地读取一条记录</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#关闭文件" class="sidebar-link">关闭文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#输出到一个文件" class="sidebar-link">输出到一个文件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#设置字段定界符" class="sidebar-link">设置字段定界符</a></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#流程控制语句" class="sidebar-link">流程控制语句</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#条件判断语句" class="sidebar-link">条件判断语句</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#循环语句" class="sidebar-link">循环语句</a></li><li class="sidebar-sub-header level4"><a href="/pages/0c4eab/#while语句" class="sidebar-link">while语句</a></li><li class="sidebar-sub-header level4"><a href="/pages/0c4eab/#for循环" class="sidebar-link">for循环</a></li><li class="sidebar-sub-header level4"><a href="/pages/0c4eab/#do循环" class="sidebar-link">do循环</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#其他语句" class="sidebar-link">其他语句</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#数组应用" class="sidebar-link">数组应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#数组的定义" class="sidebar-link">数组的定义</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#数组相关函数" class="sidebar-link">数组相关函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#二维、多维数组使用" class="sidebar-link">二维、多维数组使用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#内置函数" class="sidebar-link">内置函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#算术函数" class="sidebar-link">算术函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#字符串函数" class="sidebar-link">字符串函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#一般函数" class="sidebar-link">一般函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#时间函数" class="sidebar-link">时间函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#选项" class="sidebar-link">选项</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#grep命令常见用法" class="sidebar-link">grep命令常见用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#grep递归搜索文件" class="sidebar-link">grep递归搜索文件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#sed的选项、命令、替换标记" class="sidebar-link">sed的选项、命令、替换标记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#选项-2" class="sidebar-link">选项</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#参数" class="sidebar-link">参数</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#sed命令-2" class="sidebar-link">sed命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#sed替换标记" class="sidebar-link">sed替换标记</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#sed元字符集" class="sidebar-link">sed元字符集</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0c4eab/#sed用法实例" class="sidebar-link">sed用法实例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#替换操作-s命令" class="sidebar-link">替换操作：s命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#全面替换标记g" class="sidebar-link">全面替换标记g</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#定界符" class="sidebar-link">定界符</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#删除操作-d命令" class="sidebar-link">删除操作：d命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#已匹配字符串标记" class="sidebar-link">已匹配字符串标记&amp;</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#子串匹配标记-1" class="sidebar-link">子串匹配标记\1</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#组合多个表达式" class="sidebar-link">组合多个表达式</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#引用" class="sidebar-link">引用</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#选定行的范围-逗号" class="sidebar-link">选定行的范围：,（逗号）</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#多点编辑-e命令" class="sidebar-link">多点编辑：e命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#从文件读入-r命令" class="sidebar-link">从文件读入：r命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#写入文件-w命令" class="sidebar-link">写入文件：w命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#追加-行下-a-命令" class="sidebar-link">追加（行下）：a\命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#插入-行上-i-命令" class="sidebar-link">插入（行上）：i\命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#下一个-n命令" class="sidebar-link">下一个：n命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#变形-y命令" class="sidebar-link">变形：y命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#退出-q命令" class="sidebar-link">退出：q命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#保持和获取-h命令和g命令" class="sidebar-link">保持和获取：h命令和G命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#保持和互换-h命令和x命令" class="sidebar-link">保持和互换：h命令和x命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#脚本scriptfile" class="sidebar-link">脚本scriptfile</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#打印奇数行或偶数行" class="sidebar-link">打印奇数行或偶数行</a></li><li class="sidebar-sub-header level3"><a href="/pages/0c4eab/#打印匹配字符串的下一行" class="sidebar-link">打印匹配字符串的下一行</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>消息队列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELK</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>自动化运维</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/devops/#DevOps" data-v-06225672>DevOps</a></li><li data-v-06225672><a href="/devops/#shell编程" data-v-06225672>shell编程</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/opersdev" target="_blank" title="作者" class="beLink" data-v-06225672>xiaonuo</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-06-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">shell正则表达式<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="shell正则表达式"><a href="#shell正则表达式" class="header-anchor">#</a> Shell正则表达式</h1> <h2 id="正则表达式的分类"><a href="#正则表达式的分类" class="header-anchor">#</a> 正则表达式的分类</h2> <ol><li>基本的正则表达式（Basic Regular Expression 又叫Basic RegEx 简称BREs）</li> <li>扩展的正则表达式（Extended Regular Expression 又叫Extended RegEx 简称EREs）</li> <li>Perl的正则表达式（Perl Regular Expression 又叫Perl RegEx 简称PREs）</li></ol> <h2 id="基本组成部分"><a href="#基本组成部分" class="header-anchor">#</a> 基本组成部分</h2> <p><img src="https://cdn.jsdelivr.net/gh/opersdev/image/i/2022/06/13/62a6e33e9513c.png" alt="image-20211015101626139"></p> <h2 id="posix字符类"><a href="#posix字符类" class="header-anchor">#</a> POSIX字符类</h2> <p>POSIX字符类是一个形如[:...:]的特殊元序列（meta sequence），他可以用于匹配特定的字符范围。</p> <p><img src="https://cdn.jsdelivr.net/gh/opersdev/image/i/2022/06/13/62a6e33ec94f4.png" alt="image-20211015101702787"></p> <h2 id="元字符"><a href="#元字符" class="header-anchor">#</a> 元字符</h2> <p>元字符（meta character）是一种Perl风格的正则表达式，只有一部分文本处理工具支持它，并不是所有的文本处理工具都支持。</p> <p><img src="https://cdn.jsdelivr.net/gh/opersdev/image/i/2022/06/13/62a6e33f088e4.png" alt="image-20211015101721596"></p> <h1 id="awk命令"><a href="#awk命令" class="header-anchor">#</a> awk命令</h1> <p><strong>awk</strong>是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入(stdin)、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk有很多内建的功能，比如数组、函数等，这是它和C语言的相同之处，灵活性是awk最大的优势。</p> <h2 id="awk命令格式和选项"><a href="#awk命令格式和选项" class="header-anchor">#</a> awk命令格式和选项</h2> <p><strong>语法形式</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk [options] 'script' var=value file(s)
awk [options] -f scriptfile var=value file(s)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>常用命令选项</strong></p> <ul><li><strong>-F fs</strong>  fs指定输入分隔符，fs可以是字符串或正则表达式，如-F:</li> <li><strong>-v var=value</strong>  赋值一个用户定义变量，将外部变量传递给awk</li> <li><strong>-f scripfile</strong>  从脚本文件中读取awk命令</li> <li><strong>-m[fr] val</strong>  对val值设置内在限制，-mf选项限制分配给val的最大块数目；-mr选项限制记录的最大数目。这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用。</li></ul> <h2 id="awk模式和操作"><a href="#awk模式和操作" class="header-anchor">#</a> awk模式和操作</h2> <p>awk脚本是由模式和操作组成的。</p> <h3 id="模式"><a href="#模式" class="header-anchor">#</a> 模式</h3> <p>模式可以是以下任意一个：</p> <ul><li>/正则表达式/：使用通配符的扩展集。</li> <li>关系表达式：使用运算符进行操作，可以是字符串或数字的比较测试。</li> <li>模式匹配表达式：用运算符<code>~</code>（匹配）和<code>~!</code>（不匹配）。</li> <li>BEGIN语句块、pattern语句块、END语句块：参见<a href="http://man.linuxde.net/awk#awk%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" target="_blank" rel="noopener noreferrer">awk的工作原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="操作"><a href="#操作" class="header-anchor">#</a> 操作</h3> <p>操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，主要部分是：</p> <ul><li><a href="http://man.linuxde.net/awk#awk%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%EF%BC%88%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F%EF%BC%89" target="_blank" rel="noopener noreferrer">变量<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="http://man.linuxde.net/awk#%E6%95%B0%E7%BB%84%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreferrer">数组<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>赋值</li> <li><a href="http://man.linuxde.net/awk#awk%E9%AB%98%E7%BA%A7%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA" target="_blank" rel="noopener noreferrer">输出命令<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://man.linuxde.net/awk#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0" target="_blank" rel="noopener noreferrer">内置函数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://man.linuxde.net/awk#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer">控制流语句<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="awk脚本基本结构"><a href="#awk脚本基本结构" class="header-anchor">#</a> awk脚本基本结构</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ print &quot;start&quot; } pattern{ commands } END{ print &quot;end&quot; }' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一个awk脚本通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块3部分组成，这三个部分是可选的。任意一个部分都可以不出现在脚本中，脚本通常是被<strong>单引号</strong>或<strong>双引号</strong>中，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ i=0 } { i++ } END{ print i }' filename
awk &quot;BEGIN{ i=0 } { i++ } END{ print i }&quot; filename

删除首行
docker ps|awk 'NR!=1{print $1}'
docker ps|awk '{if(NR&gt;1) print $1}'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="awk的工作原理"><a href="#awk的工作原理" class="header-anchor">#</a> awk的工作原理</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ commands } pattern{ commands } END{ commands }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>第一步：执行<code>BEGIN{ commands }</code>语句块中的语句；</li> <li>第二步：从文件或标准输入(stdin)读取一行，然后执行<code>pattern{ commands }</code>语句块，它逐行扫描文件，从第一行到最后一行重复这个过程，直到文件全部被读取完毕。</li> <li>第三步：当读至输入流末尾时，执行<code>END{ commands }</code>语句块。</li></ul> <p><strong>BEGIN语句块</strong>在awk开始从输入流中读取行<strong>之前</strong>被执行，这是一个可选的语句块，比如变量初始化、打印输出表格的表头等语句通常可以写在BEGIN语句块中。</p> <p><strong>END语句块</strong>在awk从输入流中读取完所有的行<strong>之后</strong>即被执行，比如打印所有行的分析结果这类信息汇总都是在END语句块中完成，它也是一个可选语句块。</p> <p><strong>pattern语句块</strong>中的通用命令是最重要的部分，它也是可选的。如果没有提供pattern语句块，则默认执行<code>{ print }</code>，即打印每一个读取到的行，awk读取的每一行都会执行该语句块。</p> <p><strong>示例</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo -e &quot;A line 1nA line 2&quot; | awk 'BEGIN{ print &quot;Start&quot; } { print } END{ print &quot;End&quot; }'
Start
A line 1
A line 2
End
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当使用不带参数的<code>print</code>时，它就打印当前行，当<code>print</code>的参数是以逗号进行分隔时，打印时则以空格作为定界符。在awk的print语句块中双引号是被当作拼接符使用，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo | awk '{ var1=&quot;v1&quot;; var2=&quot;v2&quot;; var3=&quot;v3&quot;; print var1,var2,var3; }' 
v1 v2 v3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>双引号拼接使用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo | awk '{ var1=&quot;v1&quot;; var2=&quot;v2&quot;; var3=&quot;v3&quot;; print var1&quot;=&quot;var2&quot;=&quot;var3; }'
v1=v2=v3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>{ }类似一个循环体，会对文件中的每一行进行迭代，通常变量初始化语句（如：i=0）以及打印文件头部的语句放入BEGIN语句块中，将打印的结果等语句放在END语句块中。</p> <h2 id="awk内置变量-预定义变量"><a href="#awk内置变量-预定义变量" class="header-anchor">#</a> awk内置变量（预定义变量）</h2> <p>说明：[A][N][P][G]表示第一个支持变量的工具，[A]=awk、[N]=nawk、[P]=POSIXawk、[G]=gawk</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$n 当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二个字段。 
$0 这个变量包含执行过程中当前行的文本内容。
[N] ARGC 命令行参数的数目。
[G] ARGIND 命令行中当前文件的位置（从0开始算）。
[N] ARGV 包含命令行参数的数组。
[G] CONVFMT 数字转换格式（默认值为%.6g）。
[P] ENVIRON 环境变量关联数组。
[N] ERRNO 最后一个系统错误的描述。
[G] FIELDWIDTHS 字段宽度列表（用空格键分隔）。
[A] FILENAME 当前输入文件的名。
[P] FNR 同NR，但相对于当前文件。
[A] FS 字段分隔符（默认是任何空格）。
[G] IGNORECASE 如果为真，则进行忽略大小写的匹配。
[A] NF 表示字段数，在执行过程中对应于当前的字段数。
[A] NR 表示记录数，在执行过程中对应于当前的行号。
[A] OFMT 数字的输出格式（默认值是%.6g）。
[A] OFS 输出字段分隔符（默认值是一个空格）。
[A] ORS 输出记录分隔符（默认值是一个换行符）。
[A] RS 记录分隔符（默认是一个换行符）。
[N] RSTART 由match函数所匹配的字符串的第一个位置。
[N] RLENGTH 由match函数所匹配的字符串的长度。
[N] SUBSEP 数组下标分隔符（默认值是34）。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>示例</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo -e &quot;line1 f2 f3nline2 f4 f5nline3 f6 f7&quot; | awk '{print &quot;Line No:&quot;NR&quot;, No of fields:&quot;NF, &quot;$0=&quot;$0, &quot;$1=&quot;$1, &quot;$2=&quot;$2, &quot;$3=&quot;$3}' 
Line No:1, No of fields:3 $0=line1 f2 f3 $1=line1 $2=f2 $3=f3
Line No:2, No of fields:3 $0=line2 f4 f5 $1=line2 $2=f4 $3=f5
Line No:3, No of fields:3 $0=line3 f6 f7 $1=line3 $2=f6 $3=f7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用<code>print $NF</code>可以打印出一行中的最后一个字段，使用<code>$(NF-1)</code>则是打印倒数第二个字段，其他以此类推：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo -e &quot;line1 f2 f3n line2 f4 f5&quot; | awk '{print $NF}'
f3
f5
echo -e &quot;line1 f2 f3n line2 f4 f5&quot; | awk '{print $(NF-1)}'
f2
f4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>打印每一行的第二和第三个字段：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk '{ print $2,$3 }' filename
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>统计文件中的行数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'END{ print NR }' filename
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以上命令只使用了END语句块，在读入每一行的时，awk会将NR更新为对应的行号，当到达最后一行NR的值就是最后一行的行号，所以END语句块中的NR就是文件的行数。</p> <p>一个每一行中第一个字段值累加的例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>seq 5 | awk 'BEGIN{ sum=0; print &quot;总和：&quot; } { print $1&quot;+&quot;; sum+=$1 } END{ print &quot;等于&quot;; print sum }' 
总和：
1+
2+
3+
4+
5+
等于
15
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="将外部变量值传递给awk"><a href="#将外部变量值传递给awk" class="header-anchor">#</a> 将外部变量值传递给awk</h2> <p>借助**<code>-v</code>选项**，可以将外部值（并非来自stdin）传递给awk：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>VAR=10000
echo | awk -v VARIABLE=$VAR '{ print VARIABLE }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>另一种传递外部变量方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var1=&quot;aaa&quot;
var2=&quot;bbb&quot;
echo | awk '{ print v1,v2 }' v1=$var1 v2=$var2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当输入来自于文件时使用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk '{ print v1,v2 }' v1=$var1 v2=$var2 filename
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以上方法中，变量之间用空格分隔作为awk的命令行参数跟随在BEGIN、{}和END语句块之后。</p> <h2 id="awk运算与判断"><a href="#awk运算与判断" class="header-anchor">#</a> awk运算与判断</h2> <p>作为一种程序设计语言所应具有的特点之一，awk支持多种运算，这些运算与C语言提供的基本相同。awk还提供了一系列内置的运算函数（如log、sqr、cos、sin等）和一些用于对字符串进行操作（运算）的函数（如length、substr等等）。这些函数的引用大大的提高了awk的运算功能。作为对条件转移指令的一部分，关系判断是每种程序设计语言都具备的功能，awk也不例外，awk中允许进行多种测试，作为样式匹配，还提供了模式匹配表达式~（匹配）和~!（不匹配）。作为对测试的一种扩充，awk也支持用逻辑运算符。</p> <h3 id="算术运算符"><a href="#算术运算符" class="header-anchor">#</a> 算术运算符</h3> <table><thead><tr><th style="text-align:left;">运算符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">+ -</td> <td style="text-align:left;">加，减</td></tr> <tr><td style="text-align:left;">* / &amp;</td> <td style="text-align:left;">乘，除与求余</td></tr> <tr><td style="text-align:left;">+ - !</td> <td style="text-align:left;">一元加，减和逻辑非</td></tr> <tr><td style="text-align:left;">^ ***</td> <td style="text-align:left;">求幂</td></tr> <tr><td style="text-align:left;">++ --</td> <td style="text-align:left;">增加或减少，作为前缀或后缀</td></tr></tbody></table> <p>例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{a=&quot;b&quot;;print a++,++a;}'
0 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：所有用作算术运算符进行操作，操作数自动转为数值，所有非数值都变为0</p> <h3 id="赋值运算符"><a href="#赋值运算符" class="header-anchor">#</a> 赋值运算符</h3> <table><thead><tr><th style="text-align:left;">运算符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">= += -= *= /= %= ^= **=</td> <td style="text-align:left;">赋值语句</td></tr></tbody></table> <p>例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a+=5; 等价于：a=a+5; 其它同类
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="逻辑运算符"><a href="#逻辑运算符" class="header-anchor">#</a> 逻辑运算符</h3> <table><thead><tr><th style="text-align:left;">运算符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">||</td> <td style="text-align:left;">逻辑或</td></tr> <tr><td style="text-align:left;">&amp;&amp;</td> <td style="text-align:left;">逻辑与</td></tr></tbody></table> <p>例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{a=1;b=2;print (a&gt;5 &amp;&amp; b&lt;=2),(a&gt;5 || b&lt;=2);}'
0 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="正则运算符"><a href="#正则运算符" class="header-anchor">#</a> 正则运算符</h3> <table><thead><tr><th style="text-align:left;">运算符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">~ ~!</td> <td style="text-align:left;">匹配正则表达式和不匹配正则表达式</td></tr></tbody></table> <p>例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{a=&quot;100testa&quot;;if(a ~ /^100*/){print &quot;ok&quot;;}}'
ok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="关系运算符"><a href="#关系运算符" class="header-anchor">#</a> 关系运算符</h3> <table><thead><tr><th style="text-align:left;">运算符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">&lt; &lt;= &gt; &gt;= != ==</td> <td style="text-align:left;">关系运算符</td></tr></tbody></table> <p>例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{a=11;if(a &gt;= 9){print &quot;ok&quot;;}}'
ok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：&gt; &lt; 可以作为字符串比较，也可以用作数值比较，关键看操作数如果是字符串就会转换为字符串比较。两个都为数字才转为数值比较。字符串比较：按照ASCII码顺序比较。</p> <h3 id="其它运算符"><a href="#其它运算符" class="header-anchor">#</a> 其它运算符</h3> <table><thead><tr><th style="text-align:left;">运算符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">$</td> <td style="text-align:left;">字段引用</td></tr> <tr><td style="text-align:left;">空格</td> <td style="text-align:left;">字符串连接符</td></tr> <tr><td style="text-align:left;">?:</td> <td style="text-align:left;">C条件表达式</td></tr> <tr><td style="text-align:left;">in</td> <td style="text-align:left;">数组中是否存在某键值</td></tr></tbody></table> <p>例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{a=&quot;b&quot;;print a==&quot;b&quot;?&quot;ok&quot;:&quot;err&quot;;}'
ok
awk 'BEGIN{a=&quot;b&quot;;arr[0]=&quot;b&quot;;arr[1]=&quot;c&quot;;print (a in arr);}'
0
awk 'BEGIN{a=&quot;b&quot;;arr[0]=&quot;b&quot;;arr[&quot;b&quot;]=&quot;c&quot;;print (a in arr);}'
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="运算级优先级表"><a href="#运算级优先级表" class="header-anchor">#</a> 运算级优先级表</h3> <p><img src="https://cdn.jsdelivr.net/gh/opersdev/image/i/2022/06/13/62a6e33f3730d.gif" alt="级别越高越优先">
级别越高越优先</p> <h2 id="awk高级输入输出"><a href="#awk高级输入输出" class="header-anchor">#</a> awk高级输入输出</h2> <h3 id="读取下一条记录"><a href="#读取下一条记录" class="header-anchor">#</a> 读取下一条记录</h3> <p>awk中<code>next</code>语句使用：在循环逐行匹配，如果遇到next，就会跳过当前行，直接忽略下面语句。而进行下一行匹配。net语句一般用于多行合并：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat text.txt
a
b
c
d
e

awk 'NR%2==1{next}{print NR,$0;}' text.txt
2 b
4 d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当记录行号除以2余1，就跳过当前行。下面的<code>print NR,$0</code>也不会执行。下一行开始，程序有开始判断<code>NR%2</code>值。这个时候记录行号是<code>：2</code> ，就会执行下面语句块：<code>'print NR,$0'</code></p> <p>分析发现需要将包含有“web”行进行跳过，然后需要将内容与下面行合并为一行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat text.txt
web01[192.168.2.100]
httpd            ok
tomcat               ok
sendmail               ok
web02[192.168.2.101]
httpd            ok
postfix               ok
web03[192.168.2.102]
mysqld            ok
httpd               ok
0
awk '/^web/{T=$0;next;}{print T&quot;:t&quot;$0;}' test.txt
web01[192.168.2.100]:   httpd            ok
web01[192.168.2.100]:   tomcat               ok
web01[192.168.2.100]:   sendmail               ok
web02[192.168.2.101]:   httpd            ok
web02[192.168.2.101]:   postfix               ok
web03[192.168.2.102]:   mysqld            ok
web03[192.168.2.102]:   httpd               ok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="简单地读取一条记录"><a href="#简单地读取一条记录" class="header-anchor">#</a> 简单地读取一条记录</h3> <p><code>awk getline</code>用法：输出重定向需用到<code>getline函数</code>。getline从标准输入、管道或者当前正在处理的文件之外的其他输入文件获得输入。它负责从输入获得下一行的内容，并给NF,NR和FNR等内建变量赋值。如果得到一条记录，getline函数返回1，如果到达文件的末尾就返回0，如果出现错误，例如打开文件失败，就返回-1。</p> <p>getline语法：getline var，变量var包含了特定行的内容。</p> <p>awk getline从整体上来说，用法说明：</p> <ul><li>**当其左右无重定向符<code>|</code>或<code>&lt;</code>时：**getline作用于当前文件，读入当前文件的第一行给其后跟的变量<code>var</code>或<code>$0</code>（无变量），应该注意到，由于awk在处理getline之前已经读入了一行，所以getline得到的返回结果是隔行的。</li> <li>**当其左右有重定向符<code>|</code>或<code>&lt;</code>时：**getline则作用于定向输入文件，由于该文件是刚打开，并没有被awk读入一行，只是getline读入，那么getline返回的是该文件的第一行，而不是隔行。</li></ul> <p><strong>示例：</strong></p> <p>执行linux的<code>date</code>命令，并通过管道输出给<code>getline</code>，然后再把输出赋值给自定义变量out，并打印它：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ &quot;date&quot; | getline out; print out }' test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给out，<a href="http://man.linuxde.net/split" target="_blank" rel="noopener noreferrer">split<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>函数把变量out转化成数组mon，然后打印数组mon的第二个元素：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ &quot;date&quot; | getline out; split(out,mon); print mon[2] }' test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>命令<a href="http://man.linuxde.net/ls" target="_blank" rel="noopener noreferrer">ls<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。这里没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ while( &quot;ls&quot; | getline) print }'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="关闭文件"><a href="#关闭文件" class="header-anchor">#</a> 关闭文件</h3> <p>awk中允许在程序中关闭一个输入或输出文件，方法是使用awk的close语句。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>close(&quot;filename&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>filename可以是getline打开的文件，也可以是stdin，包含文件名的变量或者getline使用的确切命令。或一个输出文件，可以是stdout，包含文件名的变量或使用管道的确切命令。</p> <h3 id="输出到一个文件"><a href="#输出到一个文件" class="header-anchor">#</a> 输出到一个文件</h3> <p>awk中允许用如下方式将结果输出到一个文件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo | awk '{printf(&quot;hello word!n&quot;) &gt; &quot;datafile&quot;}'
或
echo | awk '{printf(&quot;hello word!n&quot;) &gt;&gt; &quot;datafile&quot;}'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="设置字段定界符"><a href="#设置字段定界符" class="header-anchor">#</a> 设置字段定界符</h2> <p>默认的字段定界符是空格，可以使用<code>-F &quot;定界符&quot;</code> 明确指定一个定界符：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk -F: '{ print $NF }' /etc/passwd
或
awk 'BEGIN{ FS=&quot;:&quot; } { print $NF }' /etc/passwd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在<code>BEGIN语句块</code>中则可以用<code>OFS=“定界符”</code>设置输出字段的定界符。</p> <h2 id="流程控制语句"><a href="#流程控制语句" class="header-anchor">#</a> 流程控制语句</h2> <p>在linux awk的while、do-while和for语句中允许使用break,continue语句来控制流程走向，也允许使用<a href="http://man.linuxde.net/exit" target="_blank" rel="noopener noreferrer">exit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这样的语句来退出。break中断当前正在执行的循环并跳到循环外执行下一条语句。if 是流程选择用法。awk中，流程控制语句，语法结构，与c语言类型。有了这些语句，其实很多shell程序都可以交给awk，而且性能是非常快的。下面是各个语句用法。</p> <h3 id="条件判断语句"><a href="#条件判断语句" class="header-anchor">#</a> 条件判断语句</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(表达式)
  语句1
else
  语句2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>格式中语句1可以是多个语句，为了方便判断和阅读，最好将多个语句用{}括起来。awk分枝结构允许嵌套，其格式为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(表达式)
  {语句1}
else if(表达式)
  {语句2}
else
  {语句3}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{
test=100;
if(test&gt;90){
  print &quot;very good&quot;;
  }
  else if(test&gt;60){
    print &quot;good&quot;;
  }
  else{
    print &quot;no pass&quot;;
  }
}'

very good
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>每条命令语句后面可以用<code>;</code><strong>分号</strong>结尾。</p> <h3 id="循环语句"><a href="#循环语句" class="header-anchor">#</a> 循环语句</h3> <h4 id="while语句"><a href="#while语句" class="header-anchor">#</a> while语句</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>while(表达式)
  {语句}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{
test=100;
total=0;
while(i&lt;=test){
  total+=i;
  i++;
}
print total;
}'
5050
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="for循环"><a href="#for循环" class="header-anchor">#</a> for循环</h4> <p>for循环有两种格式：</p> <p>格式1：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>for(变量 in 数组)
  {语句}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{
for(k in ENVIRON){
  print k&quot;=&quot;ENVIRON[k];
}

}'
TERM=linux
G_BROKEN_FILENAMES=1
SHLVL=1
pwd=/root/text
...
logname=root
HOME=/root
SSH_CLIENT=192.168.1.21 53087 22
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>注：ENVIRON是awk常量，是子典型数组。</p> <p>格式2：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>for(变量;条件;表达式)
  {语句}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{
total=0;
for(i=0;i&lt;=100;i++){
  total+=i;
}
print total;
}'
5050
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="do循环"><a href="#do循环" class="header-anchor">#</a> do循环</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>do
{语句} while(条件)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{ 
total=0;
i=0;
do {total+=i;i++;} while(i&lt;=100)
  print total;
}'
5050
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="其他语句"><a href="#其他语句" class="header-anchor">#</a> 其他语句</h3> <ul><li><strong>break</strong> 当 break 语句用于 while 或 for 语句时，导致退出程序循环。</li> <li><strong>continue</strong> 当 continue 语句用于 while 或 for 语句时，使程序循环移动到下一个迭代。</li> <li><strong>next</strong> 能能够导致读入下一个输入行，并返回到脚本的顶部。这可以避免对当前输入行执行其他的操作过程。</li> <li><strong>exit</strong> 语句使主输入循环退出并将控制转移到END,如果END存在的话。如果没有定义END规则，或在END中应用exit语句，则终止脚本的执行。</li></ul> <h2 id="数组应用"><a href="#数组应用" class="header-anchor">#</a> 数组应用</h2> <p>数组是awk的灵魂，处理文本中最不能少的就是它的数组处理。因为数组索引（下标）可以是数字和字符串在awk中数组叫做关联数组(associative arrays)。awk 中的数组不必提前声明，也不必声明大小。数组元素用0或空字符串来初始化，这根据上下文而定。</p> <h3 id="数组的定义"><a href="#数组的定义" class="header-anchor">#</a> 数组的定义</h3> <p>数字做数组索引（下标）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Array[1]=&quot;sun&quot;
Array[2]=&quot;kai&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>字符串做数组索引（下标）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Array[&quot;first&quot;]=&quot;www&quot;
Array[&quot;last&quot;]=&quot;name&quot;
Array[&quot;birth&quot;]=&quot;1987&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用中<code>print Array[1]</code>会打印出sun；使用<code>print Array[2]</code>会打印出kai；使用<code>print[&quot;birth&quot;]</code>会得到1987。</p> <p><strong>读取数组的值</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{ for(item in array) {print array[item]}; }       #输出的顺序是随机的
{ for(i=1;i&lt;=len;i++) {print array[i]}; }         #Len是数组的长度
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="数组相关函数"><a href="#数组相关函数" class="header-anchor">#</a> 数组相关函数</h3> <p><strong>得到数组长度：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;it is a test&quot;;lens=split(info,tA,&quot; &quot;);print length(tA),lens;}'
4 4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>length返回字符串以及数组长度，split进行分割字符串为数组，也会返回分割得到数组长度。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;it is a test&quot;;split(info,tA,&quot; &quot;);print asort(tA);}'
4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>asort对数组进行排序，返回数组长度。</p> <p><strong>输出数组内容（无序，有序输出）：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;it is a test&quot;;split(info,tA,&quot; &quot;);for(k in tA){print k,tA[k];}}'
4 test
1 it
2 is
3 a 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>for…in</code>输出，因为数组是关联数组，默认是无序的。所以通过<code>for…in</code>得到是无序的数组。如果需要得到有序数组，需要通过下标获得。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;it is a test&quot;;tlen=split(info,tA,&quot; &quot;);for(k=1;k&lt;=tlen;k++){print k,tA[k];}}'
1 it
2 is
3 a
4 test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>注意：数组下标是从1开始，与C数组不一样。</p> <p><strong>判断键值存在以及删除键值：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#错误的判断方法：
awk 'BEGIN{tB[&quot;a&quot;]=&quot;a1&quot;;tB[&quot;b&quot;]=&quot;b1&quot;;if(tB[&quot;c&quot;]!=&quot;1&quot;){print &quot;no found&quot;;};for(k in tB){print k,tB[k];}}' 
no found
a a1
b b1
c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>以上出现奇怪问题，<code>tB[“c”]</code>没有定义，但是循环时候，发现已经存在该键值，它的值为空，这里需要注意，awk数组是关联数组，只要通过数组引用它的key，就会自动创建改序列。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#正确判断方法：
awk 'BEGIN{tB[&quot;a&quot;]=&quot;a1&quot;;tB[&quot;b&quot;]=&quot;b1&quot;;if( &quot;c&quot; in tB){print &quot;ok&quot;;};for(k in tB){print k,tB[k];}}'  
a a1
b b1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>if(key in array)</code>通过这种方法判断数组中是否包含<code>key</code>键值。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#删除键值：
[chengmo@localhost ~]$ awk 'BEGIN{tB[&quot;a&quot;]=&quot;a1&quot;;tB[&quot;b&quot;]=&quot;b1&quot;;delete tB[&quot;a&quot;];for(k in tB){print k,tB[k];}}'                     
b b1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>delete array[key]</code>可以删除，对应数组<code>key</code>的，序列值。</p> <h3 id="二维、多维数组使用"><a href="#二维、多维数组使用" class="header-anchor">#</a> 二维、多维数组使用</h3> <p>awk的多维数组在本质上是一维数组，更确切一点，awk在存储上并不支持多维数组。awk提供了逻辑上模拟二维数组的访问方式。例如，<code>array[2,4]=1</code>这样的访问是允许的。awk使用一个特殊的字符串<code>SUBSEP(�34)</code>作为分割字段，在上面的例子中，关联数组array存储的键值实际上是2�344。</p> <p>类似一维数组的成员测试，多维数组可以使用<code>if ( (i,j) in array)</code>这样的语法，但是下标必须放置在圆括号中。类似一维数组的循环访问，多维数组使用<code>for ( item in array )</code>这样的语法遍历数组。与一维数组不同的是，多维数组必须使用<code>split()</code>函数来访问单独的下标分量。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{
for(i=1;i&lt;=9;i++){
  for(j=1;j&lt;=9;j++){
    tarr[i,j]=i*j; print i,&quot;*&quot;,j,&quot;=&quot;,tarr[i,j];
  }
}
}'
1 * 1 = 1
1 * 2 = 2
1 * 3 = 3
1 * 4 = 4
1 * 5 = 5
1 * 6 = 6 
...
9 * 6 = 54
9 * 7 = 63
9 * 8 = 72
9 * 9 = 81
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可以通过<code>array[k,k2]</code>引用获得数组内容。</p> <p>另一种方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{
for(i=1;i&lt;=9;i++){
  for(j=1;j&lt;=9;j++){
    tarr[i,j]=i*j;
  }
}
for(m in tarr){
  split(m,tarr2,SUBSEP); print tarr2[1],&quot;*&quot;,tarr2[2],&quot;=&quot;,tarr[m];
}
}'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="内置函数"><a href="#内置函数" class="header-anchor">#</a> 内置函数</h2> <p>awk内置函数，主要分以下3种类似：算数函数、字符串函数、其它一般函数、时间函数。</p> <h3 id="算术函数"><a href="#算术函数" class="header-anchor">#</a> 算术函数</h3> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">atan2( y, x )</td> <td style="text-align:left;">返回 y/x 的反正切。</td></tr> <tr><td style="text-align:left;">cos( x )</td> <td style="text-align:left;">返回 x 的余弦；x 是弧度。</td></tr> <tr><td style="text-align:left;">sin( x )</td> <td style="text-align:left;">返回 x 的正弦；x 是弧度。</td></tr> <tr><td style="text-align:left;">exp( x )</td> <td style="text-align:left;">返回 x 幂函数。</td></tr> <tr><td style="text-align:left;">log( x )</td> <td style="text-align:left;">返回 x 的自然对数。</td></tr> <tr><td style="text-align:left;">sqrt( x )</td> <td style="text-align:left;">返回 x 平方根。</td></tr> <tr><td style="text-align:left;">int( x )</td> <td style="text-align:left;">返回 x 的截断至整数的值。</td></tr> <tr><td style="text-align:left;">rand( )</td> <td style="text-align:left;">返回任意数字 n，其中 0 &lt;= n &lt; 1。</td></tr> <tr><td style="text-align:left;">srand( [<a href="http://man.linuxde.net/expr" target="_blank" rel="noopener noreferrer">expr<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>] )</td> <td style="text-align:left;">将 rand 函数的种子值设置为 Expr 参数的值，或如果省略 Expr 参数则使用某天的时间。返回先前的种子值。</td></tr></tbody></table> <p>举例说明：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{OFMT=&quot;%.3f&quot;;fs=sin(1);fe=exp(10);fl=log(10);fi=int(3.1415);print fs,fe,fl,fi;}'
0.841 22026.466 2.303 3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>OFMT 设置输出数据格式是保留3位小数。</p> <p>获得随机数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{srand();fr=int(100*rand());print fr;}'
78
awk 'BEGIN{srand();fr=int(100*rand());print fr;}'
31
awk 'BEGIN{srand();fr=int(100*rand());print fr;}'
41 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="字符串函数"><a href="#字符串函数" class="header-anchor">#</a> 字符串函数</h3> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">gsub( Ere, Repl, [ In ] )</td> <td style="text-align:left;">除了正则表达式所有具体值被替代这点，它和 sub 函数完全一样地执行。</td></tr> <tr><td style="text-align:left;">sub( Ere, Repl, [ In ] )</td> <td style="text-align:left;">用 Repl 参数指定的字符串替换 In 参数指定的字符串中的由 Ere 参数指定的扩展正则表达式的第一个具体值。sub 函数返回替换的数量。出现在 Repl 参数指定的字符串中的 &amp;（和符号）由 In 参数指定的与 Ere 参数的指定的扩展正则表达式匹配的字符串替换。如果未指定 In 参数，缺省值是整个记录（$0 记录变量）。</td></tr> <tr><td style="text-align:left;">index( String1, String2 )</td> <td style="text-align:left;">在由 String1 参数指定的字符串（其中有出现 String2 指定的参数）中，返回位置，从 1 开始编号。如果 String2 参数不在 String1 参数中出现，则返回 0（零）。</td></tr> <tr><td style="text-align:left;">length [(String)]</td> <td style="text-align:left;">返回 String 参数指定的字符串的长度（字符形式）。如果未给出 String 参数，则返回整个记录的长度（$0 记录变量）。</td></tr> <tr><td style="text-align:left;">blength [(String)]</td> <td style="text-align:left;">返回 String 参数指定的字符串的长度（以字节为单位）。如果未给出 String 参数，则返回整个记录的长度（$0 记录变量）。</td></tr> <tr><td style="text-align:left;">substr( String, M, [ N ] )</td> <td style="text-align:left;">返回具有 N 参数指定的字符数量子串。子串从 String 参数指定的字符串取得，其字符以 M 参数指定的位置开始。M 参数指定为将 String 参数中的第一个字符作为编号 1。如果未指定 N 参数，则子串的长度将是 M 参数指定的位置到 String 参数的末尾 的长度。</td></tr> <tr><td style="text-align:left;">match( String, Ere )</td> <td style="text-align:left;">在 String 参数指定的字符串（Ere 参数指定的扩展正则表达式出现在其中）中返回位置（字符形式），从 1 开始编号，或如果 Ere 参数不出现，则返回 0（零）。RSTART 特殊变量设置为返回值。RLENGTH 特殊变量设置为匹配的字符串的长度，或如果未找到任何匹配，则设置为 -1（负一）。</td></tr> <tr><td style="text-align:left;">split( String, A, [Ere] )</td> <td style="text-align:left;">将 String 参数指定的参数分割为数组元素 A[1], A[2], . . ., A[n]，并返回 n 变量的值。此分隔可以通过 Ere 参数指定的扩展正则表达式进行，或用当前字段分隔符（FS 特殊变量）来进行（如果没有给出 Ere 参数）。除非上下文指明特定的元素还应具有一个数字值，否则 A 数组中的元素用字符串值来创建。</td></tr> <tr><td style="text-align:left;">tolower( String )</td> <td style="text-align:left;">返回 String 参数指定的字符串，字符串中每个大写字符将更改为小写。大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义。</td></tr> <tr><td style="text-align:left;">toupper( String )</td> <td style="text-align:left;">返回 String 参数指定的字符串，字符串中每个小写字符将更改为大写。大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义。</td></tr> <tr><td style="text-align:left;">sprintf(Format, Expr, Expr, . . . )</td> <td style="text-align:left;">根据 Format 参数指定的 printf 子例程格式字符串来格式化 Expr 参数指定的表达式并返回最后生成的字符串。</td></tr></tbody></table> <p>注：Ere都可以是正则表达式。</p> <p><strong>gsub,sub使用</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;this is a test2010test!&quot;;gsub(/[0-9]+/,&quot;!&quot;,info);print info}'
this is a test!test!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在 info中查找满足正则表达式，<code>/[0-9]+/</code>用<code>””</code>替换，并且替换后的值，赋值给info 未给info值，默认是<code>$0</code></p> <p><strong>查找字符串（index使用）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;this is a test2010test!&quot;;print index(info,&quot;test&quot;)?&quot;ok&quot;:&quot;no found&quot;;}'
ok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>未找到，返回0</p> <p><strong>正则表达式匹配查找(match使用）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;this is a test2010test!&quot;;print match(info,/[0-9]+/)?&quot;ok&quot;:&quot;no found&quot;;}'
ok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>截取字符串(substr使用）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[wangsl@centos5 ~]$ awk 'BEGIN{info=&quot;this is a test2010test!&quot;;print substr(info,4,10);}'
s is a tes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>从第 4个 字符开始，截取10个长度字符串</p> <p><strong>字符串分割（split使用）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{info=&quot;this is a test&quot;;split(info,tA,&quot; &quot;);print length(tA);for(k in tA){print k,tA[k];}}'
4
4 test
1 this
2 is
3 a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>分割info，动态创建数组tA，这里比较有意思，<code>awk for …in</code>循环，是一个无序的循环。 并不是从数组下标1…n ，因此使用时候需要注意。</p> <p><strong>格式化字符串输出（sprintf使用）</strong></p> <p>格式化字符串格式：</p> <p>其中格式化字符串包括两部分内容：一部分是正常字符，这些字符将按原样输出; 另一部分是格式化规定字符，以<code>&quot;%&quot;</code>开始，后跟一个或几个规定字符,用来确定输出内容格式。</p> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">%d</td> <td style="text-align:left;">十进制有符号整数</td></tr> <tr><td style="text-align:left;">%u</td> <td style="text-align:left;">十进制无符号整数</td></tr> <tr><td style="text-align:left;">%f</td> <td style="text-align:left;">浮点数</td></tr> <tr><td style="text-align:left;">%s</td> <td style="text-align:left;">字符串</td></tr> <tr><td style="text-align:left;">%c</td> <td style="text-align:left;">单个字符</td></tr> <tr><td style="text-align:left;">%p</td> <td style="text-align:left;">指针的值</td></tr> <tr><td style="text-align:left;">%e</td> <td style="text-align:left;">指数形式的浮点数</td></tr> <tr><td style="text-align:left;">%x</td> <td style="text-align:left;">%X 无符号以十六进制表示的整数</td></tr> <tr><td style="text-align:left;">%o</td> <td style="text-align:left;">无符号以八进制表示的整数</td></tr> <tr><td style="text-align:left;">%g</td> <td style="text-align:left;">自动选择合适的表示法</td></tr></tbody></table> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{n1=124.113;n2=-1.224;n3=1.2345; printf(&quot;%.2f,%.2u,%.2g,%X,%on&quot;,n1,n2,n3,n1,n1);}'
124.11,18446744073709551615,1.2,7C,174
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="一般函数"><a href="#一般函数" class="header-anchor">#</a> 一般函数</h3> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">close( Expression )</td> <td style="text-align:left;">用同一个带字符串值的 Expression 参数来关闭由 print 或 printf 语句打开的或调用 getline 函数打开的文件或管道。如果文件或管道成功关闭，则返回 0；其它情况下返回非零值。如果打算写一个文件，并稍后在同一个程序中读取文件，则 close 语句是必需的。</td></tr> <tr><td style="text-align:left;">system(<a href="http://man.linuxde.net/command" target="_blank" rel="noopener noreferrer">command<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> )</td> <td style="text-align:left;">执行 Command 参数指定的命令，并返回退出状态。等同于 system 子例程。</td></tr> <tr><td style="text-align:left;">Expression | getline [ Variable ]</td> <td style="text-align:left;">从来自 Expression 参数指定的命令的输出中通过管道传送的流中读取一个输入记录，并将该记录的值指定给 Variable 参数指定的变量。如果当前未打开将 Expression 参数的值作为其命令名称的流，则创建流。创建的流等同于调用 popen 子例程，此时 Command 参数取 Expression 参数的值且 Mode 参数设置为一个是 r 的值。只要流保留打开且 Expression 参数求得同一个字符串，则对 getline 函数的每次后续调用读取另一个记录。如果未指定 Variable 参数，则 $0 记录变量和 NF 特殊变量设置为从流读取的记录。</td></tr> <tr><td style="text-align:left;">getline [ Variable ] &lt; Expression</td> <td style="text-align:left;">从 Expression 参数指定的文件读取输入的下一个记录，并将 Variable 参数指定的变量设置为该记录的值。只要流保留打开且 Expression 参数对同一个字符串求值，则对 getline 函数的每次后续调用读取另一个记录。如果未指定 Variable 参数，则 $0 记录变量和 NF 特殊变量设置为从流读取的记录。</td></tr> <tr><td style="text-align:left;">getline [ Variable ]</td> <td style="text-align:left;">将 Variable 参数指定的变量设置为从当前输入文件读取的下一个输入记录。如果未指定 Variable 参数，则 $0 记录变量设置为该记录的值，还将设置 NF、NR 和 FNR 特殊变量。</td></tr></tbody></table> <p><strong>打开外部文件（close用法）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{while(&quot;cat /etc/passwd&quot;|getline){print $0;};close(&quot;/etc/passwd&quot;);}'
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>逐行读取外部文件(getline使用方法）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{while(getline &lt; &quot;/etc/passwd&quot;){print $0;};close(&quot;/etc/passwd&quot;);}'
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
awk 'BEGIN{print &quot;Enter your name:&quot;;getline name;print name;}'
Enter your name:
chengmo
chengmo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>调用外部应用程序(system使用方法）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{b=system(&quot;ls -al&quot;);print b;}'
total 42092
drwxr-xr-x 14 chengmo chengmo     4096 09-30 17:47 .
drwxr-xr-x 95 root   root       4096 10-08 14:01 ..
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>b返回值，是执行结果。</p> <h3 id="时间函数"><a href="#时间函数" class="header-anchor">#</a> 时间函数</h3> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">函数名</td> <td style="text-align:left;">说明</td></tr> <tr><td style="text-align:left;">mktime( YYYY MM <a href="http://man.linuxde.net/dd" target="_blank" rel="noopener noreferrer">dd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> HH MM <a href="http://man.linuxde.net/ss" target="_blank" rel="noopener noreferrer">ss<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>[ DST])</td> <td style="text-align:left;">生成时间格式</td></tr> <tr><td style="text-align:left;">strftime([format [, timestamp]])</td> <td style="text-align:left;">格式化时间输出，将时间戳转为时间字符串 具体格式，见下表.</td></tr> <tr><td style="text-align:left;">systime()</td> <td style="text-align:left;">得到时间戳,返回从1970年1月1日开始到当前时间(不计闰年)的整秒数</td></tr></tbody></table> <p><strong>建指定时间(mktime使用）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{tstamp=mktime(&quot;2001 01 01 12 12 12&quot;);print strftime(&quot;%c&quot;,tstamp);}'
2001年01月01日 星期一 12时12分12秒
awk 'BEGIN{tstamp1=mktime(&quot;2001 01 01 12 12 12&quot;);tstamp2=mktime(&quot;2001 02 01 0 0 0&quot;);print tstamp2-tstamp1;}'
2634468
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>求2个时间段中间时间差，介绍了strftime使用方法</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>awk 'BEGIN{tstamp1=mktime(&quot;2001 01 01 12 12 12&quot;);tstamp2=systime();print tstamp2-tstamp1;}' 
308201392
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>strftime日期和时间格式说明符</strong></p> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">%a</td> <td style="text-align:left;">星期几的缩写(Sun)</td></tr> <tr><td style="text-align:left;">%A</td> <td style="text-align:left;">星期几的完整写法(Sunday)</td></tr> <tr><td style="text-align:left;">%b</td> <td style="text-align:left;">月名的缩写(Oct)</td></tr> <tr><td style="text-align:left;">%B</td> <td style="text-align:left;">月名的完整写法(October)</td></tr> <tr><td style="text-align:left;">%c</td> <td style="text-align:left;">本地日期和时间</td></tr> <tr><td style="text-align:left;">%d</td> <td style="text-align:left;">十进制日期</td></tr> <tr><td style="text-align:left;">%D</td> <td style="text-align:left;">日期 08/20/99</td></tr> <tr><td style="text-align:left;">%e</td> <td style="text-align:left;">日期，如果只有一位会补上一个空格</td></tr> <tr><td style="text-align:left;">%H</td> <td style="text-align:left;">用十进制表示24小时格式的小时</td></tr> <tr><td style="text-align:left;">%I</td> <td style="text-align:left;">用十进制表示12小时格式的小时</td></tr> <tr><td style="text-align:left;">%j</td> <td style="text-align:left;">从1月1日起一年中的第几天</td></tr> <tr><td style="text-align:left;">%m</td> <td style="text-align:left;">十进制表示的月份</td></tr> <tr><td style="text-align:left;">%M</td> <td style="text-align:left;">十进制表示的分钟</td></tr> <tr><td style="text-align:left;">%p</td> <td style="text-align:left;">12小时表示法(AM/PM)</td></tr> <tr><td style="text-align:left;">%S</td> <td style="text-align:left;">十进制表示的秒</td></tr> <tr><td style="text-align:left;">%U</td> <td style="text-align:left;">十进制表示的一年中的第几个星期(星期天作为一个星期的开始)</td></tr> <tr><td style="text-align:left;">%<a href="http://man.linuxde.net/w" target="_blank" rel="noopener noreferrer">w<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">十进制表示的星期几(星期天是0)</td></tr> <tr><td style="text-align:left;">%W</td> <td style="text-align:left;">十进制表示的一年中的第几个星期(星期一作为一个星期的开始)</td></tr> <tr><td style="text-align:left;">%x</td> <td style="text-align:left;">重新设置本地日期(08/20/99)</td></tr> <tr><td style="text-align:left;">%X</td> <td style="text-align:left;">重新设置本地时间(12：00：00)</td></tr> <tr><td style="text-align:left;">%y</td> <td style="text-align:left;">两位数字表示的年(99)</td></tr> <tr><td style="text-align:left;">%Y</td> <td style="text-align:left;">当前月份</td></tr> <tr><td style="text-align:left;">%Z</td> <td style="text-align:left;">时区(PDT)</td></tr> <tr><td style="text-align:left;">%%</td> <td style="text-align:left;">百分号(%)</td></tr></tbody></table> <h1 id="grep命令"><a href="#grep命令" class="header-anchor">#</a> grep命令</h1> <p><strong>grep</strong>（global search regular expression(RE) and print out the line，全面搜索正则表达式并把行打印出来）是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。</p> <h3 id="选项"><a href="#选项" class="header-anchor">#</a> 选项</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>-a 不要忽略二进制数据。
-A&lt;显示列数&gt; 除了显示符合范本样式的那一行之外，并显示该行之后的内容。
-b 在显示符合范本样式的那一行之外，并显示该行之前的内容。
-c 计算符合范本样式的列数。
-C&lt;显示列数&gt;或-&lt;显示列数&gt;  除了显示符合范本样式的那一列之外，并显示该列之前后的内容。
-d&lt;进行动作&gt; 当指定要查找的是目录而非文件时，必须使用这项参数，否则grep命令将回报信息并停止动作。
-e&lt;范本样式&gt; 指定字符串作为查找文件内容的范本样式。
-E 将范本样式为延伸的普通表示法来使用，意味着使用能使用扩展正则表达式。
-f&lt;范本文件&gt; 指定范本文件，其内容有一个或多个范本样式，让grep查找符合范本条件的文件内容，格式为每一列的范本样式。
-F 将范本样式视为固定字符串的列表。
-G 将范本样式视为普通的表示法来使用。
-h 在显示符合范本样式的那一列之前，不标示该列所属的文件名称。
-H 在显示符合范本样式的那一列之前，标示该列的文件名称。
-i 忽略字符大小写的差别。
-l 列出文件内容符合指定的范本样式的文件名称。
-L 列出文件内容不符合指定的范本样式的文件名称。
-n 在显示符合范本样式的那一列之前，标示出该列的编号。
-q 不显示任何信息。
-R/-r 此参数的效果和指定“-d recurse”参数相同。
-s 不显示错误信息。
-v 反转查找。
-w 只显示全字符合的列。
-x 只显示全列符合的列。
-y 此参数效果跟“-i”相同。
-o 只输出文件中匹配到的部分。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="grep命令常见用法"><a href="#grep命令常见用法" class="header-anchor">#</a> grep命令常见用法</h2> <p>在文件中搜索一个单词，命令会返回一个包含**“match_pattern”**的文本行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep match_pattern file_name
grep &quot;match_pattern&quot; file_name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在多个文件中查找：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep &quot;match_pattern&quot; file_1 file_2 file_3 ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出除之外的所有行 <strong>-v</strong> 选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep -v &quot;match_pattern&quot; file_name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>标记匹配颜色 <strong>--color=auto</strong> 选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep &quot;match_pattern&quot; file_name --color=auto
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用正则表达式 <strong>-E</strong> 选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep -E &quot;[1-9]+&quot;
或
egrep &quot;[1-9]+&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>只输出文件中匹配到的部分 <strong>-o</strong> 选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo this is a test line. | grep -o -E &quot;[a-z]+\.&quot;
line.

echo this is a test line. | egrep -o &quot;[a-z]+\.&quot;
line.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>统计文件或者文本中包含匹配字符串的行数 <strong>-c</strong> 选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep -c &quot;text&quot; file_name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出包含匹配字符串的行数 <strong>-n</strong> 选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep &quot;text&quot; -n file_name
或
cat file_name | grep &quot;text&quot; -n

#多个文件
grep &quot;text&quot; -n file_1 file_2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>打印样式匹配所位于的字符或字节偏移：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo gun is not unix | grep -b -o &quot;not&quot;
7:not

#一行中字符串的字符便宜是从该行的第一个字符开始计算，起始值为0。选项 -b -o 一般总是配合使用。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>搜索多个文件并查找匹配文本在哪些文件中：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep -l &quot;text&quot; file1 file2 file3...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="grep递归搜索文件"><a href="#grep递归搜索文件" class="header-anchor">#</a> grep递归搜索文件</h3> <p>在多级目录中对文本进行递归搜索：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep &quot;text&quot; . -r -n
# .表示当前目录。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>忽略匹配样式中的字符大小写：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;hello world&quot; | grep -i &quot;HELLO&quot;
hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项 <strong>-e</strong> 制动多个匹配样式：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo this is a text line | grep -e &quot;is&quot; -e &quot;line&quot; -o
is
line

#也可以使用-f选项来匹配多个样式，在样式文件中逐行写出需要匹配的字符。
cat patfile
aaa
bbb

echo aaa bbb ccc ddd eee | grep -f patfile -o
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在grep搜索结果中包括或者排除指定文件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#只在目录中所有的.php和.html文件中递归搜索字符&quot;main()&quot;
grep &quot;main()&quot; . -r --include *.{php,html}

#在搜索结果中排除所有README文件
grep &quot;main()&quot; . -r --exclude &quot;README&quot;

#在搜索结果中排除filelist文件列表里的文件
grep &quot;main()&quot; . -r --exclude-from filelist
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用0值字节后缀的grep与<a href="http://man.linuxde.net/xargs" target="_blank" rel="noopener noreferrer">xargs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#测试文件：
echo &quot;aaa&quot; &gt; file1
echo &quot;bbb&quot; &gt; file2
echo &quot;aaa&quot; &gt; file3

grep &quot;aaa&quot; file* -lZ | xargs -0 rm

#执行后会删除file1和file3，grep输出用-Z选项来指定以0值字节作为终结符文件名（\0），xargs -0 读取输入并用0值字节终结符分隔文件名，然后删除匹配文件，-Z通常和-l结合使用。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>grep静默输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep -q &quot;test&quot; filename

#不会输出任何信息，如果命令运行成功返回0，失败则返回非0值。一般用于条件测试。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>打印出匹配文本之前或者之后的行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#显示匹配某个结果之后的3行，使用 -A 选项：
seq 10 | grep &quot;5&quot; -A 3
5
6
7
8

#显示匹配某个结果之前的3行，使用 -B 选项：
seq 10 | grep &quot;5&quot; -B 3
2
3
4
5

#显示匹配某个结果的前三行和后三行，使用 -C 选项：
seq 10 | grep &quot;5&quot; -C 3
2
3
4
5
6
7
8

#如果匹配结果有多个，会用“--”作为各匹配结果之间的分隔符：
echo -e &quot;a\nb\nc\na\nb\nc&quot; | grep a -A 1
a
b
--
a
b
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h1 id="sed命令"><a href="#sed命令" class="header-anchor">#</a> sed命令</h1> <p><strong>sed</strong>是一种流编辑器，它是文本处理中非常中的工具，能够完美的配合正则表达式使用，功能不同凡响。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。</p> <h2 id="sed的选项、命令、替换标记"><a href="#sed的选项、命令、替换标记" class="header-anchor">#</a> sed的选项、命令、替换标记</h2> <p><strong>命令格式</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed [options] 'command' file(s)
sed [options] -f scriptfile file(s)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="选项-2"><a href="#选项-2" class="header-anchor">#</a> 选项</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>-e&lt;script&gt;或--expression=&lt;script&gt;：以选项中的指定的script来处理输入的文本文件；
-f&lt;script文件&gt;或--file=&lt;script文件&gt;：以选项中指定的script文件来处理输入的文本文件；
-h或--help：显示帮助；
-n或--quiet或——silent：仅显示script处理后的结果；
-V或--version：显示版本信息。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h3> <p>文件：指定待处理的文本文件列表。</p> <h3 id="sed命令-2"><a href="#sed命令-2" class="header-anchor">#</a> sed命令</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>a\ 在当前行下面插入文本。
i\ 在当前行上面插入文本。
c\ 把选定的行改为新的文本。
d 删除，删除选择的行。
D 删除模板块的第一行。
s 替换指定字符
h 拷贝模板块的内容到内存中的缓冲区。
H 追加模板块的内容到内存中的缓冲区。
g 获得内存缓冲区的内容，并替代当前模板块中的文本。
G 获得内存缓冲区的内容，并追加到当前模板块文本的后面。
l 列表不能打印字符的清单。
n 读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。
N 追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。
p 打印模板块的行。
P(大写) 打印模板块的第一行。
q 退出Sed。
b lable 分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。
r file 从file中读行。
t label if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
T label 错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
w file 写并追加模板块到file末尾。  
W file 写并追加模板块的第一行到file末尾。  
! 表示后面的命令对所有没有被选定的行发生作用。  
= 打印当前行号码。  
# 把注释扩展到下一个换行符以前。  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="sed替换标记"><a href="#sed替换标记" class="header-anchor">#</a> sed替换标记</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>g 表示行内全面替换。  
p 表示打印行。  
w 表示把行写入一个文件。  
x 表示互换模板块中的文本和缓冲区中的文本。  
y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）
\1 子串匹配标记
&amp; 已匹配字符串标记
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="sed元字符集"><a href="#sed元字符集" class="header-anchor">#</a> sed元字符集</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。
$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。
. 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。
* 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。
[] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。  
[^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。
\(..\) 匹配子串，保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers。
&amp; 保存搜索字符用来替换其他字符，如s/love/**&amp;**/，love这成**love**。
\&lt; 匹配单词的开始，如:/\&lt;love/匹配包含以love开头的单词的行。
\&gt; 匹配单词的结束，如/love\&gt;/匹配包含以love结尾的单词的行。
x\{m\} 重复字符x，m次，如：/0\{5\}/匹配包含5个0的行。
x\{m,\} 重复字符x，至少m次，如：/0\{5,\}/匹配至少有5个0的行。
x\{m,n\} 重复字符x，至少m次，不多于n次，如：/0\{5,10\}/匹配5~10个0的行。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="sed用法实例"><a href="#sed用法实例" class="header-anchor">#</a> sed用法实例</h2> <h3 id="替换操作-s命令"><a href="#替换操作-s命令" class="header-anchor">#</a> 替换操作：s命令</h3> <p>替换文本中的字符串：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed 's/book/books/' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>-n选项</strong>和<strong>p命令</strong>一起使用表示只打印那些发生替换的行：</p> <p>sed -n 's/<a href="http://man.linuxde.net/test" target="_blank" rel="noopener noreferrer">test<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/TEST/p' file</p> <p>直接编辑文件<strong>选项-i</strong>，会匹配file文件中每一行的第一个book替换为books：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -i 's/book/books/g' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="全面替换标记g"><a href="#全面替换标记g" class="header-anchor">#</a> 全面替换标记g</h3> <p>使用后缀 /g 标记会替换每一行中的所有匹配：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed 's/book/books/g' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当需要从第N处匹配开始替换时，可以使用 /Ng：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo sksksksksksk | sed 's/sk/SK/2g'
skSKSKSKSKSK

echo sksksksksksk | sed 's/sk/SK/3g'
skskSKSKSKSK

echo sksksksksksk | sed 's/sk/SK/4g'
skskskSKSKSK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="定界符"><a href="#定界符" class="header-anchor">#</a> 定界符</h3> <p>以上命令中字符 / 在sed中作为定界符使用，也可以使用任意的定界符：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed 's:test:TEXT:g'
sed 's|test|TEXT|g'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>定界符出现在样式内部时，需要进行转义：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed 's/\/bin/\/usr\/local\/bin/g'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="删除操作-d命令"><a href="#删除操作-d命令" class="header-anchor">#</a> 删除操作：d命令</h3> <p>删除空白行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/^$/d' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除文件的第2行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '2d' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除文件的第2行到末尾所有行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '2,$d' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除文件最后一行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '$d' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除文件中所有开头是test的行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/^test/'d file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="已匹配字符串标记"><a href="#已匹配字符串标记" class="header-anchor">#</a> 已匹配字符串标记&amp;</h3> <p>正则表达式 \w+ 匹配每一个单词，使用 [&amp;] 替换它，&amp; 对应于之前所匹配到的单词：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo this is a test line | sed 's/\w\+/[&amp;]/g'
[this] [is] [a] [test] [line]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>所有以192.168.0.1开头的行都会被替换成它自已加localhost：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed 's/^192.168.0.1/&amp;localhost/' file
192.168.0.1localhost
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="子串匹配标记-1"><a href="#子串匹配标记-1" class="header-anchor">#</a> 子串匹配标记\1</h3> <p>匹配给定样式的其中一部分：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo this is digit 7 in a number | sed 's/digit \([0-9]\)/\1/'
this is 7 in a number
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>命令中 digit 7，被替换成了 7。样式匹配到的子串是 7，(..) 用于匹配子串，对于匹配到的第一个子串就标记为 <strong>\1</strong>，依此类推匹配到的第二个结果就是 <strong>\2</strong>，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo aaa BBB | sed 's/\([a-z]\+\) \([A-Z]\+\)/\2 \1/'
BBB aaa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>love被标记为1，所有loveable会被替换成lovers，并打印出来：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -n 's/\(love\)able/\1rs/p' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="组合多个表达式"><a href="#组合多个表达式" class="header-anchor">#</a> 组合多个表达式</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '表达式' | sed '表达式'

等价于：

sed '表达式; 表达式'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="引用"><a href="#引用" class="header-anchor">#</a> 引用</h3> <p>sed表达式可以使用单引号来引用，但是如果表达式内部包含变量字符串，就需要使用双引号。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>test=hello
echo hello WORLD | sed &quot;s/$test/HELLO&quot;
HELLO WORLD
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="选定行的范围-逗号"><a href="#选定行的范围-逗号" class="header-anchor">#</a> 选定行的范围：,（逗号）</h3> <p>所有在模板test和check所确定的范围内的行都被打印：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -n '/test/,/check/p' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>打印从第5行开始到第一个包含以test开始的行之间的所有行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -n '5,/^test/p' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>对于模板test和west之间的行，每行的末尾用字符串aaa bbb替换：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/test/,/west/s/$/aaa bbb/' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="多点编辑-e命令"><a href="#多点编辑-e命令" class="header-anchor">#</a> 多点编辑：e命令</h3> <p>-e选项允许在同一行里执行多条命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -e '1,5d' -e 's/test/check/' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面sed表达式的第一条命令删除1至5行，第二条命令用check替换test。命令的执行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。</p> <p>和 -e 等价的命令是 --expression：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed --expression='s/test/check/' --expression='/love/d' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="从文件读入-r命令"><a href="#从文件读入-r命令" class="header-anchor">#</a> 从文件读入：r命令</h3> <p>file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/test/r file' filename
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="写入文件-w命令"><a href="#写入文件-w命令" class="header-anchor">#</a> 写入文件：w命令</h3> <p>在example中所有包含test的行都被写入file里：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -n '/test/w file' example
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="追加-行下-a-命令"><a href="#追加-行下-a-命令" class="header-anchor">#</a> 追加（行下）：a\命令</h3> <p>将 this is a test line 追加到 以test 开头的行后面：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/^test/a\this is a test line' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 test.conf 文件第2行之后插入 this is a test line：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -i '2a\this is a test line' test.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="插入-行上-i-命令"><a href="#插入-行上-i-命令" class="header-anchor">#</a> 插入（行上）：i\命令</h3> <p>将 this is a test line 追加到以test开头的行前面：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/^test/i\this is a test line' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在test.conf文件第5行之前插入this is a test line：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -i '5i\this is a test line' test.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="下一个-n命令"><a href="#下一个-n命令" class="header-anchor">#</a> 下一个：n命令</h3> <p>如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '/test/{ n; s/aa/bb/; }' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="变形-y命令"><a href="#变形-y命令" class="header-anchor">#</a> 变形：y命令</h3> <p>把1~10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '1,10y/abcde/ABCDE/' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="退出-q命令"><a href="#退出-q命令" class="header-anchor">#</a> 退出：q命令</h3> <p>打印完第10行后，退出sed</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed '10q' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="保持和获取-h命令和g命令"><a href="#保持和获取-h命令和g命令" class="header-anchor">#</a> 保持和获取：h命令和G命令</h3> <p>在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -e '/test/h' -e '$G' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。</p> <h3 id="保持和互换-h命令和x命令"><a href="#保持和互换-h命令和x命令" class="header-anchor">#</a> 保持和互换：h命令和x命令</h3> <p>互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -e '/test/h' -e '/check/x' file
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="脚本scriptfile"><a href="#脚本scriptfile" class="header-anchor">#</a> 脚本scriptfile</h3> <p>sed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed [options] -f scriptfile file(s)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="打印奇数行或偶数行"><a href="#打印奇数行或偶数行" class="header-anchor">#</a> 打印奇数行或偶数行</h3> <p>方法1：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -n 'p;n' test.txt  #奇数行
sed -n 'n;p' test.txt  #偶数行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>方法2：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -n '1~2p' test.txt  #奇数行
sed -n '2~2p' test.txt  #偶数行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="打印匹配字符串的下一行"><a href="#打印匹配字符串的下一行" class="header-anchor">#</a> 打印匹配字符串的下一行</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>grep -A 1 SCC URFILE
sed -n '/SCC/{n;p}' URFILE
awk '/SCC/{getline; print}' URFILE
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/8a368c/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">shell编程</div></a> <a href="/pages/fcdd76/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Zookeeper</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/8a368c/" class="prev">shell编程</a></span> <span class="next"><a href="/pages/fcdd76/">Zookeeper</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/613b69/"><div>
            postgresql安装
            <!----></div></a> <span class="date">06-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/8ae632/"><div>
            oracle笔记
            <!----></div></a> <span class="date">06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/765fc1/"><div>
            opengauss笔记
            <!----></div></a> <span class="date">06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:48211701@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/opersdev" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://all.aomtop.com" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>kevin | <a href="https://github.com/opersdev" target="_blank">小诺运维</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.38f1b0a4.js" defer></script><script src="/assets/js/2.6beb1dc7.js" defer></script><script src="/assets/js/13.161be064.js" defer></script>
  </body>
</html>
