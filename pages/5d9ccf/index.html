<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>php笔记 | 小诺文档中心</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <meta name="description" content="运维技术文档,mysql,k8s,docker,linux,shell,python等技术文章。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="运维技术文档,mysql,k8s,docker,linux,shell,python,技术文档,学习,面试,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.92233c96.css" as="style"><link rel="preload" href="/assets/js/app.38f1b0a4.js" as="script"><link rel="preload" href="/assets/js/2.6beb1dc7.js" as="script"><link rel="preload" href="/assets/js/25.1240d0c9.js" as="script"><link rel="prefetch" href="/assets/js/10.4365b950.js"><link rel="prefetch" href="/assets/js/100.8dac6c81.js"><link rel="prefetch" href="/assets/js/101.a5556ac1.js"><link rel="prefetch" href="/assets/js/102.e3ff38b9.js"><link rel="prefetch" href="/assets/js/103.3bcf44f5.js"><link rel="prefetch" href="/assets/js/104.6d56e53e.js"><link rel="prefetch" href="/assets/js/105.4fc9762e.js"><link rel="prefetch" href="/assets/js/106.f507561a.js"><link rel="prefetch" href="/assets/js/107.6c94c756.js"><link rel="prefetch" href="/assets/js/108.f7ff1945.js"><link rel="prefetch" href="/assets/js/109.aeb1e532.js"><link rel="prefetch" href="/assets/js/11.fe1ff844.js"><link rel="prefetch" href="/assets/js/110.dda67b83.js"><link rel="prefetch" href="/assets/js/111.5b990f24.js"><link rel="prefetch" href="/assets/js/112.0a27d3a0.js"><link rel="prefetch" href="/assets/js/113.972cd001.js"><link rel="prefetch" href="/assets/js/114.875814a1.js"><link rel="prefetch" href="/assets/js/115.ec235d59.js"><link rel="prefetch" href="/assets/js/116.03bd2386.js"><link rel="prefetch" href="/assets/js/117.68765825.js"><link rel="prefetch" href="/assets/js/118.9d6d0255.js"><link rel="prefetch" href="/assets/js/119.ff84a82f.js"><link rel="prefetch" href="/assets/js/12.aa21f453.js"><link rel="prefetch" href="/assets/js/120.20639785.js"><link rel="prefetch" href="/assets/js/121.6c546150.js"><link rel="prefetch" href="/assets/js/122.48e85de5.js"><link rel="prefetch" href="/assets/js/123.fc931745.js"><link rel="prefetch" href="/assets/js/124.797d5fda.js"><link rel="prefetch" href="/assets/js/125.b23a31c7.js"><link rel="prefetch" href="/assets/js/126.d7a182fd.js"><link rel="prefetch" href="/assets/js/127.167a63d6.js"><link rel="prefetch" href="/assets/js/128.878d4a7e.js"><link rel="prefetch" href="/assets/js/129.a8957dfa.js"><link rel="prefetch" href="/assets/js/13.161be064.js"><link rel="prefetch" href="/assets/js/130.3961a295.js"><link rel="prefetch" href="/assets/js/131.9c4e7a56.js"><link rel="prefetch" href="/assets/js/132.41d26584.js"><link rel="prefetch" href="/assets/js/133.6d91047e.js"><link rel="prefetch" href="/assets/js/134.121ecf0e.js"><link rel="prefetch" href="/assets/js/135.6e30234c.js"><link rel="prefetch" href="/assets/js/136.6fab7ce4.js"><link rel="prefetch" href="/assets/js/137.209af36e.js"><link rel="prefetch" href="/assets/js/138.660f236e.js"><link rel="prefetch" href="/assets/js/139.81c29d19.js"><link rel="prefetch" href="/assets/js/14.d0f13635.js"><link rel="prefetch" href="/assets/js/140.d8f594ca.js"><link rel="prefetch" href="/assets/js/141.89fbea1c.js"><link rel="prefetch" href="/assets/js/142.643bccec.js"><link rel="prefetch" href="/assets/js/143.f270bffc.js"><link rel="prefetch" href="/assets/js/144.cf6f4c9a.js"><link rel="prefetch" href="/assets/js/145.093699b5.js"><link rel="prefetch" href="/assets/js/146.876575d0.js"><link rel="prefetch" href="/assets/js/147.dc120635.js"><link rel="prefetch" href="/assets/js/148.4a3ba80f.js"><link rel="prefetch" href="/assets/js/149.4afb7469.js"><link rel="prefetch" href="/assets/js/15.af46dbb5.js"><link rel="prefetch" href="/assets/js/150.4eb38cf2.js"><link rel="prefetch" href="/assets/js/151.4fe6a931.js"><link rel="prefetch" href="/assets/js/16.4cbf8beb.js"><link rel="prefetch" href="/assets/js/17.1da2b6ae.js"><link rel="prefetch" href="/assets/js/18.0402bfbf.js"><link rel="prefetch" href="/assets/js/19.230bfe93.js"><link rel="prefetch" href="/assets/js/20.0d20ddb2.js"><link rel="prefetch" href="/assets/js/21.9dbdbc8b.js"><link rel="prefetch" href="/assets/js/22.1410508d.js"><link rel="prefetch" href="/assets/js/23.63089216.js"><link rel="prefetch" href="/assets/js/24.e6fe9306.js"><link rel="prefetch" href="/assets/js/26.0f4fb46d.js"><link rel="prefetch" href="/assets/js/27.5b193a22.js"><link rel="prefetch" href="/assets/js/28.90e27733.js"><link rel="prefetch" href="/assets/js/29.cdb75f6c.js"><link rel="prefetch" href="/assets/js/3.1229de89.js"><link rel="prefetch" href="/assets/js/30.23c0524a.js"><link rel="prefetch" href="/assets/js/31.bc292e1e.js"><link rel="prefetch" href="/assets/js/32.79645dcf.js"><link rel="prefetch" href="/assets/js/33.53e29142.js"><link rel="prefetch" href="/assets/js/34.7ce01d2e.js"><link rel="prefetch" href="/assets/js/35.bcdc888c.js"><link rel="prefetch" href="/assets/js/36.00ce19aa.js"><link rel="prefetch" href="/assets/js/37.e53fea30.js"><link rel="prefetch" href="/assets/js/38.1b84e50f.js"><link rel="prefetch" href="/assets/js/39.ed0470cb.js"><link rel="prefetch" href="/assets/js/4.93dbb352.js"><link rel="prefetch" href="/assets/js/40.010f2420.js"><link rel="prefetch" href="/assets/js/41.7aefa9d2.js"><link rel="prefetch" href="/assets/js/42.eadeaa1f.js"><link rel="prefetch" href="/assets/js/43.012419aa.js"><link rel="prefetch" href="/assets/js/44.aa86bffd.js"><link rel="prefetch" href="/assets/js/45.b7ce8c1a.js"><link rel="prefetch" href="/assets/js/46.bd51c47b.js"><link rel="prefetch" href="/assets/js/47.71d2a52e.js"><link rel="prefetch" href="/assets/js/48.71b9430b.js"><link rel="prefetch" href="/assets/js/49.d92deee5.js"><link rel="prefetch" href="/assets/js/5.9228d2a8.js"><link rel="prefetch" href="/assets/js/50.2827e7a9.js"><link rel="prefetch" href="/assets/js/51.94c41d82.js"><link rel="prefetch" href="/assets/js/52.73681932.js"><link rel="prefetch" href="/assets/js/53.4db7ebcf.js"><link rel="prefetch" href="/assets/js/54.8e6699ab.js"><link rel="prefetch" href="/assets/js/55.3d832a8c.js"><link rel="prefetch" href="/assets/js/56.43282683.js"><link rel="prefetch" href="/assets/js/57.ea8d4f37.js"><link rel="prefetch" href="/assets/js/58.12ff8ca5.js"><link rel="prefetch" href="/assets/js/59.47100612.js"><link rel="prefetch" href="/assets/js/6.341b2c5d.js"><link rel="prefetch" href="/assets/js/60.914e7e2d.js"><link rel="prefetch" href="/assets/js/61.d9414480.js"><link rel="prefetch" href="/assets/js/62.a3747f73.js"><link rel="prefetch" href="/assets/js/63.1a2e54c1.js"><link rel="prefetch" href="/assets/js/64.d9f9224a.js"><link rel="prefetch" href="/assets/js/65.53e3f7bd.js"><link rel="prefetch" href="/assets/js/66.92d44566.js"><link rel="prefetch" href="/assets/js/67.67aba1d2.js"><link rel="prefetch" href="/assets/js/68.acce7dfb.js"><link rel="prefetch" href="/assets/js/69.3dacbd45.js"><link rel="prefetch" href="/assets/js/7.3d063b98.js"><link rel="prefetch" href="/assets/js/70.b40c0f61.js"><link rel="prefetch" href="/assets/js/71.51b34635.js"><link rel="prefetch" href="/assets/js/72.498f4ff0.js"><link rel="prefetch" href="/assets/js/73.b22c0978.js"><link rel="prefetch" href="/assets/js/74.823f2a12.js"><link rel="prefetch" href="/assets/js/75.d24d261d.js"><link rel="prefetch" href="/assets/js/76.44db605e.js"><link rel="prefetch" href="/assets/js/77.efce42e9.js"><link rel="prefetch" href="/assets/js/78.11405a06.js"><link rel="prefetch" href="/assets/js/79.9f0076d7.js"><link rel="prefetch" href="/assets/js/8.812a9a47.js"><link rel="prefetch" href="/assets/js/80.4fc1dc52.js"><link rel="prefetch" href="/assets/js/81.f8963444.js"><link rel="prefetch" href="/assets/js/82.627d5503.js"><link rel="prefetch" href="/assets/js/83.49c45765.js"><link rel="prefetch" href="/assets/js/84.b2045805.js"><link rel="prefetch" href="/assets/js/85.420cfd4a.js"><link rel="prefetch" href="/assets/js/86.06ff7ec2.js"><link rel="prefetch" href="/assets/js/87.4dfb234a.js"><link rel="prefetch" href="/assets/js/88.079f044f.js"><link rel="prefetch" href="/assets/js/89.bb76f78f.js"><link rel="prefetch" href="/assets/js/9.8be13208.js"><link rel="prefetch" href="/assets/js/90.ae61c8f3.js"><link rel="prefetch" href="/assets/js/91.8728eb6a.js"><link rel="prefetch" href="/assets/js/92.0d8581e8.js"><link rel="prefetch" href="/assets/js/93.e05baea5.js"><link rel="prefetch" href="/assets/js/94.c661a216.js"><link rel="prefetch" href="/assets/js/95.5414604a.js"><link rel="prefetch" href="/assets/js/96.529def2c.js"><link rel="prefetch" href="/assets/js/97.fb2d6168.js"><link rel="prefetch" href="/assets/js/98.69e544d7.js"><link rel="prefetch" href="/assets/js/99.a7993a79.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92233c96.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="小诺文档中心" class="logo"> <span class="site-name can-hide">小诺文档中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://opersdev.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小诺博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/devops/" class="nav-link">DevOps</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">云原生</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/wzdh/" class="nav-link">网址导航</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/opersdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/opersdev/docs/img/touxiang.jpg"> <div class="blogger-info"><h3>kevin</h3> <span>运维界的菜鸟</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://opersdev.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小诺博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/devops/" class="nav-link">DevOps</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">云原生</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/wzdh/" class="nav-link">网址导航</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/opersdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>shell编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>消息队列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>web</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/baa32f/" class="sidebar-link">nginx</a></li><li><a href="/pages/2b9364/" class="sidebar-link">nginx</a></li><li><a href="/pages/88bfb3/" class="sidebar-link">Nginx_day01</a></li><li><a href="/pages/93d0ce/" class="sidebar-link">Nginx_day02</a></li><li><a href="/pages/5930e0/" class="sidebar-link">Nginx_day03</a></li><li><a href="/pages/4c1480/" class="sidebar-link">Nginx_day04</a></li><li><a href="/pages/d2951b/" class="sidebar-link">Nginx_day05</a></li><li><a href="/pages/cfd070/" class="sidebar-link">nginx配置文件模板</a></li><li><a href="/pages/5d9ccf/" aria-current="page" class="active sidebar-link">php笔记</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/eddd8c/" class="sidebar-link">tomcat</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELK</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>自动化运维</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/devops/#DevOps" data-v-06225672>DevOps</a></li><li data-v-06225672><a href="/devops/#web" data-v-06225672>web</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/opersdev" target="_blank" title="作者" class="beLink" data-v-06225672>xiaonuo</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-06-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">php笔记<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h4 id="php5-6源码安装"><a href="#php5-6源码安装" class="header-anchor">#</a> php5.6源码安装</h4> <p>yum install -y epel-release</p> <p>yum install -y bzip2 bzip2-devel libpng libpng-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libmcrypt-devel libxml2-devel openssl openssl-devel curl-devel openldap openldap-devel libmcrypt-devel libmcrypt</p> <p>./configure --prefix=/opt/php --with-config-file-path=/opt/php/etc  --enable-fpm  --with-fpm-user=www --with-fpm-group=www --with-mysql --with-mysql-sock=/var/lib/mysql/mysql.sock --with-php-config=/www/php/bin/php-config --with-mysqli --with-libxml-dir  --with-bz2 --with-gd --with-jpeg-dir --with-png-dir --with-freetype-dir --with-iconv-dir --with-zlib-dir --with-mcrypt --enable-soap --enable-gd-native-ttf --enable-ftp --enable-mbstring --enable-exif --disable-ipv6 --with-curl --enable-bcmath --enable-sockets --with-iconv-dir=/usr/local --enable-xml --enable-dom  --enable-calendar --with-gettext --with-pdo-mysql=mysqlnd --disable-fileinfo --with-ldap=shared --with-apxs2=/usr/bin/apxs</p> <p>./configure --prefix=/opt/php --with-config-file-path=/opt/php/etc  --enable-fpm  --with-fpm-user=www --with-fpm-group=www --with-php-config=/opt/php/bin/php-config --with-mysqli --with-libxml-dir  --with-bz2 --with-gd --with-jpeg-dir --with-png-dir --with-freetype-dir --with-iconv-dir --with-zlib-dir --with-mcrypt --enable-soap --enable-gd-native-ttf --enable-ftp --enable-mbstring --enable-exif --disable-ipv6 --with-curl --enable-bcmath --enable-sockets --with-iconv-dir=/usr/local --enable-xml --enable-dom  --enable-calendar --with-gettext --with-pdo-mysql=mysqlnd --disable-fileinfo --with-ldap=shared</p> <p>这里会报一个错，需要拷贝libldap到/usr/lib下
cp -frp /usr/lib64/libldap* /usr/lib/</p> <p>make &amp;&amp; make install</p> <p>拷贝启动脚本：
cp php.ini-production /opt/php/etc/php.ini <br>
cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm <br>
cp /opt/php/etc/php-fpm.conf.default  /opt/php/etc/php-fpm.conf <br>
chmod 755 /etc/init.d/php-fpm <br>
chkconfig --add php-fpm <br>
chkconfig php-fpm on
service php-fpm start
如果报错，需要创建用户php-fpm和组(或者更改启动php的用户)
groupadd php-fpm
useradd -g php-fpm -s /sbin/nologin php-fpm</p> <p>修改php.ini参数：（zabbix环境需要修改的参数）
max_execution_time = 300 memory_limit = 128M post_max_size = 16M upload_max_filesize = 2M max_input_time = 300 date.timezone = Asia/Shanghai
always_populate_raw_post_data = -1</p> <p>yum install httpd-devel.x86_64 -y
apache 加个参数
--with-apxs2=/usr/local/apache/bin/apxs
--with-mysql=/usr/local/mysql</p> <p>添加到httpd.conf
AddType application/x-httpd-php-source .phps
AddType application/x-httpd-php .php
LoadModule php5_module modules/libphp5.so</p> <p>LoadModule php5_module modules/libphp5.so</p> <p>cp php.ini-production /usr/local/php/lib/php.ini
正式配置文件一般关闭显示log</p> <p>make ZEND_EXTRA_LIBS='-liconv'</p> <p>ln -s /usr/local/lib/libiconv.so.2 /usr/lib64/</p> <p>查看安装参数
php -i|grep confi</p> <p>php编译安装参数详解</p> <p>./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-mysql=/usr/local/mysql --with-mysqli=/usr/bin/mysql_config --with-iconv-dir=/usr/local --with-freetype-dir --with-jpeg-dir --with-png-dir --with-zlib --with-libxml-dir=/usr --enable-xml --disable-rpath --enable-discard-path --enable-safe-mode --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl --with-curlwrappers --enable-mbregex --enable-fastcgi --enable-fpm --enable-force-cgi-redirect --enable-mbstring --with-mcrypt --with-gd --enable-gd-native-ttf --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-ldap --with-ldap-sasl --with-xmlrpc --enable-zip --enable-soap --without-pear --with-zlib --enable-pdo --with-pdo-mysql --with-mysql</p> <p>#mysqli扩展技术不仅可以调用MySQL的存储过程、处理MySQL事务，而且还可以使访问数据库工作变得更加稳定。
make ZEND_EXTRA_LIBS='-liconv'
make install</p> <p>--prefix=/usr/local/php</p> <p>指定 php 安装目录</p> <p>--with-apxs2=/usr/local/apache/bin/apxs</p> <p>整合 apache，apxs功能是使用mod_so中的LoadModule指令，加载指定模块到 apache，要求 apache 要打开SO模块</p> <p>--with-config-file-path=/usr/local/php/etc</p> <p>指定php.ini位置</p> <p>--with-MySQL=/usr/local/mysql</p> <p>mysql安装目录，对mysql的支持</p> <p>--with-mysqli=/usr/local/mysql/bin/mysql_config</p> <p>mysqli扩展技术不仅可以调用MySQL的存储过程、处理MySQL事务，而且还可以使访问数据库工作变得更加稳定。</p> <p>--enable-safe-mode   打开安全模式</p> <p>--enable-ftp   打开ftp的支持</p> <p>--enable-zip   打开对zip的支持</p> <p>--with-bz2    打开对bz2文件的支持</p> <p>--with-jpeg-dir   打开对jpeg图片的支持</p> <p>--with-png-dir   打开对png图片的支持</p> <p>--with-freetype-dir   打开对freetype字体库的支持</p> <p>--without-iconv   关闭iconv函数，种字符集间的转换</p> <p>--with-libXML-dir   打开libxml2库的支持</p> <p>--with-XMLrpc    打开xml-rpc的c语言</p> <p>--with-zlib-dir   打开zlib库的支持</p> <p>--with-gd    打开gd库的支持</p> <p>--enable-gd-native-ttf   支持TrueType字符串函数库</p> <p>--with-curl    打开curl浏览工具的支持</p> <p>--with-curlwrappers    运用curl工具打开url流</p> <p>--with-ttf     打开freetype1.*的支持，可以不加了</p> <p>--with-xsl     打开XSLT 文件支持，扩展了libXML2库 ，需要libxslt软件</p> <p>--with-gettext     打开gnu 的gettext 支持，编码库用到</p> <p>--with-pear    打开pear命令的支持，PHP扩展用的</p> <p>--enable-calendar    打开日历扩展功能</p> <p>--enable-mbstring    多字节，字符串的支持</p> <p>--enable-bcmath    打开图片大小调整,用到zabbix监控的时候用到了这个模块</p> <p>--enable-sockets     打开 sockets 支持</p> <p>--enable-exif    图片的元数据支持</p> <p>--enable-magic-quotes    魔术引用的支持</p> <p>--disable-rpath    关闭额外的运行库文件</p> <p>--disable-debug    关闭调试模式</p> <p>--with-mime-magic=/usr/share/file/magic.mime      魔术头文件位置</p> <p>CGI方式安装才用的参数</p> <p>--enable-fpm</p> <p>打上PHP-fpm 补丁后才有这个参数，CGI方式安装的启动程序</p> <p>--enable-fastCGI</p> <p>支持fastcgi方式启动PHP</p> <p>--enable-force-CGI-redirect</p> <p>重定向方式启动PHP</p> <p>--with-ncurses</p> <p>支持ncurses 屏幕绘制以及基于文本终端的图形互动功能的动态库</p> <p>--enable-pcntl                     freeTDS需要用到的，可能是链接mssql 才用到</p> <p>mhash和mcrypt算法的扩展</p> <p>--with-mcrypt                     算法</p> <p>--with-mhash                      算法</p> <p>以上函数库需要安装</p> <p>--with-gmp  应该是支持一种规范</p> <p>--enable-inline-optimization  优化线程</p> <p>--with-openssl                     openssl的支持，加密传输时用到的</p> <p>--enable-dbase                     建立DBA 作为共享模块</p> <p>--with-pcre-dir=/usr/local/bin/pcre-config      perl的正则库案安装位置</p> <p>--disable-dmalloc</p> <p>--with-gdbm                     dba的gdbm支持</p> <p>--enable-sigchild</p> <p>--enable-sysvsem</p> <p>--enable-sysvshm</p> <p>--enable-zend-multibyte         支持zend的多字节</p> <p>--enable-mbregex</p> <p>--enable-wddx</p> <p>--enable-shmop</p> <p>--enable-soap</p> <h4 id="php7-2源码安装"><a href="#php7-2源码安装" class="header-anchor">#</a> php7.2源码安装</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> http://103.40.19.56/lnmp/libzip-1.3.2.tar.gz

yum -y <span class="token function">install</span> curl-devel libjpeg-devel libpng-devel freetype-devel libxml2-devel libzip

./configure --prefix<span class="token operator">=</span>/usr/local/php71 --exec-prefix<span class="token operator">=</span>/usr/local/php71 --bindir<span class="token operator">=</span>/usr/local/php71/bin --sbindir<span class="token operator">=</span>/usr/local/php71/sbin --includedir<span class="token operator">=</span>/usr/local/php71/include --libdir<span class="token operator">=</span>/usr/local/php71/lib/php --mandir<span class="token operator">=</span>/usr/local/php71/php/man --with-config-file-path<span class="token operator">=</span>/usr/local/php71/etc --with-mcrypt<span class="token operator">=</span>/usr/local/libmcrypt --with-mhash --with-openssl --with-mysqli<span class="token operator">=</span>/usr/local/mysql/bin/mysql_config --with-pdo-mysql<span class="token operator">=</span>/usr/local/mysql --with-gd --with-iconv --with-zlib --enable-inline-optimization --disable-debug --disable-rpath --enable-shared --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-mbregex --enable-mbstring --enable-ftp --enable-gd-native-ttf --enable-pcntl --enable-sockets --with-xmlrpc --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-fpm --without-gdbm --disable-fileinfo --enable-opcache<span class="token operator">=</span>no

./configure   --prefix<span class="token operator">=</span>/www/php   --with-config-file-path<span class="token operator">=</span>/www/php/etc  --enable-libxml   --enable-xml   --enable-bcmath   --enable-shmop   --enable-sysvsem   --enable-inline-optimization   --enable-opcache   --enable-mbregex   --enable-fpm   --enable-mbstring<span class="token operator">=</span>all   --with-openssl   --enable-pcntl   --enable-sockets   --with-xmlrpc   --enable-zip   --enable-soap   --without-pear   --with-gettext   --enable-session   --with-curl   --enable-ctype   --enable-shared   --with-gd   --with-pdo-mysql --with-mysql-sock<span class="token operator">=</span>/var/lib/mysql/mysql.sock


<span class="token function">cp</span> php.ini-development /www/php/etc/php.ini

<span class="token builtin class-name">cd</span> /www/php/etc 
<span class="token function">cp</span> php-fpm.conf.default php-fpm.conf 

<span class="token function">vim</span> /www/php/etc/php.ini 
cgi.fix_pathinfo<span class="token operator">=</span><span class="token number">0</span> 

<span class="token builtin class-name">cd</span>  /www/php/etc/php-fpm.d
<span class="token function">cp</span> www.conf.default  www.conf
<span class="token function">vim</span> www.conf

/www/php/sbin/php-fpm

<span class="token function">cp</span> /www/php/bin/php  /usr/local/bin/php

php -m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="php7-3源码安装"><a href="#php7-3源码安装" class="header-anchor">#</a> php7.3源码安装</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./configure --prefix<span class="token operator">=</span>/www/php73 --with-config-file-path<span class="token operator">=</span>/www/php73 --enable-fpm --with-mysqli --with-pdo-mysql --enable-mbstring --with-gd --enable-soap --enable-cli --with-curl --with-openssl-dir --with-zlib-dir --disable-fileinfo --with-ldap<span class="token operator">=</span>shared --enable-xml --enable-dom  --enable-calendar --with-gettext --with-mcrypt --enable-soap --enable-gd-native-ttf --enable-ftp --enable-mbstring --enable-exif --disable-ipv6 --with-curl --enable-bcmath --enable-sockets

<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>

<span class="token function">cp</span> php.ini-development /www/php73/php.ini
<span class="token function">cp</span> sapi/fpm/init.d.php-fpm /etc/init.d/php73
<span class="token function">cp</span> /www/php73/etc/php-fpm.conf.default  /www/php73/etc/php-fpm.conf

<span class="token function">chmod</span> <span class="token number">755</span> /etc/init.d/php73
<span class="token function">chkconfig</span> --add php73
<span class="token function">chkconfig</span> php73 on
<span class="token function">service</span> php73 start


修改一下date.timezone<span class="token operator">=</span><span class="token string">&quot;Asia/Shanghai&quot;</span>

在进入安装后php路径etc下将 <span class="token function">cp</span> php-fpm.conf.default php-fpm.conf 

在进入cd php-fpm.d/

<span class="token function">cp</span> www.conf.default www.conf

修改www.conf 的启动用户和端口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="php7-4源码安装"><a href="#php7-4源码安装" class="header-anchor">#</a> php7.4源码安装</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install -y openssl-devel libxml2-devel bzip2-devel libcurl-devel libjpeg-devel libpng-devel freetype-devel libmcrypt-devel recode-devel libicu-devel libzip-devel sqlite-devel oniguruma-devel gmp-devel readline-devel gflags-devel

cp -frp /usr/lib64/libldap* /usr/lib/

wget https://nih.at/libzip/libzip-1.2.0.tar.gz
tar -zxvf libzip-1.2.0.tar.gz
cd libzip-1.2.0
./configure
make &amp;&amp; make install
export PKG_CONFIG_PATH=&quot;/usr/local/lib/pkgconfig/&quot;

或者
rpm -Uvh http://rpms.remirepo.net/enterprise/remi-release-7.rpm 
yum —enablerepo=remi install libzip5-devel 

./configure --prefix=/opt/php74 --with-mysqli=/opt/mysql/bin/mysql_config --with-pdo-mysql=/opt/mysql --enable-inline-optimization --disable-debug --disable-rpath --enable-shared --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-mbregex  --enable-ftp --enable-gd-native-ttf --enable-pcntl --enable-sockets --with-xmlrpc --enable-soap --without-pear --with-gettext --enable-session --with-curl --with-jpeg-dir --with-freetype-dir --enable-fpm --without-gdbm --enable-fileinfo --enable-opcache --enable-ctype --enable-dom --with-mhash --with-iconv --enable-json --enable-mbstring --with-openssl --enable-posix --enable-session --enable-simplexml --enable-xmlreader --enable-xmlwriter --with-zlib --enable-gd --with-zip --enable-bz2 --enable-intl --with-ldap --with-smbclient --enable-bcmath --with-gmp --enable-exif --enable-pcntl --with-libxml 



/lib64/liblber-2.4.so.2: could not read symbols: Invalid operation
collect2: ld returned 1 exit status
make: *** [sapi/cli/php] Error 1

./configure后

编辑MakeFile

找到 开头是 'EXTRA_LIBS' 这一行 在结尾加上 '-llber' 然后执行 make &amp;&amp; make install


PHP模块imagick
avconv或ffmpeg
OpenOffice或LibreOffice
imagick
memcached
Zend OPcache

yum install -y libwebp libwebp-devel

./configure --with-php-config=/opt/php74/bin/php-config --with-jpeg-dir=/usr/local/libjpeg --with-png-dir=/usr/local/libpng --with-freetype-dir=/usr/local/freetype --with-zlib-dir=/usr/local/zlib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="yum安装php7"><a href="#yum安装php7" class="header-anchor">#</a> yum安装php7</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rpm</span> -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm

现在使用yum命令按以下方式安装所需的全部扩展程序PHP和PHP-FPM。

<span class="token function">sudo</span> yum -y <span class="token function">install</span> php70w-fpm php70w-mcrypt php70w-curl php70w-cli php70w-mysql php70w-gd php70w-xsl php70w-json php70w-intl php70w-pear php70w-devel php70w-common php70w-mbstring php70w-tidy php70w-zip php70w-soap <span class="token function">curl</span>

安装完成后，我们需要编辑<span class="token string">'php.ini'</span>配置文件并编辑php-fpm池配置<span class="token string">'www.conf'</span>。

使用vim编辑器编辑<span class="token string">'php.ini'</span>配置文件。

<span class="token function">vim</span> /etc/php.ini

取消注释<span class="token string">'cgi.fix_pathinfo'</span>行并将该值更改为<span class="token string">'0'</span>。

cgi.fix_pathinfo<span class="token operator">=</span><span class="token number">0</span>
保存并退出。

接下来，编辑池配置文件<span class="token string">'www.conf'</span>。

<span class="token function">vim</span> /etc/php-fpm.d/www.conf

将运行PHP-FPM服务的默认用户更改为<span class="token string">'nginx'</span>用户和组。

user <span class="token operator">=</span> nginx
group <span class="token operator">=</span> nginx
在<span class="token string">'listen'</span>行中，将值更改为sock文件，如下所示。 我们将在sock文件下运行PHP-fpm。

listen <span class="token operator">=</span> /var/run/php-fpm/php-fpm.sock
现在为套接字权限和所有者配置。 取消注释这些行并按如下所示更改值。

listen.owner <span class="token operator">=</span> nginx
 listen.group <span class="token operator">=</span> nginx
 listen.mode <span class="token operator">=</span> 0660
最后，取消注释PHP-FPM环境。

env<span class="token punctuation">[</span><span class="token environment constant">HOSTNAME</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token environment constant">$HOSTNAME</span>
 env<span class="token punctuation">[</span><span class="token environment constant">PATH</span><span class="token punctuation">]</span> <span class="token operator">=</span> /usr/local/bin:/usr/bin:/bin
 env<span class="token punctuation">[</span>TMP<span class="token punctuation">]</span> <span class="token operator">=</span> /tmp
 env<span class="token punctuation">[</span>TMPDIR<span class="token punctuation">]</span> <span class="token operator">=</span> /tmp
 env<span class="token punctuation">[</span>TEMP<span class="token punctuation">]</span> <span class="token operator">=</span> /tmp

在CentOS <span class="token number">7</span>上安装PHP Composer
<span class="token function">curl</span> -sS https://getcomposer.org/installer <span class="token operator">|</span> php
<span class="token function">mv</span> composer.phar /usr/bin/composer
<span class="token function">composer</span> -v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="php-ini配置文件参数优化"><a href="#php-ini配置文件参数优化" class="header-anchor">#</a> php.ini配置文件参数优化</h4> <p>用于生产环境中的PHP需要对其进行优化，让PHP自身发挥更好的性能，除了写好PHP代码，还要配置好php-fpm以及php.ini调优。本文从内存、OPcache、上传、会话以及安全等方面讲解php.ini的配置调优。</p> <h5 id="内存优化"><a href="#内存优化" class="header-anchor">#</a> 内存优化</h5> <p>运行 PHP 时需要关心每个 PHP 进程要使用多少内存，php.ini 中的<em>memory_limit</em> 设置用于设定单个 PHP 进程可以使用的系统内存最大值。
这个设置的默认值是 128M，这对于大多数中小型 PHP 应用来说或许合适，不过，如果运行的是微型 PHP 应用，可以降低这个值，以便节省系统资源，反之，如果运行的是内存集中型 PHP 应用，可以增加这个值。这个值的大小由可用的系统内存决定，确定给 PHP 分配多少值是一门艺术，决定给 PHP 分配多少内存，以及能负担起多少个 PHP-FPM 进程时，可以根据以下维度信息进行判断：</p> <p>\1.   一共可以分配给 PHP 多少内存？以一个 2G 内存的 VPS 为例，这台设备中可能还运行了其他进程，如 MySQL、Nginx 等，那么留 512M 给 PHP 是合适的。</p> <p>\2.   每个 PHP 进程平均耗费多少内存？这个要监控进程的内存使用量，可以使用命令行命令top，也可以在 PHP 脚本中调用 memory_get_peak_usage() 函数，不管使用哪种方式，都要多次运行同一个脚本，然后取内存消耗的平均值。</p> <p>\3.   能负担起多少个 PHP-FPM 进程？假设我给 PHP 分配了 512M 内存，每个 PHP 进程平均耗费 15M 内存，那么可以负担起 34 个 PHP-FPM 进程。
有足够的系统资源吗？最后还需要确认有足够的系统资源运行 PHP 应用并处理预期的流量。</p> <h5 id="开启zend-opcache性能加速"><a href="#开启zend-opcache性能加速" class="header-anchor">#</a> 开启Zend OPcache性能加速</h5> <p><img src="https://image.aomtop.com/i/2022/06/24/62b525ec233ac.png" alt="IMG_256"></p> <p>PHP属于解释型语言，在执行代码过程中，翻译器并不产生目标机器代码，而是产生易于执行的中间代码，这种中间代码每执行一次就翻译一次，通常会导致执行效率较低，而在PHP7中可以直接开启Opcache来进行性能优化和加速。
PHP 5.5+版本以上的，可以使用PHP自带的opcache开启性能加速（默认是关闭的），PHP5.5之后opcache可以直接--enable-opcache。对于PHP 5.5以下版本的，可以使用APC来进行缓存。</p> <h5 id="配置opcache"><a href="#配置opcache" class="header-anchor">#</a> 配置Opcache</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>zend_extension=opcache.so
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;(网上很多资料使用engine = On来,是window下的php)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.enable=1 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;设置多少内存缓存opcode,单位M。如果内存不够用，就会出现一些php文件缓存不到的情况。解决办法是设置缓存到文件中去</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.memory_consumption=128
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;最大允许缓存多少个php文件,需要根据项目的文件数来定。这个值一定要比 PHP 应用中的文件数大。最大支持100万个文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.max_accelerated_files=4000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;这个设置的值为1时，经过一段时间后 PHP 会检查 PHP 脚本的内容是否有变化，检查的时间间隔由opcache.revalidate_freq设置指定。如果这个设置的值为0，PHP 不会检查 PHP 脚本的内容是否有变化，我们必须自己动手清除缓存的操作码。建议在开发环境中设置为1，生产环境中设置为0。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.validate_timestamps=0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;验证时间戳的频率。单位是秒。;此选型依赖于opcache.vilidate_timestamps=1(开启检查机制)，才生效</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.revalidate_freq = 60
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;字符串驻留技术使用多少内存，设置为8M,这是默认值。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.interned_strings_buffer = 16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;快速释放内存,推荐开启,节省资源。php-7.2.0开始,不需要配置,已集成在php引擎中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.fast_shutdown=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;设置:是不是只使用文件来缓存opcode,不使用内存缓存。建议:关掉。最好内存和文件都同时使用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.file_cache_only=false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>;将内存中缓存的opcdoe，备份到磁盘文件中。这样好处，重启服务器时，可以避免重新生成了。注意目录的权限要设对，设置php引擎所属linux用户能够写入。实测,若权限不够,并不会报错,只是缓存不进去</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>opcache.file_cache=/apps/php-7.1.7/opcode_file_cache
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="文件上传"><a href="#文件上传" class="header-anchor">#</a> 文件上传</h5> <p>如果你的应用允许上传文件，最好设置最大能上传的文件大小。除此之外，最好还要设置最多能同时上传多少个文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> file_uploads = 1
 upload_max_filesize = 10M
 max_file_uploads = 3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>默认情况下，PHP 允许在单次请求中上传 20 个文件，上传的文件最大为 2MB，这里我设置为单次请求最多只能上传 3 个文件，每个文件最大为 10MB，这个值不要设置太大，否则会出现超时。
注：如果非要上传大文件，Web 服务器的配置也要做相应调整。除了在 php.ini 中设置之外，还要调整 Nginx 虚拟主机配置中的 client_max_body_size 设置。
此外，如果是上传特大文件，我建议使用Webuploader专门的上传组件，前端对大文件进行切片，后端php对分片数据进行合并还原文件。有关WebUploader应用请参考本站文章：功能强大的文件上传组件-WebUploader。</p> <h5 id="执行时间"><a href="#执行时间" class="header-anchor">#</a> 执行时间</h5> <p><em>max_execution_time</em> 用于设置单个 PHP 进程在终止之前最长可运行时间。这个设置默认是 30 秒，建议将其设置为 5 秒：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>max_execution_time = 5
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注：在 PHP 脚本中可以调用*set_limit_time()*函数覆盖这个设置。
假设我们想要生成报告，并把结果制作成 PDF 文件，这个任务可能要花 10 分钟才能完成，而我们肯定不想让 PHP 请求等待 10 分钟，我们应该单独编写一个 PHP 文件，让其在单独的后台进程中执行，Web 应用只需几毫秒就可以派生一个单独的后台进程，然后返回 HTTP 响应。
实际上，我们在跑需要消耗大量时间来完成的任务，一般采用后台进程方式，比如我们可以使用PHP的swoole扩展来生成报表、批量发送邮件耗时长的任务。</p> <h5 id="处理会话"><a href="#处理会话" class="header-anchor">#</a> 处理会话</h5> <p>PHP 默认的会话处理程序会拖慢大型应用，因为这个处理程序会把会话数据存储在硬盘中，需要创建不必要的磁盘 I/O，浪费时间。我们应该把会话数据保存在内存中，例如可以使用 Memcached 或 Redis。这么做还有个额外好处 —— 以后便于伸缩。如果会话数据存储在硬盘中，不便于增加额外的服务器，如果把会话数据存放在 Memcached 或 Redis 里，任何一台分布式 PHP-FPM 服务器都能访问会话数据。
如果想把会话数据保存在 Memcached 中，需要做如下配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>session.save_handler = 'memcached'
session.save_path = '127.0.0.1:11211'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="缓冲输出"><a href="#缓冲输出" class="header-anchor">#</a> 缓冲输出</h5> <p>如果是在较少的块中发送更多数据，而不是在较多的块中发送较少的数据，那么网络的效率会更高，也就是说，在较少的片段中把内容传递给访问者的浏览器，能减少 HTTP 请求总数。
因此，我们要让 PHP 缓冲输出，默认情况下，PHP 已经启用了输出缓冲功能，PHP 缓冲 4096 字节的输出之后才会把内容发送给 Web 服务器，推荐配置如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>output_buffering = 4096implicit_flush = false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注：如果想要修改输出缓冲区的大小，确保使用的值是4（32位系统）或8（64位系统）的倍数。</p> <h5 id="安全"><a href="#安全" class="header-anchor">#</a> 安全</h5> <p><em>open_basedir</em>：使用open_basedir选项能够控制PHP脚本只能访问指定的目录，这样能够避免PHP脚本访问不应该访问的文件，一定程度上限制了phpshell的危害。我们一般可以设置为只能访问网站目录：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>open_basedir = /data/www
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一般我们要禁止系统函数和禁止任何文件和目录的操作，如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>disable_functions = passthru,system,chroot,scandir,chgrp,chown,shell_exec,proc_open,proc_get_status,popen,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>expose_php = Off：将此项设置为false即不会再header头输出PHP版本信息。
display_errors = Off：生产环境中，我们应该禁止错误提示，如果是本地开发环境，可以设置为On。
log_errors = On：建议在关闭display_errors后能够把错误信息记录下来，便于查找服务器运行的原因。
error_log：设置PHP错误日志存放的目录。</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/cfd070/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">nginx配置文件模板</div></a> <a href="/pages/eddd8c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">tomcat</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/cfd070/" class="prev">nginx配置文件模板</a></span> <span class="next"><a href="/pages/eddd8c/">tomcat</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/613b69/"><div>
            postgresql安装
            <!----></div></a> <span class="date">06-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/8ae632/"><div>
            oracle笔记
            <!----></div></a> <span class="date">06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/765fc1/"><div>
            opengauss笔记
            <!----></div></a> <span class="date">06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:48211701@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/opersdev" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://all.aomtop.com" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>kevin | <a href="https://github.com/opersdev" target="_blank">小诺运维</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.38f1b0a4.js" defer></script><script src="/assets/js/2.6beb1dc7.js" defer></script><script src="/assets/js/25.1240d0c9.js" defer></script>
  </body>
</html>
