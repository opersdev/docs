<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>oracle笔记 | 小诺文档中心</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <meta name="description" content="运维技术文档,mysql,k8s,docker,linux,shell,python等技术文章。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="运维技术文档,mysql,k8s,docker,linux,shell,python,技术文档,学习,面试,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.92233c96.css" as="style"><link rel="preload" href="/assets/js/app.38f1b0a4.js" as="script"><link rel="preload" href="/assets/js/2.6beb1dc7.js" as="script"><link rel="preload" href="/assets/js/51.94c41d82.js" as="script"><link rel="prefetch" href="/assets/js/10.4365b950.js"><link rel="prefetch" href="/assets/js/100.8dac6c81.js"><link rel="prefetch" href="/assets/js/101.a5556ac1.js"><link rel="prefetch" href="/assets/js/102.e3ff38b9.js"><link rel="prefetch" href="/assets/js/103.3bcf44f5.js"><link rel="prefetch" href="/assets/js/104.6d56e53e.js"><link rel="prefetch" href="/assets/js/105.4fc9762e.js"><link rel="prefetch" href="/assets/js/106.f507561a.js"><link rel="prefetch" href="/assets/js/107.6c94c756.js"><link rel="prefetch" href="/assets/js/108.f7ff1945.js"><link rel="prefetch" href="/assets/js/109.aeb1e532.js"><link rel="prefetch" href="/assets/js/11.fe1ff844.js"><link rel="prefetch" href="/assets/js/110.dda67b83.js"><link rel="prefetch" href="/assets/js/111.5b990f24.js"><link rel="prefetch" href="/assets/js/112.0a27d3a0.js"><link rel="prefetch" href="/assets/js/113.972cd001.js"><link rel="prefetch" href="/assets/js/114.875814a1.js"><link rel="prefetch" href="/assets/js/115.ec235d59.js"><link rel="prefetch" href="/assets/js/116.03bd2386.js"><link rel="prefetch" href="/assets/js/117.68765825.js"><link rel="prefetch" href="/assets/js/118.9d6d0255.js"><link rel="prefetch" href="/assets/js/119.ff84a82f.js"><link rel="prefetch" href="/assets/js/12.aa21f453.js"><link rel="prefetch" href="/assets/js/120.20639785.js"><link rel="prefetch" href="/assets/js/121.6c546150.js"><link rel="prefetch" href="/assets/js/122.48e85de5.js"><link rel="prefetch" href="/assets/js/123.fc931745.js"><link rel="prefetch" href="/assets/js/124.797d5fda.js"><link rel="prefetch" href="/assets/js/125.b23a31c7.js"><link rel="prefetch" href="/assets/js/126.d7a182fd.js"><link rel="prefetch" href="/assets/js/127.167a63d6.js"><link rel="prefetch" href="/assets/js/128.878d4a7e.js"><link rel="prefetch" href="/assets/js/129.a8957dfa.js"><link rel="prefetch" href="/assets/js/13.161be064.js"><link rel="prefetch" href="/assets/js/130.3961a295.js"><link rel="prefetch" href="/assets/js/131.9c4e7a56.js"><link rel="prefetch" href="/assets/js/132.41d26584.js"><link rel="prefetch" href="/assets/js/133.6d91047e.js"><link rel="prefetch" href="/assets/js/134.121ecf0e.js"><link rel="prefetch" href="/assets/js/135.6e30234c.js"><link rel="prefetch" href="/assets/js/136.6fab7ce4.js"><link rel="prefetch" href="/assets/js/137.209af36e.js"><link rel="prefetch" href="/assets/js/138.660f236e.js"><link rel="prefetch" href="/assets/js/139.81c29d19.js"><link rel="prefetch" href="/assets/js/14.d0f13635.js"><link rel="prefetch" href="/assets/js/140.d8f594ca.js"><link rel="prefetch" href="/assets/js/141.89fbea1c.js"><link rel="prefetch" href="/assets/js/142.643bccec.js"><link rel="prefetch" href="/assets/js/143.f270bffc.js"><link rel="prefetch" href="/assets/js/144.cf6f4c9a.js"><link rel="prefetch" href="/assets/js/145.093699b5.js"><link rel="prefetch" href="/assets/js/146.876575d0.js"><link rel="prefetch" href="/assets/js/147.dc120635.js"><link rel="prefetch" href="/assets/js/148.4a3ba80f.js"><link rel="prefetch" href="/assets/js/149.4afb7469.js"><link rel="prefetch" href="/assets/js/15.af46dbb5.js"><link rel="prefetch" href="/assets/js/150.4eb38cf2.js"><link rel="prefetch" href="/assets/js/151.4fe6a931.js"><link rel="prefetch" href="/assets/js/16.4cbf8beb.js"><link rel="prefetch" href="/assets/js/17.1da2b6ae.js"><link rel="prefetch" href="/assets/js/18.0402bfbf.js"><link rel="prefetch" href="/assets/js/19.230bfe93.js"><link rel="prefetch" href="/assets/js/20.0d20ddb2.js"><link rel="prefetch" href="/assets/js/21.9dbdbc8b.js"><link rel="prefetch" href="/assets/js/22.1410508d.js"><link rel="prefetch" href="/assets/js/23.63089216.js"><link rel="prefetch" href="/assets/js/24.e6fe9306.js"><link rel="prefetch" href="/assets/js/25.1240d0c9.js"><link rel="prefetch" href="/assets/js/26.0f4fb46d.js"><link rel="prefetch" href="/assets/js/27.5b193a22.js"><link rel="prefetch" href="/assets/js/28.90e27733.js"><link rel="prefetch" href="/assets/js/29.cdb75f6c.js"><link rel="prefetch" href="/assets/js/3.1229de89.js"><link rel="prefetch" href="/assets/js/30.23c0524a.js"><link rel="prefetch" href="/assets/js/31.bc292e1e.js"><link rel="prefetch" href="/assets/js/32.79645dcf.js"><link rel="prefetch" href="/assets/js/33.53e29142.js"><link rel="prefetch" href="/assets/js/34.7ce01d2e.js"><link rel="prefetch" href="/assets/js/35.bcdc888c.js"><link rel="prefetch" href="/assets/js/36.00ce19aa.js"><link rel="prefetch" href="/assets/js/37.e53fea30.js"><link rel="prefetch" href="/assets/js/38.1b84e50f.js"><link rel="prefetch" href="/assets/js/39.ed0470cb.js"><link rel="prefetch" href="/assets/js/4.93dbb352.js"><link rel="prefetch" href="/assets/js/40.010f2420.js"><link rel="prefetch" href="/assets/js/41.7aefa9d2.js"><link rel="prefetch" href="/assets/js/42.eadeaa1f.js"><link rel="prefetch" href="/assets/js/43.012419aa.js"><link rel="prefetch" href="/assets/js/44.aa86bffd.js"><link rel="prefetch" href="/assets/js/45.b7ce8c1a.js"><link rel="prefetch" href="/assets/js/46.bd51c47b.js"><link rel="prefetch" href="/assets/js/47.71d2a52e.js"><link rel="prefetch" href="/assets/js/48.71b9430b.js"><link rel="prefetch" href="/assets/js/49.d92deee5.js"><link rel="prefetch" href="/assets/js/5.9228d2a8.js"><link rel="prefetch" href="/assets/js/50.2827e7a9.js"><link rel="prefetch" href="/assets/js/52.73681932.js"><link rel="prefetch" href="/assets/js/53.4db7ebcf.js"><link rel="prefetch" href="/assets/js/54.8e6699ab.js"><link rel="prefetch" href="/assets/js/55.3d832a8c.js"><link rel="prefetch" href="/assets/js/56.43282683.js"><link rel="prefetch" href="/assets/js/57.ea8d4f37.js"><link rel="prefetch" href="/assets/js/58.12ff8ca5.js"><link rel="prefetch" href="/assets/js/59.47100612.js"><link rel="prefetch" href="/assets/js/6.341b2c5d.js"><link rel="prefetch" href="/assets/js/60.914e7e2d.js"><link rel="prefetch" href="/assets/js/61.d9414480.js"><link rel="prefetch" href="/assets/js/62.a3747f73.js"><link rel="prefetch" href="/assets/js/63.1a2e54c1.js"><link rel="prefetch" href="/assets/js/64.d9f9224a.js"><link rel="prefetch" href="/assets/js/65.53e3f7bd.js"><link rel="prefetch" href="/assets/js/66.92d44566.js"><link rel="prefetch" href="/assets/js/67.67aba1d2.js"><link rel="prefetch" href="/assets/js/68.acce7dfb.js"><link rel="prefetch" href="/assets/js/69.3dacbd45.js"><link rel="prefetch" href="/assets/js/7.3d063b98.js"><link rel="prefetch" href="/assets/js/70.b40c0f61.js"><link rel="prefetch" href="/assets/js/71.51b34635.js"><link rel="prefetch" href="/assets/js/72.498f4ff0.js"><link rel="prefetch" href="/assets/js/73.b22c0978.js"><link rel="prefetch" href="/assets/js/74.823f2a12.js"><link rel="prefetch" href="/assets/js/75.d24d261d.js"><link rel="prefetch" href="/assets/js/76.44db605e.js"><link rel="prefetch" href="/assets/js/77.efce42e9.js"><link rel="prefetch" href="/assets/js/78.11405a06.js"><link rel="prefetch" href="/assets/js/79.9f0076d7.js"><link rel="prefetch" href="/assets/js/8.812a9a47.js"><link rel="prefetch" href="/assets/js/80.4fc1dc52.js"><link rel="prefetch" href="/assets/js/81.f8963444.js"><link rel="prefetch" href="/assets/js/82.627d5503.js"><link rel="prefetch" href="/assets/js/83.49c45765.js"><link rel="prefetch" href="/assets/js/84.b2045805.js"><link rel="prefetch" href="/assets/js/85.420cfd4a.js"><link rel="prefetch" href="/assets/js/86.06ff7ec2.js"><link rel="prefetch" href="/assets/js/87.4dfb234a.js"><link rel="prefetch" href="/assets/js/88.079f044f.js"><link rel="prefetch" href="/assets/js/89.bb76f78f.js"><link rel="prefetch" href="/assets/js/9.8be13208.js"><link rel="prefetch" href="/assets/js/90.ae61c8f3.js"><link rel="prefetch" href="/assets/js/91.8728eb6a.js"><link rel="prefetch" href="/assets/js/92.0d8581e8.js"><link rel="prefetch" href="/assets/js/93.e05baea5.js"><link rel="prefetch" href="/assets/js/94.c661a216.js"><link rel="prefetch" href="/assets/js/95.5414604a.js"><link rel="prefetch" href="/assets/js/96.529def2c.js"><link rel="prefetch" href="/assets/js/97.fb2d6168.js"><link rel="prefetch" href="/assets/js/98.69e544d7.js"><link rel="prefetch" href="/assets/js/99.a7993a79.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92233c96.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="小诺文档中心" class="logo"> <span class="site-name can-hide">小诺文档中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://opersdev.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小诺博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/devops/" class="nav-link">DevOps</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">云原生</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/wzdh/" class="nav-link">网址导航</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/opersdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/opersdev/docs/img/touxiang.jpg"> <div class="blogger-info"><h3>kevin</h3> <span>运维界的菜鸟</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://opersdev.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小诺博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/devops/" class="nav-link">DevOps</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">云原生</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/wzdh/" class="nav-link">网址导航</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/opersdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/af8481/" class="sidebar-link">redis</a></li><li><a href="/pages/67e803/" class="sidebar-link">mysql</a></li><li><a href="/pages/e1cbbf/" class="sidebar-link">mysql增删改查</a></li><li><a href="/pages/613b69/" class="sidebar-link">postgresql安装</a></li><li><a href="/pages/8ae632/" aria-current="page" class="active sidebar-link">oracle笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-1-安装oracle前准备" class="sidebar-link">1.1 安装Oracle前准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/8ae632/#_1-1-1-创建运行oracle数据库的系统用户和用户组" class="sidebar-link">1.1.1 创建运行oracle数据库的系统用户和用户组</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-2-修改操作系统核心参数" class="sidebar-link">1.2 修改操作系统核心参数</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-3-创建数据库软件目录和数据文件存放目录" class="sidebar-link">1.3 创建数据库软件目录和数据文件存放目录</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-4-更改目录属主为oracle用户所有-输入命令" class="sidebar-link">1.4 更改目录属主为Oracle用户所有，输入命令：</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-5-配置oracle用户的环境变量" class="sidebar-link">1.5 配置oracle用户的环境变量</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-6-关闭selinux-需重启生效" class="sidebar-link">1.6 关闭selinux（需重启生效）</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-7-正式oracle的安装过程" class="sidebar-link">1.7 正式Oracle的安装过程</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-8-配置监听listener" class="sidebar-link">1.8 配置监听listener</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-9-创建oracle数据实例orcl" class="sidebar-link">1.9 创建Oracle数据实例Orcl</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-10-linux下创建oracle用户表空间" class="sidebar-link">1.10 linux下创建oracle用户表空间</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_1-11-安装oracle数据库注意事项" class="sidebar-link">1.11  安装oracle数据库注意事项</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_2-1-用户授权" class="sidebar-link">2.1 用户授权</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_2-2-赋予用户创建表的权限" class="sidebar-link">2.2 赋予用户创建表的权限</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_2-3-赋予相应的权限" class="sidebar-link">2.3 赋予相应的权限</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_2-4-撤销权限" class="sidebar-link">2.4 撤销权限</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_3-1-系统默认用户" class="sidebar-link">3.1 系统默认用户</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_3-2-激活scott用户" class="sidebar-link">3.2 激活scott用户</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_3-3-新建表空间和用户-授权" class="sidebar-link">3.3 新建表空间和用户，授权</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_6-1-exp-imp导出和导入" class="sidebar-link">6.1 exp/imp导出和导入</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_6-2-expdp-impdp导出和导入" class="sidebar-link">6.2 expdp/impdp导出和导入</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_9-1-查询" class="sidebar-link">9.1 查询</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_10-1-设置内存相关参数" class="sidebar-link">10.1 设置内存相关参数</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_11-1-数据库性能优化的目标" class="sidebar-link">11.1 数据库性能优化的目标</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_11-2-建立数据库性能标准" class="sidebar-link">11.2 建立数据库性能标准</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_11-3-寻找关键变化" class="sidebar-link">11.3 寻找关键变化</a></li><li class="sidebar-sub-header level2"><a href="/pages/8ae632/#_11-4-检查操作系统资源" class="sidebar-link">11.4 检查操作系统资源</a></li></ul></li><li><a href="/pages/765fc1/" class="sidebar-link">opengauss笔记</a></li><li><a href="/pages/82abc5/" class="sidebar-link">达梦笔记</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/dba/#数据库" data-v-06225672>数据库</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/opersdev" target="_blank" title="作者" class="beLink" data-v-06225672>xiaonuo</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-06-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">oracle笔记<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="_1-oracle安装"><a href="#_1-oracle安装" class="header-anchor">#</a> 1. oracle安装</h1> <h2 id="_1-1-安装oracle前准备"><a href="#_1-1-安装oracle前准备" class="header-anchor">#</a> 1.1 安装Oracle前准备</h2> <h3 id="_1-1-1-创建运行oracle数据库的系统用户和用户组"><a href="#_1-1-1-创建运行oracle数据库的系统用户和用户组" class="header-anchor">#</a> 1.1.1 创建运行oracle数据库的系统用户和用户组</h3> <p>[humf@localhost ~]$ su root　　#切换到root</p> <p>Password:</p> <p>[root@localhost sonny]# groupadd oinstall　　#创建用户组oinstall</p> <p>[root@localhost sonny]# groupadd dba　　#创建用户组dba</p> <p>[root@localhost sonny]# useradd -g oinstall -g dba -m oracle　　#创建oracle用户，并加入到oinstall和dba用户组</p> <p>[root@localhost sonny]# passwd oracle　　#设置用户oracle的登陆密码，不设置密码，在CentOS的图形登陆界面没法登陆</p> <p>Changing password for user oracle.</p> <p>New password: 　　# 密码</p> <p>BAD PASSWORD: The password is shorter than 8 characters</p> <p>Retype new password: 　　# 确认密码</p> <p>passwd: all authentication tokens updated successfully.</p> <p>[root@localhost sonny]# id oracle # 查看新建的oracle用户</p> <p>uid=1001(oracle) gid=1002(dba) groups=1002(dba)</p> <p>[root@localhost sonny]#</p> <p>理论上单例按照需要3种用户组，实际只建两个oinstall和dba，后面再安装oracle数据库的时候把OSOPER组也设置是dba组。</p> <p>a.oracle 清单组（一般为oinstall):</p> <p>OINSTALL 组的成员被视为 Oracle 软件的“所有者”，拥有对 Oracle 中央清单 (oraInventory) 的写入权限。在一个 Linux 系统上首次安装 Oracle 软件时，</p> <p>OUI 会创建 /etc/oraInst.loc 文件。该文件指定 Oracle 清单组的名称（默认为 oinstall）以及 Oracle 中央清单目录的路径。</p> <p>b.数据库管理员（OSDBA，一般为 dba）:</p> <p>OSDBA 组的成员可通过操作系统身份验证使用 SQL 以 SYSDBA 身份连接到一个 Oracle 实例。该组的成员可执行关键的数据库管理任务，如创建数据库、启动和关</p> <p>闭实例。该组的默认名称为dba。SYSDBA 系统权限甚至在数据库未打开时也允许访问数据库实例。对此权限的控制完全超出了数据库本身的范围。不要混淆 SYSDBA</p> <p>系统权限与数据库角色 DBA。DBA 角色不包括 SYSDBA 或 SYSOPER 系统权限。</p> <p>c.数据库操作员组（OSOPER，一般为 oper）:</p> <p>OSOPER 组的成员可通过操作系统身份验证使用 SQL 以 SYSOPER 身份连接到一个 Oracle 实例。这个可选组的成员拥有一组有限的数据库管理权限，如管理和运行备份。</p> <p>该组的默认名称为oper。SYSOPER 系统权限甚至在数据库未打开时也允许访问数据库实例。对此权限的控制完全超出了数据库本身的范围。要使用该组，选择 Advanced 安装类型来安装 Oracle 数据库软件。</p> <h2 id="_1-2-修改操作系统核心参数"><a href="#_1-2-修改操作系统核心参数" class="header-anchor">#</a> 1.2 修改操作系统核心参数</h2> <p>在Root用户下执行以下步骤：</p> <p>1）修改用户的SHELL的限制，修改/etc/security/limits.conf文件</p> <p>输入命令：vi /etc/security/limits.conf，按i键进入编辑模式，将下列内容加入该文件。</p> <p>oracle soft nproc 2047</p> <p>oracle hard nproc 16384</p> <p>oracle soft nofile 1024</p> <p>oracle hard nofile 65536</p> <p>编辑完成后按Esc键，输入“:wq”存盘退出</p> <p>2）修改/etc/pam.d/login 文件，输入命令：vi /etc/pam.d/login，按i键进入编辑模式，将下列内容加入该文件。</p> <p>session required /lib/security/pam_limits.so</p> <p>session required pam_limits.so</p> <p>编辑完成后按Esc键，输入“:wq”存盘退出</p> <p>3）修改linux内核，修改/etc/sysctl.conf文件，输入命令: vi /etc/sysctl.conf ，按i键进入编辑模式，将下列内容加入该文件</p> <p>fs.file-max = 6815744</p> <p>fs.aio-max-nr = 1048576</p> <p>kernel.shmall = 2097152</p> <p>kernel.shmmax = 2147483648</p> <p>kernel.shmmni = 4096</p> <p>kernel.sem = 250 32000 100 128</p> <p>net.ipv4.ip_local_port_range = 9000 65500</p> <p>net.core.rmem_default = 4194304</p> <p>net.core.rmem_max = 4194304</p> <p>net.core.wmem_default = 262144</p> <p>net.core.wmem_max = 1048576</p> <p>编辑完成后按Esc键，输入“:wq”存盘退出</p> <p>4）要使 /etc/sysctl.conf 更改立即生效，执行以下命令。 输入：sysctl -p 显示如下：</p> <p>linux:~ # sysctl –p</p> <p>net.ipv4.icmp_echo_ignore_broadcasts = 1</p> <p>net.ipv4.conf.all.rp_filter = 1</p> <p>fs.file-max = 6815744</p> <p>fs.aio-max-nr = 1048576</p> <p>kernel.shmall = 2097152</p> <p>kernel.shmmax = 2147483648</p> <p>kernel.shmmni = 4096</p> <p>kernel.sem = 250 32000 100 128</p> <p>net.ipv4.ip_local_port_range = 9000 65500</p> <p>net.core.rmem_default = 4194304</p> <p>net.core.rmem_max = 4194304</p> <p>net.core.wmem_default = 262144</p> <p>net.core.wmem_max = 1048576</p> <p>5）编辑 /etc/profile ，输入命令：vi /etc/profile，按i键进入编辑模式，将下列内容加入该文件。</p> <p>if [ $USER = &quot;oracle&quot; ]; then</p> <p>if [ $SHELL = &quot;/bin/ksh&quot; ]; then</p> <p>ulimit -p 16384</p> <p>ulimit -n 65536</p> <p>else</p> <p>ulimit -u 16384 -n 65536</p> <p>fi</p> <p>fi</p> <p>编辑完成后按Esc键，输入“:wq”存盘退出</p> <h2 id="_1-3-创建数据库软件目录和数据文件存放目录"><a href="#_1-3-创建数据库软件目录和数据文件存放目录" class="header-anchor">#</a> 1.3 创建数据库软件目录和数据文件存放目录</h2> <p>目录的位置，根据自己的情况来定，注意磁盘空间即可，这里我把其放到oracle用户下,例如：</p> <p>输入命令：</p> <p>mkdir /home/oracle/app</p> <p>mkdir /home/oracle/app/oracle</p> <p>mkdir /home/oracle/app/oradata</p> <p>mkdir /home/oracle/app/oracle/product</p> <h2 id="_1-4-更改目录属主为oracle用户所有-输入命令"><a href="#_1-4-更改目录属主为oracle用户所有-输入命令" class="header-anchor">#</a> 1.4 更改目录属主为Oracle用户所有，输入命令：</h2> <p>chown -R oracle:oinstall /home/oracle/app</p> <h2 id="_1-5-配置oracle用户的环境变量"><a href="#_1-5-配置oracle用户的环境变量" class="header-anchor">#</a> 1.5 配置oracle用户的环境变量</h2> <p>输入：su – oracle ，然后直接在输入 ： vi .bash_profile</p> <p>按i编辑 .bash_profile,进入编辑模式，增加以下内容：</p> <p>export ORACLE_BASE=/home/oracle/app</p> <p>export ORACLE_HOME=$ORACLE_BASE/oracle/product/11.2.0/dbhome_1</p> <p>export ORACLE_SID=orcl</p> <p>export PATH=$PATH:$HOME/bin:$ORACLE_HOME/bin</p> <p>export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/usr/lib</p> <p>编辑完成后按Esc键，输入“:wq”存盘退出</p> <p>ps:我的云服务器没有防火墙，如果你们有，可以关闭</p> <p>--关闭防火墙 CentOS 7.2默认使用的是firewall作为防火墙</p> <p>[humf@localhost /]$ su root</p> <p>Password:</p> <p>[root@localhost /]# systemctl status firewalld.service　　#查看防火墙状态，运行中</p> <p>● firewalld.service - firewalld - dynamic firewall daemon</p> <p>Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</p> <p>Active: active (running) since Thu 2016-04-07 18:54:29 PDT; 2h 20min ago</p> <p>Main PID: 802 (firewalld)</p> <p>CGroup: /system.slice/firewalld.service</p> <p>└─802 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid</p> <p>Apr 07 18:54:25 localhost.localdomain systemd[1]: Starting firewalld - dynamic firewall daemon...</p> <p>Apr 07 18:54:29 localhost.localdomain systemd[1]: Started firewalld - dynamic firewall daemon.</p> <p>[root@localhost /]# systemctl stop firewalld.service　　#关闭防火墙</p> <p>[root@localhost /]# systemctl status firewalld.service　　#再次查看防火墙状态，发现已关闭</p> <p>● firewalld.service - firewalld - dynamic firewall daemon</p> <p>Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</p> <p>Active: inactive (dead) since Thu 2016-04-07 21:15:34 PDT; 9s ago</p> <p>Main PID: 802 (code=exited, status=0/SUCCESS)</p> <p>Apr 07 18:54:25 localhost.localdomain systemd[1]: Starting firewalld - dynamic firewall daemon...</p> <p>Apr 07 18:54:29 localhost.localdomain systemd[1]: Started firewalld - dynamic firewall daemon.</p> <p>Apr 07 21:15:33 localhost systemd[1]: Stopping firewalld - dynamic firewall daemon...</p> <p>Apr 07 21:15:34 localhost systemd[1]: Stopped firewalld - dynamic firewall daemon.</p> <p>[root@localhost /]# systemctl disable firewalld.service　　#禁止使用防火墙（重启也是禁止的）</p> <p>Removed symlink /etc/systemd/system/dbus-org.Fedoraproject.FirewallD1.service.</p> <p>Removed symlink /etc/systemd/system/basic.target.wants/firewalld.service.</p> <p>[root@localhost /]#</p> <p>防火墙先禁用，搞好之后再配置，个人虚拟机，要毛线防火墙~~</p> <h2 id="_1-6-关闭selinux-需重启生效"><a href="#_1-6-关闭selinux-需重启生效" class="header-anchor">#</a> 1.6 关闭selinux（需重启生效）</h2> <p>[root@localhost /]# vi /etc/selinux/config</p> <p>[root@localhost /]# cat /etc/selinux/config</p> <p># This file controls the state of SELinux on the system.</p> <p># SELINUX= can take one of these three values:</p> <p># enforcing - SELinux security policy is enforced.</p> <p># permissive - SELinux prints warnings instead of enforcing.</p> <p># disabled - No SELinux policy is loaded.</p> <p>SELINUX=disabled #此处修改为disabled</p> <p># SELINUXTYPE= can take one of three two values:</p> <p># targeted - Targeted processes are protected,</p> <p># minimum - Modification of targeted policy. Only selected processes are protected.</p> <p># mls - Multi Level Security protection.</p> <p>SELINUXTYPE=targeted</p> <p>[root@localhost /]#</p> <p>为啥要关闭selinux？因为selinux太高深，非专业人士搞不懂~~</p> <h2 id="_1-7-正式oracle的安装过程"><a href="#_1-7-正式oracle的安装过程" class="header-anchor">#</a> 1.7 正式Oracle的安装过程</h2> <p>1）当上述系统要求操作全部完成后，注销系统，在图形界面以Oracle用户登陆。</p> <p>PS:对于不会用图形界面的这边教你怎么用Windows远程连接Oracle图形界面</p> <p>前提:</p> <p>2.1.1 CentOS已经安装桌面，如果无桌面，请执行 （yum不会的可以百度，这边不赘述了）</p> <p># yum -y groups install &quot;GNOME Desktop&quot;</p> <p># startx</p> <p>2.1.2 配置源</p> <p><span></span># yum install epel* -y</p> <p>2.1.3 安装xrdp</p> <p><span><span></span></span># yum --enablerepo=epel -y install xrdp</p> <p>2.1.4 启动xrdp并设置开机启动</p> <p><span></span># systemctl start xrdp</p> <p># systemctl enable xrdp</p> <p>2.1.5 打开Windows的远程工具输入服务器IP用Oracle账户登陆就行</p> <p>首先将下载的Oracle安装包复制到linux中，用SSH其他ftp工具拷贝。</p> <p>打开一个终端，运行unzip命令解压oracle安装文件，如：</p> <p>输入命令：</p> <p>unzip linux.x64_11gR2_database_1of2.zip</p> <p>unzip linux.x64_11gR2_database_2of2.zip</p> <p>解压完成后 cd 进入其解压后的目录database</p> <p>输入命令：</p> <p>cd database</p> <p>使用ls命令可以查看解压后database所包含的文件，如下图：</p> <p>2）执行安装，输入命令：./runInstaller</p> <p>装到这一步，可以看到，可以查看到有很多的rpm包没有，这里可以通过yum安装</p> <p>我这边的是操作系统:Oracle Linux 7 centos</p> <p>The following packages (or later versions) must be installed:</p> <p>binutils-2.23.52.0.1-12.el7.x86_64</p> <p>compat-libcap1-1.10-3.el7.x86_64</p> <p>gcc-4.8.2-3.el7.x86_64</p> <p>gcc-c++-4.8.2-3.el7.x86_64</p> <p>glibc-2.17-36.el7.i686</p> <p>glibc-2.17-36.el7.x86_64</p> <p>glibc-devel-2.17-36.el7.i686</p> <p>glibc-devel-2.17-36.el7.x86_64</p> <p>ksh</p> <p>libaio-0.3.109-9.el7.i686</p> <p>libaio-0.3.109-9.el7.x86_64</p> <p>libaio-devel-0.3.109-9.el7.i686</p> <p>libaio-devel-0.3.109-9.el7.x86_64</p> <p>libgcc-4.8.2-3.el7.i686</p> <p>libgcc-4.8.2-3.el7.x86_64</p> <p>libstdc++-4.8.2-3.el7.i686</p> <p>libstdc++-4.8.2-3.el7.x86_64</p> <p>libstdc++-devel-4.8.2-3.el7.i686</p> <p>libstdc++-devel-4.8.2-3.el7.x86_64</p> <p>libXi-1.7.2-1.el7.i686</p> <p>libXi-1.7.2-1.el7.x86_64</p> <p>libXtst-1.2.2-1.el7.i686</p> <p>libXtst-1.2.2-1.el7.x86_64</p> <p>make-3.82-19.el7.x86_64</p> <p>sysstat-10.1.5-1.el7.x86_64</p> <p>一个一个的安装,命令也很简单，反正文档要求高版本也可以：</p> <p>[humf@localhost data]$ su root</p> <p>Password:</p> <p>[root@localhost data]# yum install binutils</p> <p>省略...</p> <p>一个一个检查package，在准备阶段中漏掉的，此处再安装，有些系统报错是因为现有的包的版本比检测要高，最后右上角忽略即可</p> <p>3）安装过程是一个漫长的过程，中间有几次卡住，没有出现任何画面，屏幕中间有条小线，尝试多次，发现光标在该线上，右键点击Closed，不知道关闭了啥，又能继续安装了。先装吧，到时有问题看日志</p> <h2 id="_1-8-配置监听listener"><a href="#_1-8-配置监听listener" class="header-anchor">#</a> 1.8 配置监听listener</h2> <p>1）执行netca 报错</p> <p>[Oracle@localhost ~]$ netca</p> <p>Oracle Net Services Configuration:</p> <p>#</p> <p># An unexpected error has been detected by HotSpot Virtual Machine:</p> <p>#</p> <p># SIGSEGV (0xb) at pc=0x00007f69a69fcb9d, pid=8033, tid=140092892297024</p> <p>#</p> <p># Java VM: Java HotSpot(TM) 64-Bit Server VM (1.5.0_17-b03 mixed mode)</p> <p># Problematic frame:</p> <p># C [libclntsh.so.11.1+0x62ab9d] snlinGetAddrInfo+0x1b1</p> <p>#</p> <p># An error report file with more information is saved as hs_err_pid8033.log</p> <p>#</p> <p># If you would like to submit a bug report, please visit:</p> <p># http://java.sun.com/webapps/bugreport/crash.jsp</p> <p>#</p> <p>/data/oracle/product/11.2.0/db_1/bin/netca: line 178: 8033 Aborted (core dumped) $JRE $JRE_OPTIONS -classpath $CLASSPATH oracle.net.ca.NetCA $*</p> <p>[oracle@localhost ~]$</p> <p>错误原因：安装操作系统是默认主机名localhost造成错误</p> <p>解决办法：</p> <p>racle]# cat /etc/sysconfig/network</p> <p># Created by anaconda</p> <p>[root@localhost oracle]# vi /etc/sysconfig/network　　#增加HOSTNAME</p> <p>[root@localhost oracle]# cat /etc/sysconfig/network</p> <p># Created by anaconda</p> <p>HOSTNAME=odb-sonny</p> <p>[root@localhost oracle]# cat /etc/hosts</p> <p>127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</p> <p>::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</p> <p>[root@localhost oracle]# vi /etc/hosts　　#增加HOSTNAME</p> <p>[root@localhost oracle]# cat /etc/hosts</p> <p>127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 odb-sonny</p> <p>::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</p> <p>[root@localhost oracle]# hostname odb-sonny　　#执行</p> <p>[root@localhost oracle]#</p> <p>最后注销当前oracle用户，重新登陆即可！！这次发现打开配置界面正常</p> <h2 id="_1-9-创建oracle数据实例orcl"><a href="#_1-9-创建oracle数据实例orcl" class="header-anchor">#</a> 1.9 创建Oracle数据实例Orcl</h2> <p>执行dbca命令，启动oracle实例安装界面，剩下的与Windows上安装一样，不废话了：</p> <p>注意：必须先创建监听，并且监听是启动中，否则报错。</p> <p>经过漫长的等待，当看到此界面，说明oracle建库完成</p> <p>这样oracle服务器安装配置基本就完成了</p> <p>注意：</p> <p>1、Linux oracle数据库listener.ora存放路径</p> <p>cd /home/oracle/app/oracle/product/11.2.0/dbhome_1/network/admin/listener.ora</p> <p>2、Linux oracle数据库tnsnames.ora存放路径</p> <p>cd /home/oracle/app/oracle/product/11.2.0/dbhome_1/network/admin/tnsnames.ora</p> <p>3、ORACLE启动监听器</p> <p>(1)切换至oracle安装用户（一般为oracle）</p> <p>su - oracle</p> <p>(2)启动监听器</p> <p>lsnrctl start</p> <p>(3)停止监听器</p> <p>lsnrctl stop</p> <p>4、启动测试oracle：</p> <p>[oracle@oracle ~]$ sqlplus /nolog</p> <p>SQL*Plus: Release 11.2.0.1.0 Production on Fri Jul 27 02:12:12 2012</p> <p>Copyright (c) 1982, 2009, Oracle. All rights reserved.</p> <p>SQL&gt; quit</p> <p>测试的另一种方法：找一台windows平台电脑，telnet oracle主机IP地址：1521，通的话，会出现一个黑屏，光标一闪一闪。</p> <p>5、Linux开放1521端口允许网络连接Oracle Listener</p> <p>症状：</p> <p>(1)TCP/IP连接是通的。可以用ping 命令测试。</p> <p>(2)服务器上Oracle Listener已经启动。</p> <p>lsnrctl status 查看listener状态</p> <p>lsnrctl start 启动Oracle listener</p> <p>(3)客户端得到的错误信息通常是：ORA-12170： TNS:连接超时</p> <p>这时，我们基本可以肯定是服务器没有开放1521端口（假设你用默认设置）</p> <p>解决方法：</p> <p>(1)假如你是在一个局域网环境，配置了防火墙。那么可以关闭Linux的防火墙。</p> <p>sudo service iptables stop</p> <p>(2)编辑iptables, 开放1521端口：</p> <p>sudo vi /etc/sysconfig/iptables</p> <p>-A INPUT -p tcp -m state --state NEW -m tcp --dport 1521 -j ACCEPT</p> <p>:wq</p> <p>重启防火墙</p> <p>sudo service iptables restart</p> <p>保存配置，以便linux重启后依然有效</p> <p>sudo service iptables save</p> <p>查看防火墙规则：</p> <p>sudo iptables -L –n</p> <p>PS:如果你是云服务器，请看看自己的安全策略组有没有给1521添加</p> <h2 id="_1-10-linux下创建oracle用户表空间"><a href="#_1-10-linux下创建oracle用户表空间" class="header-anchor">#</a> 1.10 linux下创建oracle用户表空间</h2> <p>就是在已有的数据库实例上创建一个新的帐号，访问一些新的表</p> <p>操作步骤如下：</p> <p>(1)登录linux，以oracle用户登录（如果是root用户登录的，登录后用 su - oracle命令切换成oracle用户）</p> <p>(2)以sysdba方式来打开sqlplus，命令如下： sqlplus &quot;/as sysdba&quot;</p> <p>(3)查看我们常规将用户表空间放置位置：执行如下sql：</p> <p>select name from v$datafile</p> <p>(4)创建用户表空间：</p> <p>CREATE TABLESPACE NOTIFYDB DATAFILE '/home/oracle/app/oradata/orcl/scsdb.dbf' SIZE 200M AUTOEXTEND ON EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT AUTO;</p> <p>(5)创建用户，指定密码和上边创建的用户表空间</p> <p>CREATE USER scs IDENTIFIED BY scs DEFAULT TABLESPACE NOTIFYDB;</p> <p>(6)赋予权限</p> <p>grant connect,resource to scs;</p> <p>grant unlimited tablespace to scs;</p> <p>grant create database link to scs;</p> <p>grant select any sequence,create materialized view to scs;</p> <p>--经过以上操作，我们就可以使用scs/scs登录指定的实例，创建我们自己的表了</p> <h2 id="_1-11-安装oracle数据库注意事项"><a href="#_1-11-安装oracle数据库注意事项" class="header-anchor">#</a> 1.11  安装oracle数据库注意事项</h2> <p>1、按照官方文档安装数据库</p> <p>检查操作系统环境。如CPU位数、内存数量、交换分区大小</p> <p>操作系统内核参数设置</p> <p>关闭selinux</p> <p>检查磁盘空间大小</p> <p>检查/etc/hosts域名配置文件</p> <p>2、安装之前没有检查操作系统错误</p> <p>/var/log/messages</p> <p>3、安装过程中网络异常终止</p> <p>导致前台ssh连接中断，安装终止</p> <p>1、数据连接类故障</p> <p>检查是否由网络故障引起</p> <p>检查是否由主机资源不足引起</p> <p>检查是否由监听故障引起</p> <p>​    CPU使用率，观察sqlnet.log日志</p> <p>检查是否由数据库故障引起</p> <p>​    select * from v$session_wait;</p> <p>2、数据库无响应(hang类)故障</p> <p>主机资源达到瓶颈</p> <p>进程之间的死锁</p> <p>所有在线日志均为ACTIVE状态，或者归档空间不足导致无法归档</p> <p>3、数据库性能类故障</p> <p>性能类故障的处理思路</p> <p>​    了解主机的硬件情况、业务系统的拓扑架构</p> <p>​    登录到主机，查看主机的资源消耗情况（主要使用top\vmstat\iostat)</p> <p>​    登录到数据库，查看活动状态的会话数</p> <p>​    下面是获取LOCK相关的资源持有者信息的SQL</p> <p>​      select * from gv$lock where block=1;</p> <p>​      select * from dba_waiters;</p> <p>​    下面是获取LATCH相关的持有者信息的SQL</p> <p>​      select * from v$latchholder;</p> <p>数据误操作类故障的处理思路</p> <p>​    如果有备份，则评估一下恢复时间和数据丢失率</p> <p>​    如果表被误删（DROP)，首先查看回收站中是否存在误删除表，如果不存在，则使用DUL等挖掘工具恢复数据</p> <p>​    如果数据被误删除（DELETE），则使用表闪回版本查询特性查看是否能挽救误删除</p> <p>4、数据库坏块类故障</p> <p>一般出现ORA-01578,ORA-10632,ORA-00600错误</p> <p>产生坏块的原因</p> <p>​    硬件问题。如内存混乱，CPU计算错误</p> <p>​    操作系统BUG</p> <p>​    非oracle进程异常修改oracle SGA内存区域</p> <p>​    主机或者存储异常掉电</p> <p>处理思路</p> <p>​    使用dbv,rman,exp,expdp检验数据库的坏块数量</p> <p>​    如果索引出现坏块，则考虑删除并重建索引</p> <p>​    如果表出现坏块，全表扫描时可以跳过坏块</p> <p>​    全用bbed工具尝试修复坏块，较为复杂且风险较大</p> <p>tnsping命令检查连接串是否配置，配置语法是否正确</p> <p>tnsping oracledb:1521/orcl</p> <p>tnsping并不检查实例服务和句柄</p> <p>ssh端口转发</p> <p>客户端通过ssh免密连接到服务端的oracle服务</p> <p>ssh -CNfg -L 1555:118.126.93.180:1521 root@118.126.93.180</p> <p>跟踪监听的工作过程</p> <p>select * from v$process;</p> <p>监听的优化思路</p> <p>1、在listener.ora和tnsnames.ora配置文件中增加关键字（SDU=4096)来增加缓冲大小。如果是在共享服务器模式下，则可以在数据库参数DISPATCHERS增加关键字（SDU=8192)来增加缓冲区大小。而对于动态注册环境，只需要在客户端和服务端的配置文件sqlnet.ora中增加DEFAULT_SDU_SIZE=8192即可</p> <p>2、调整操作系统的TCP的发送和接受缓冲区大小</p> <p>3、调整oracle的TCP的发送和接受缓冲区大小。调整SEND/RECVBUF_SIZE大小来达到这一目的。从经验上看，这两个参数在广域网传输中能提高一定的性能</p> <p>4、通过设置监听参数QUEUESIZE来提高监听处理的最大并发数</p> <p>5、增加监听来处理更多的并发数。比如增加多个端口</p> <p>6、将客户端连接方式从短连接修改为长连接或都使用连接池。大量的短连接无疑会消耗更多的CPU和内存</p> <h1 id="_2-oracle授权"><a href="#_2-oracle授权" class="header-anchor">#</a> 2. oracle授权</h1> <p>Oracle提供了三种权限：</p> <p>connect role(连接角色)：connect是使用oracle简单权限，这种权限只对其他用户的表有访问权限，包括select/insert/update和delete等。拥有connect role 的用户还能够创建表、视图、序列（sequence）、簇（cluster）、同义词(synonym)、回话（session）和其他 数据的链（link)。</p> <p>resource role(资源角色)：resource提供给用户另外的权限以创建他们自己的表、序列、过程(procedure)、触发器(trigger)、索引(index)和簇(cluster)。</p> <p>dba role(数据库管理员角色)：包括无限制的空间限额和给其他用户授予各种权限的能力。</p> <p>sqlplus sys/sys as sysdba;</p> <p>create user test identified by test;</p> <h2 id="_2-1-用户授权"><a href="#_2-1-用户授权" class="header-anchor">#</a> 2.1 用户授权</h2> <p>SQL&gt; grant connect, resource dba to username;</p> <p>grant create session to test;</p> <p>这样test用户就能成功登录进去</p> <h2 id="_2-2-赋予用户创建表的权限"><a href="#_2-2-赋予用户创建表的权限" class="header-anchor">#</a> 2.2 赋予用户创建表的权限</h2> <p>grant create table to test;</p> <h2 id="_2-3-赋予相应的权限"><a href="#_2-3-赋予相应的权限" class="header-anchor">#</a> 2.3 赋予相应的权限</h2> <p>grant unlimited tablespace to test;</p> <p>这个时候用户就拥有了创建表的权限 由于表是用户test的，相应的他就拥有了对创建的表的增删查改的权限了</p> <h2 id="_2-4-撤销权限"><a href="#_2-4-撤销权限" class="header-anchor">#</a> 2.4 撤销权限</h2> <p>revoke create table from test;</p> <h1 id="_3-oracle用户管理"><a href="#_3-oracle用户管理" class="header-anchor">#</a> 3. oracle用户管理</h1> <p>drop user 用户名;</p> <p>若用户拥有对象，则不能直接删除，否则将返回一个错误值。指定关键字cascade,可删除用户所有的对象，然后再删除用户。</p> <p>drop user 用户名 cascade;</p> <h2 id="_3-1-系统默认用户"><a href="#_3-1-系统默认用户" class="header-anchor">#</a> 3.1 系统默认用户</h2> <p>默认用户名和密码有：</p> <p>1、用户名: internal</p> <p>密码:oracle</p> <p>2、用户名:system</p> <p>密码:manager</p> <p>3、用户名:sys</p> <p>密码:change_on_install</p> <p>修改用户的密码.</p> <p>在系统运行中输入：sqlplus /nolog</p> <p>在命令窗口分别执行：conn /as sysdba</p> <p>alter user scott identified by tiger;</p> <p>alter user scott account unlock;</p> <p>然后“scott”用户密码就修改为“tiger”了，用户可根据自己需求，重置密码。</p> <p>alter user zzg identified by unis;</p> <p>grant create session,create table,create view,create sequence,unlimited tablespace to zzg;</p> <h2 id="_3-2-激活scott用户"><a href="#_3-2-激活scott用户" class="header-anchor">#</a> 3.2 激活scott用户</h2> <p>alter database open;</p> <p>alter user scott account unlock;</p> <p>alter user scott identified by tiger;</p> <p>select username,account_status from dba_users;</p> <h2 id="_3-3-新建表空间和用户-授权"><a href="#_3-3-新建表空间和用户-授权" class="header-anchor">#</a> 3.3 新建表空间和用户，授权</h2> <p>CREATE TABLESPACE YTH_DATA_TBS</p> <p>DATAFILE 'D:\oracledata\orcl\YTH_DATA_TBS_01.DBF'</p> <p>SIZE 500M</p> <p>AUTOEXTEND ON NEXT 500M</p> <p>MAXSIZE UNLIMITED</p> <p>create user jiangxi identified by jiangxi default tablespace YTH_DATA_TBS;</p> <p>GRANT CREATE USER,DROP USER,ALTER USER ,CREATE ANY VIEW ,DROP ANY VIEW,EXP_FULL_DATABASE,IMP_FULL_DATABASE,DBA,CONNECT,RESOURCE,CREATE SESSION TO jiangxi;</p> <p>grant create table to jiangxi;</p> <p>grant connect to jiangxi;</p> <p>grant resource to jiangxi;</p> <p>grant dba to jiangxi;</p> <p>imp jiangxi/jiangxi@localhost/orcl file=G:/jiangxi.dmp full=y</p> <p>alter database datafile 'E:\oracle\product\10.2.0\oradata\test.dbf' resize 2000m;</p> <p>test.dbf  --更改表空间大小</p> <h1 id="_4-通过命令直接建立oracle实例"><a href="#_4-通过命令直接建立oracle实例" class="header-anchor">#</a> 4. 通过命令直接建立oracle实例</h1> <p>dbca -silent -createDatabase -templateName General_Purpose.dbc -gdbname orcl -sid orcl -sysPassword syc -systemPassword syc -responseFile NO_VALUE -datafileDestination /u01/app/oracle/oradata -redoLogFileSize 50 -recoveryAreaDestination /u01/app/oracle/fast_recovery_area -storageType FS -characterSet ZHS16GBK -nationalCharacterSet AL16UTF16 -sampleSchema true -memoryPercentage 30 -totalMemory 200 -databaseType OLTP -emConfiguration NONE</p> <p>shell执行sql语句</p> <p>su - oracle -c &quot;sqlplus sys/oracle as sysdba&lt;&lt;EOF</p> <p>alter user scott account unlock;</p> <p>alter user scott identified by tiger;</p> <p>quit</p> <p>EOF&quot;</p> <p>&quot;sqlplus -S '/ as sysdba' &lt;&lt; &quot;select username,account_status from dba_users;&quot;&quot;</p> <p>The Oracle system identifier(SID) &quot;orcl&quot; already exists. Specify another SID</p> <p>注释/etc/oratab</p> <p>sqlplus -S sys/sys@localhost select username,account_status from dba_users;</p> <p>runInstaller -silent -responseFile /home/oracle/db_install.rsp -ignorePrereq</p> <p># -silent      指定使用静默模式安装，并使用应答响应文件</p> <p># -responseFile   指定响应文件路径</p> <p># -ignorePrereq   忽略运行先决条件检查</p> <p>configure channel 2 device type disk format '/home/oracle/backup/bakup_%U';</p> <p>configure controlfile autobackup format for device type disk to '/home/oracle/backup/ctl_%F';</p> <p>检查确认数据库实例是否启动。</p> <p>SQL&gt; select status from v$instance;</p> <p>启停数据库</p> <p>// 停止数据库实例</p> <p>sqlplus / as sysdba</p> <p>// 进入sqlplus后，关闭数据库</p> <p>shutdown immediate</p> <p>// 启动数据库命令</p> <p>startup</p> <p>// 退出</p> <p>exit</p> <p>监听服务</p> <p>// 查看状态</p> <p>lsnrctl status</p> <p>// 停止监听服务</p> <p>lsnrctl stop</p> <p>// 启动监听服务</p> <p>lsnrctl start</p> <p>// 查看服务</p> <p>lsnrctl service</p> <p>sqlplus相关配置</p> <p>set linesize 200;</p> <p>set pagesize 30;</p> <p>set heading off;</p> <p>//登录</p> <p>sqlplus test/123456@10.16.1.111:1521/orcl</p> <p>sqlplus脚本相关</p> <p>sqlplus中引用shell变量</p> <p>表空间相关创建表空间</p> <p>//单个文件不能超过32G，总文件数不能超过db_files参数</p> <p>create tablespace sxdata2 logging datafile '/mnt/data2/oradata/sxdata.dbf' size 10000m autoextend on next 200m maxsize 3500000m extent management local;</p> <p>// 增加表空间文件</p> <p>add tablespace sxdata2 datafile '/mnt/data2/oradata/sxdata1.dbf' size 10000m autoextend on next 200m maxsize 3500000m;</p> <p>// bigfile创建的表空间不受单个文件32G的限制，但不能增加datafile</p> <p>create bigfile tablespace sxdata2 logging datafile '/mnt/data2/oradata/sxdata.dbf' size 10000m autoextend on next 200m maxsize 3500000m extent management local;</p> <p>查看表空间</p> <p>select username, default_tablespace from dba_users;</p> <p>// 查看用户表空间</p> <p>select USERNAME,DEFAULT_TABLESPACE from dba_users where USERNAME='';</p> <p>查看表数据量</p> <p>select bytes/1024/1024 as &quot;MB&quot;,segment_name from user_segments group by segment_name;</p> <p>创建DBLINK</p> <p>create public database link qhfklink connect to myusername identified by 123456</p> <p>using '(DESCRIPTION =(ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.1.10)(PORT = 1521))</p> <p>)</p> <p>(CONNECT_DATA = (SERVICE_NAME = orcl)))';</p> <p>用户相关创建用户、授权</p> <p>CREATE USER dbtest IDENTIFIED BY 123456 ;</p> <p>grant resource,connect,dba to dbtest;</p> <p>impdp expdp创建数据目录、授权</p> <p>CREATE DIRECTORY dumptest AS ‘/home/oracle/dbtest’;</p> <p>GRANT READ,WRITE ON DIRECTORY dumptest TO dbtest;</p> <p>创建测试数据</p> <p>create table t1 (id int);</p> <p>insert into t1 values (123);</p> <p>创建物理数据目录，导出</p> <p>mkdir /home/oracle/dbtest</p> <p>按照表导出</p> <p>expdp dbtest/123456@orcl directory=dumptest dumpfile=test.dmp tables=t1</p> <p>其他示例（待整理）</p> <p>1)按用户导</p> <p>expdp scott/tiger@orcl schemas=scott dumpfile=expdp.dmp DIRECTORY=dpdata1;</p> <p>2)并行进程parallel</p> <p>expdp scott/tiger@orcl directory=dpdata1 dumpfile=scott3.dmp parallel=40 job_name=scott3</p> <p>3)按表名导</p> <p>expdp scott/tiger@orcl TABLES=emp,dept dumpfile=expdp.dmp DIRECTORY=dpdata1;</p> <p>4)按查询条件导</p> <p>expdp scott/tiger@orcl directory=dpdata1 dumpfile=expdp.dmp Tables=emp query='WHERE deptno=20';</p> <p>5)按表空间导</p> <p>expdp system/manager DIRECTORY=dpdata1 DUMPFILE=tablespace.dmp TABLESPACES=temp,example;</p> <p>6)导整个数据库</p> <p>expdp system/manager DIRECTORY=dpdata1 DUMPFILE=full.dmp FULL=y;</p> <p>导入数据</p> <p>导入前，删除dbtest用户下的t1表，测试导入；</p> <p>impdp dbtest/123456@orcl directory=dumptest dumpfile=test.dmp tables=t1</p> <p>参考</p> <p>http://www.cnblogs.com/hellojesson/p/9070597.html</p> <p>https://www.cnblogs.com/peterpanzsy/p/3435018.html</p> <p>字符集相关查看服务端字符集</p> <p>select * from nls_database_parameters;</p> <p>设置客户端字符集</p> <p>export NLS_LANG=&quot;SIMPLIFIED CHINESE_CHINA.ZHS16GBK&quot;</p> <h1 id="_5-oracle开机自启"><a href="#_5-oracle开机自启" class="header-anchor">#</a> 5. oracle开机自启</h1> <p>cat &gt;/usr/lib/systemd/system/oracle.service &lt;&lt;EOF</p> <p># /etc/systemd/system/oracle-rdbms.service</p> <p># Invoking Oracle scripts to start/shutdown Instances defined in /etc/oratab</p> <p># and starts Listener</p> <p>[Unit]</p> <p>Description=Oracle Database(s) and Listener</p> <p>Requires=network.target</p> <p>[Service]</p> <p>Type=forking</p> <p>Restart=no</p> <p>ExecStart=$ORACLE_HOME/bin/dbstart $ORACLE_HOME</p> <p>ExecStop=$ORACLE_HOME/bin/dbshut $ORACLE_HOME</p> <p>User=oracle</p> <p>[Install]</p> <p>WantedBy=multi-user.target</p> <p>EOF</p> <p># 将服务器设为开机自启</p> <p>systemctl enable oracle &amp;&amp; systemctl restart oracle</p> <h1 id="_6-oracle导入导出"><a href="#_6-oracle导入导出" class="header-anchor">#</a> 6. oracle导入导出</h1> <h2 id="_6-1-exp-imp导出和导入"><a href="#_6-1-exp-imp导出和导入" class="header-anchor">#</a> 6.1 exp/imp导出和导入</h2> <p>导入dmp数据库</p> <p>imp test/111111@XE file=D:/zjyd.dmp full=y</p> <p>格式说明——imp 用户名/秘钥@数据库版本名称 file=dmp文件路径 full=y</p> <p>然后回车，即开始导入数据库。</p> <p>exp jiangxi/jiangxi file=/tmp/cjpt.dmp</p> <p>imp jiangxi/jiangxi file=/opt/cjpt.dmp full=y</p> <p>导出工具exp非交互式命令行方式的例子</p> <p>$ exp scott/tiger tables=(emp,dept) file=/directory/scott.dmp grants=y</p> <p>说明:把scott用户里两个表emp,dept导出到文件/directory/scott.dmp</p> <p>$ exp scott/tiger tables=emp query=&quot;where job='salesman' and sal&lt;1600&quot; file=/directory/scott2.dmp</p> <p>说明:在exp里面加上导出emp的查询条件job='salesman' and sal&lt;1600</p> <p>(但我个人很少这样用,还是把满足条件的记录生成临时表后,再exp会方便一些)</p> <p>$ exp parfile=username.par file=/directory1/username_1.dmp,/directory1/username_2.dmp filesize=2000M log=/directory2/username_exp.log</p> <p>导入工具imp非交互式命令行方式的例子</p> <p>$ imp system/manager fromuser=jones tables=(accts)</p> <p>$ imp system/manager fromuser=scott tables=(emp,dept)</p> <p>$ imp system/manager fromuser=scott touser=joe tables=emp</p> <p>$ imp scott/tiger file = expdat.dmp full=y</p> <p>$ imp scott/tiger file = /mnt1/t1.dmp show=n buffer=2048000 ignore=n commit=y grants=y full=y log=/oracle_backup/log/imp_scott.log</p> <p>$ imp system/manager parfile=params.dat</p> <p>params.dat 内容</p> <p>file=dba.dmp show=n ignore=n grants=y fromuser=scott tables=(dept,emp)</p> <p>不同用户之前导出导入（表空间需要一样）</p> <p>imp fujian/fujian fromuser=personinfo touser=fujian file=/tmp/cjpt.dmp</p> <h2 id="_6-2-expdp-impdp导出和导入"><a href="#_6-2-expdp-impdp导出和导入" class="header-anchor">#</a> 6.2 expdp/impdp导出和导入</h2> <p>1、expdp/impdp和exp/imp的区别</p> <p>1.exp和imp是客户端工具程序，它们既可以在客户端使用，也可以在服务端使用。</p> <p>2.expdp和impdp是服务端的工具程序，他们只能在oracle服务端使用，不能在客户端使用。</p> <p>3.imp只适用于exp导出的文件，不适用于expdp导出文件；impdp只适用于expdp导出的文件，而不适用于exp导出文件。</p> <p>4.对于10g以上的服务器，使用exp通常不能导出0行数据的空表，而此时必须使用expdp导出。</p> <p>本节主要讲解的是expdp/impdp的用法，不涉及到exp和imp</p> <p>2、导出数据</p> <p>在准备要备份的数据库服务器上创建备份目录（在后面使用sql命令创建的逻辑目录并不是在OS上创建目录，所以我们先要在服务器上创建一个目录）</p> <p># su oracle</p> <p>$ mkdir /home/oracle/oracle_bak</p> <p>用管理员身份登录到sqlplus</p> <p>$ sqlplys /nolog</p> <p>SQL&gt; conn sys/oracle as sysdba</p> <p>创建逻辑目录</p> <p>SQL&gt; create directory data_dir as '/home/oracle/oracle_bak';</p> <p>查看管理员目录是否存在</p> <p>SQL&gt; select * from dba_direcories;</p> <p>使用管理员用户给指定的用户赋予在该目录的操作权限（比如该用户需要备份自己的数据）</p> <p>SQL&gt; grant read,write on directory data_dir to C##BAK_TEST_USER;</p> <p>导出可有五种方式</p> <p>1、“full=y”，全量导出数据库</p> <p>$ expdp sys/oracle@orcl dumpfile=expdp.dmp directory=data_dir full=y logfile=expdp.log</p> <p>2、schemas按用户导出</p> <p>$ expdp user/passwd@orcl schemas=user dumpfile=expdp.dmp directory=data_dir logfile=expdp.log</p> <p>3、按表空间导出</p> <p>$ expdp sys/passwd@orcl tablespace=tbs1,tbs2 dumpfile=expdp.dmp directory=data_dir logfile=expdp.log</p> <p>4、导出表</p> <p>$ expdp user/passwd@orcl tables=table1,table2 dumpfile=expdp.dmp directory=data_dir logfile=expdp.log</p> <p>5、按查询条件导出</p> <p>$ expdp user/passwd@orcl tables=table1='where number=1234' dumpfile=expdp.dmp directory=data_dir logfile=expdp.log</p> <p>2、导入数据</p> <p>首先将需要导入的数据文件存放导需要导入的数据库服务器上</p> <p>参照导出的时候的建立目录方式建立物理目录和逻辑目录（只是建目录即可，如果需要给用户权限则加上给用户权限的那步）</p> <p>使用命令导入，同时，导入方式也可以分为五种，分别对应着导出的五种方式</p> <p>1、“full=y”，全量导入数据库；</p> <p>impdp user/passwd directory=data_dir dumpfile=expdp.dmp full=y</p> <p>2、同名用户导入，从用户A导入到用户A；</p> <p>impdp A/passwd schemas=A directory=data_dir dumpfile=expdp.dmp logfile=impdp.log;</p> <p>3、</p> <p>①从A用户中把表table1和table2导入到B用户中；</p> <p>impdp B/passwdtables=A.table1,A.table2 remap_schema=A:B directory=data_dir dumpfile=expdp.dmp logfile=impdp.log;</p> <p>②将表空间TBS01、TBS02、TBS03导入到表空间A_TBS，将用户B的数据导入到A，并生成新的oid防止冲突；</p> <p>impdp A/passwd remap_tablespace=TBS01:A_TBS,TBS02:A_TBS,TBS03:A_TBS remap_schema=B:A FULL=Y transform=oid:n</p> <p>directory=data_dir dumpfile=expdp.dmp logfile=impdp.log</p> <p>4、导入表空间；</p> <p>impdp sys/passwd tablespaces=tbs1 directory=data_dir dumpfile=expdp.dmp logfile=impdp.log</p> <p>5、追加数据；</p> <p>impdp sys/passwd directory=data_dir dumpfile=expdp.dmp schemas=system table_exists_action=replace logfile=impdp.log; --table_exists_action:导入对象已存在时执行的操作。有效关键字:SKIP,APPEND,REPLACE和TRUNCATE</p> <h1 id="_7-oracle使用方向键和回退"><a href="#_7-oracle使用方向键和回退" class="header-anchor">#</a> 7. oracle使用方向键和回退</h1> <p>oracle中sqlplus必备的rlwrap。安装后可以正常使用方向键和回退等。</p> <p>https://gitee.com/mirrors/rlwrap</p> <p>在安装rlwrap之前需要安装readline</p> <p>yum install readline</p> <p>yum install rlwrap</p> <p>接着安装rlwrap</p> <p>可以使用rlwrap的rpm包安装</p> <h1 id="_8-oracle报错"><a href="#_8-oracle报错" class="header-anchor">#</a> 8. oracle报错</h1> <p>emctl start dbconsole</p> <p>报错信息：</p> <p>OC4J Configuration issue. /u01/app/oracle/product/11.2.0/dbhome_1/oc4j/j2ee/OC4J_DBConsole_orcl-db-01_orcl not found.</p> <p>解决办法：</p> <p>$emca -config dbcontrol db -repos recreate;</p> <p>注意：（重新创建DBCONSOLE：（如果是在windows下，要先到注册表删除DBCONSOLE（HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/OracleDBconsole）的服务，重启电脑））</p> <p>根据提示，</p> <p>先输入SID，</p> <p>输入监听程序端口端口1521，</p> <p>输入SYS密码，</p> <p>输入DBSNMP密码，</p> <p>输入SYSMAN 密码，</p> <p>输入Y继续</p> <p>完成。</p> <p>输入startup,</p> <p>#startup的输出提示：</p> <p>SQL&gt; statup</p> <p>SP2-0042: unknown command &quot;statup&quot; - rest of line ignored.</p> <p>SQL&gt; startup</p> <p>ORA-01078: failure in processing system parameters</p> <p>LRM-00109: could not open parameter file '/data/app/oracle/product/11.2.0/dbs/initORCL.ora'</p> <p>根据提示，将ORACLEBASE/admin/数据库名称/pfile目录下的init.ora.xxx形式的文件copy到 ORACLE_BASE/admin/数据库名称/pfile目录下的init.ora.xxx形式的文件copy到ORACLE</p> <p>B</p> <p>​</p> <p>ASE/admin/数据库名称/pfile目录下的init.ora.xxx形式的文件copy到ORACLE_HOME/dbs目录下initOracle.ora（根据startup提示）即可</p> <p>cp /data/app/oracle/admin/orcl/pfile/init.ora.022019183329 initORCL.ora</p> <p>expdp备份报错</p> <p>ORA-39006: internal error</p> <p>ORA-39213: Metadata processing is not available</p> <p>sqlplus / as sqlplus</p> <p>execute dbms_metadata_util.load_stylesheets;</p> <p>报错解决</p> <p>ORA-12547的故障解决思路</p> <p>当出现上述错误时，通常需要检查以下内容</p> <p>1、检查操作系统内核参数是否无误，检查当前会话的资源限制</p> <p>2、确认$ORACLE_HOME/bin/oracle文件权限是否有问题</p> <p>3、检查以下环境变量设置是否存在问题，注意环境变量LD_LIBRARY_PATH</p> <p>4、检查$ORACLE_HOME/bin/oracle 和$ORACLE_HOME/rdbms/lib/config.o的文件大小</p> <h1 id="_9-增删改查"><a href="#_9-增删改查" class="header-anchor">#</a> 9.增删改查</h1> <h2 id="_9-1-查询"><a href="#_9-1-查询" class="header-anchor">#</a> 9.1 查询</h2> <p>查看所有用户：</p> <p>select * from dba_users;</p> <p>select * from all_users;</p> <p>select * from user_users;</p> <p>查看用户或角色系统权限(直接赋值给用户或角色的系统权限)：</p> <p>select * from dba_sys_privs;</p> <p>select * from user_sys_privs; (查看当前用户所拥有的权限)</p> <p>3.查看角色(只能查看登陆用户拥有的角色)所包含的权限</p> <p>sql&gt;select * from role_sys_privs;</p> <p>4.查看用户对象权限：</p> <p>select * from dba_tab_privs;</p> <p>select * from all_tab_privs;</p> <p>select * from user_tab_privs;</p> <p>5.查看所有角色： select * from dba_roles;</p> <p>6.查看用户或角色所拥有的角色：</p> <p>select * from dba_role_privs;</p> <p>select * from user_role_privs;</p> <p>7.查看哪些用户有sysdba或sysoper系统权限(查询时需要相应权限)</p> <p>select * from V$PWFILE_USERS</p> <p>修改用户密码</p> <p>alter user 用户名 identified by 新密码；</p> <p>数据库的创建</p> <p>安装完成后我们在CMD命令窗口中执行sqlplus命令，来打开终端，此时他会提示我们输入用户名和密码，这个时候用户可以输入sys，密码则是你在安装的时候设置的密码。</p> <p>接下来我们创建一个用户：</p> <p>CREATE USER user1 IDENTIFIED BY 1234;</p> <p>我们给user1用户来授权：</p> <p>GRANT CONNECT,RESOURCE,DBA TO user1;</p> <p>上面我们创建了一个用户，并且授予了登录和DBA的权限，下面我们用user1来进行登录看看：</p> <p>CONNECT user1@orcl;</p> <p>会提示你输入密码，登录成功。注意，user1用户仅存在于orcl数据库中，因此，必须在CONNECT命令中明确指定用户名为user1@orcl。</p> <p>Oracle创建数据库有三种方式：</p> <p>用oracle dbca来创建</p> <p>手工创建数据库（这个是比较复杂的）</p> <p>使用oracle managed Field来创建</p> <p>带着问题去学习</p> <p>常用的查询方面的有：</p> <p>Select 演示如何查询单个表中的数据。</p> <p>排序方面有：</p> <p>Order By 按升序或降序对查询的结果集进行排序。</p> <p>过滤方面有：</p> <p>Distinct 介绍如何消除查询输出中的重复行。</p> <p>Where 演示如何为查询返回结果集中的行记录指定过滤条件。</p> <p>And 组合两个或两个以上的布尔表达式，如果所有表达式都为true，则返回true。</p> <p>Or 组合两个或两个以上的布尔表达式，如果其中一个表达式为true，则返回true。</p> <p>Fetch 演示如何使用行限制子句限制查询返回的行数。</p> <p>in 演示如何使用行限制子句限制查询返回的行数。</p> <p>Between 基于一系列值(区间值)过滤数据。</p> <p>Like 根据特定模式执行匹配。</p> <p>链接表方面有：</p> <p>Inner join 演示如何从表中查询具有与其他表匹配的行记录。</p> <p>Left join 介绍左连接概念，并学习如何使用它选择左表中具有，但右表中不具有的行记录。</p> <p>Right join 解释右连接概念，并演示如何从右表查询具有，但左表中不具有的行记录。</p> <p>Cross join –介绍如何从多个表中构建笛卡尔乘积。</p> <p>Self join 演示如何将表连接到自身以查询分层数据或比较同一个表中的行记录。</p> <p>分组方面有：</p> <p>Group By 演示如何将行分组为子组，并为每个分组应用聚合函数。</p> <p>Having 演示如何过滤分组中的行记录。</p> <p>子查询方面有：</p> <p>子查询 - 介绍子查询的概念以及如何使用子查询来执行高级数据选择技术。</p> <p>相关子查询 - 了解相关的子查询，它是一个依赖于外部查询返回的值的子查询。</p> <p>EXISTS和NOT EXISTS - 检查子查询返回的行是否存在。</p> <p>ANY，SOME和ALL - 将值与列表或子查询进行比较。</p> <p>设置操作符</p> <p>UNION - 演示如何将两个查询的结果合并为一个结果。</p> <p>INTERSECT - 演示如何实现两个独立查询的结果的交集。</p> <p>MINUS - 学习如何从一个结果集中减去另一个结果(也就是求差集)。</p> <p>修改数据</p> <p>INSERT - 学习如何在表中插入一行。</p> <p>INSERT INTO SELECT - 从查询结果中将数据插入到表中。</p> <p>INSERT ALL - 讨论多重插入语句，将多行插入到一个或多个表中。</p> <p>UPDATE - 演示如何更新表的存在的数据值。</p> <p>DELETE - 演示如何从表中删除一行或多行。</p> <p>MERGE - 使用单个语句逐步完成插入，更新和删除操作。</p> <p>数据定义：</p> <p>CREATE TABLE - 演示如何在数据库中创建新表。</p> <p>IDENTITY列 - 了解如何使用IDENTITY子句来定义表的标识列。</p> <p>ALTER TABLE - 演示如何改变表的结构。</p> <p>ALTER TABLE ADD列 - 显示如何将一个或多个列添加到现有表</p> <p>ALTER TABLE MODIFY列 - 演示如何更改表中现有列的定义。</p> <p>DROP COLUMN - 了解如何使用各种语句从表中删除一列或多列。</p> <p>DROP TABLE - 演示如何从数据库中删除表。</p> <p>TRUNCATE TABLE - 更快，更有效地删除表中的所有数据。</p> <p>RENAME TABLE - 学习如何重命名表和处理其依赖对象的过程。</p> <p>数据类型：</p> <p>Oracle数据类型 - 内置Oracle数据类型的概述。</p> <p>NUMBER - 介绍数字数据类型，并展示如何使用它为表定义数字列。</p> <p>FLOAT - 通过实例来解释Oracle中的浮点数据类型。</p> <p>CHAR - 了解固定长度的字符串类型。</p> <p>NCHAR - 演示如何存储固定长度的Unicode字符数据，并解释CHAR和NCHAR数据类型之间的区别</p> <p>VARCHAR2 - 向您介绍可变长度字符，并向您展示如何在表中定义可变长度字符列。</p> <p>NVARCHAR2 - 了解如何在数据库中存储可变长度的Unicode字符。</p> <p>DATE - 讨论日期和时间数据类型，并说明如何有效地处理日期时间数据。</p> <p>TIMESTAMP - 介绍如何以小数秒精度存储日期和时间。</p> <p>INTERVAL - 介绍区间数据类型，主要用来存储时间段。</p> <p>TIMESTAMP WITH TIME ZONE - 了解如何使用时区数据存储日期时间。</p> <p>约束：</p> <p>主键 - 解释主键概念，并演示如何使用主键约束来管理表的主键。</p> <p>外键 - 解释介绍外键概念，并演示如何使用外键约束来强制表之间的关系。</p> <p>NOT NULL约束 - 演示如何确保列不接受NULL值。</p> <p>UNIQUE约束 - 讨论如何确保存储在一列或一组列中的数据在整个表内的行之间是唯一的。</p> <p>CHECK约束 - 在将数据存储到表中之前添加用于检查数据的逻辑的过程。</p> <p>创建表空间</p> <p>创建临时表空间</p> <p>CREATE TEMPORARY TABLESPACE ttf_temp</p> <p>TEMPFILE 'F:\oracledata\ttf_temp.dbf'</p> <p>SIZE 50m</p> <p>AUTOEXTEND on</p> <p>NEXT 50m MAXSIZE 40960m</p> <p>EXTENT MANAGEMENT LOCAL;</p> <p>创建数据表空间</p> <p>CREATE TEMPORARY TABLESPACE ttf_data LOGGING</p> <p>DATAFILE 'F:\oracledata\ttf_data.dbf'</p> <p>SIZE 50m</p> <p>AUTOEXTEND on</p> <p>NEXT 50m MAXSIZE 40960m</p> <p>EXTENT MANAGEMENT LOCAL;</p> <p>创建用户并指定表空间</p> <p>CREATE USER USER1 IDENTIFIED BY 1234</p> <p>DEFAULT TABLESPACE ttf_data</p> <p>TEMPORARY TABLESPACE ttf_temp;</p> <p>//给用户授予权限</p> <p>GRANT CONNECT,RESOURCE,DBA to user1</p> <p>创建表</p> <p>创建表的一般语法格式如下：</p> <p>CREATE TABLE &lt;table_name&gt; (</p> <p>&lt;column_name_1&gt; &lt;data_type_1&gt;,</p> <p>&lt;column_name_2&gt; &lt;data_type_2&gt;,</p> <p>&lt;column_name_N&gt; &lt;data_type_N&gt;</p> <p>);</p> <p>====================================</p> <p>示例如下：</p> <p>CREATE TABLE authors (</p> <p>id number(38),</p> <p>name varchar2(100),</p> <p>birth_date date,</p> <p>gender varchar2(30)</p> <p>);</p> <p>创建表并且指定主键等约束：</p> <p>//创建一个学生表</p> <p>CREATE TABLE STU(</p> <p>STUID NUMBER(10) PRIMARY KEY, //申明为主键</p> <p>STUNAME VARCHAR2(20) NOT NULL , //不为null</p> <p>STUSEX VARCHAR2(2) DEFAULT '男'  CHECK(STUSEX IN('男','女'))</p> <p>);</p> <p>//创建一个课程表</p> <p>CREATE TABLE COURSE(</p> <p>COURSEID NUMBER(10) PRIMARY KEY,</p> <p>COURSENAME VARCHAR2(20) NOT NULL,</p> <p>COURSETYPE VARCHAR2(4)</p> <p>);</p> <p>//创建一个学生和课程的关联表</p> <p>CREATE TABLE STU_COURSE(</p> <p>ID NUMBER(10) PRIMARY KEY,</p> <p>STUID NUMBER(10) REFERENCES STU(STUID), //外键</p> <p>COURSEID NUMBER(10),</p> <p>CONSTRAINT FF_COURSEid FOREIGN KEY(COURSEID) REFERENCES COURSE(COURSEID)</p> <p>ON DELETE CASCADE //级联删除</p> <p>)</p> <p>添加数据--Insert</p> <p>//插入的格式一般为</p> <p>INSERT INTO table [(column1,column2,...)] VALUE (value1,value2,...)</p> <p>INSERT INTO STU(id,name) VALUES(1,'张三');</p> <p>//多表多行插入</p> <p>INSERT [ALL] [condition_insert_clause]</p> <p>[insert_into_clause values_clause] (subquery)</p> <p>INSERT ALL</p> <p>INTO stu(sid,sname) VALUES(ssid,ssname)</p> <p>INTO tea(tid,tname) VALUES(ttid,ttname)</p> <p>SELECT ssid,ssname,ttid,ttname,state FROM stu_tea WHERE state != 0</p> <p>//有条件的INSERT</p> <p>INSERT [ALL | FIRST]</p> <p>WHEN condition THEN insert_into_clause values_clause</p> <p>[WHEN condition THEN] [insert_into_clause values_clause]</p> <p>......</p> <p>[ELSE] [insert_into_clause values_clause]</p> <p>Subquery;</p> <p>INSERT ALL</p> <p>WHEN id &gt; 5 THEN INTO stu(sid,sname) VALUES(ssid,ssname)</p> <p>WHEN id &lt; 5 THEN INTO tea(tid,tname) VALUES(ttid,ttname)</p> <p>ELSE INTO tt(sid,tid) VALUES(ssid,ttid)</p> <p>SELECT ssid,ssname,ttid,ttname FROM stu_tea;</p> <p>//旋转Insert（pivoting Insert）</p> <p>create table sales_source_data (</p> <p>employee_id number(6),</p> <p>week_id number(2),</p> <p>sales_mon number(8,2),</p> <p>sales_tue number(8,2),</p> <p>sales_wed number(8,2),</p> <p>sales_thur number(8,2),</p> <p>sales_fri number(8,2)</p> <p>);</p> <p>insert into sales_source_data values (176,6,2000,3000,4000,5000,6000);</p> <p>create table sales_info (</p> <p>employee_id number(6),</p> <p>week number(2),</p> <p>sales number(8,2)</p> <p>);</p> <p>看上面的表结构,现在将要sales_source_data表中的数据转换到sales_info表中,这种情况就需要使用旋转Insert</p> <p>示例如下:</p> <p>insert all</p> <p>into sales_info values(employee_id,week_id,sales_mon)</p> <p>into sales_info values(employee_id,week_id,sales_tue)</p> <p>into sales_info values(employee_id,week_id,sales_wed)</p> <p>into sales_info values(employee_id,week_id,sales_thur)</p> <p>into sales_info values(employee_id,week_id,sales_fri)</p> <p>select employee_id,week_id,sales_mon,sales_tue,</p> <p>sales_wed,sales_thur,sales_fri</p> <p>from sales_source_data;</p> <p>从该例子可以看出,所谓旋转Insert是无条件 insert all 的一种特殊应用,但这种应用被oracle官方,赋予了一个pivoting insert的名称,即旋转insert</p> <p>更新数据 -- Update</p> <p>UPDATE 表名称 SET 列名称 = 新值 &lt;WHERE 条件&gt;</p> <p>UPDATE stu SET sid = 1,sname = '张三' WHERE state = 0</p> <p>删除数据 -- Delete</p> <p>//语法如下</p> <p>DELETE FROM &lt;table/view&gt; [WHERE <condition>]</condition></p> <p>//注意事项：</p> <p>//如果有外键关联，则删除数据之前,需先删除外键关联数据</p> <p>DELETE FROM stu WHERE sid = 1;</p> <p>//DELETE 与 TRUNCATE 应用区别：</p> <p>1、对于删除整个表的所有数据时，delete并不会释放表所占用的空间</p> <p>2、如果用户确定是 删除 整表的所有数据，那么使用 truncate table 速度更快</p> <p>//删除所有学生信息，使用DELETE</p> <p>DELETE FROM stu</p> <p>//删除所有部门信息使用 TRUNCATE</p> <p>TRUNCATE TABLE stu</p> <p>查询语句 -- Select</p> <p>//语法如下</p> <p>SELECT column_1,column_2 FROM table_name;</p> <p>//查询单个列的数据</p> <p>SELECT sid FROM stu</p> <p>//查询多个列</p> <p>SELECT sid,sname FROM stu</p> <p>//查询所有列的数据</p> <p>SELECT * FROM stu</p> <p>//分组查询</p> <p>SELECT id,name,age FROM stu GROUP BY age</p> <p>//排序查询,按照id降序排序</p> <p>SELECT id,name,age FROM stu ORDER BY id DESC</p> <p>//唯一查询 语法格式如下</p> <p>SELECT DISTINCT column_1,column_2 FROM table_name</p> <p>//多个条件查询 AND</p> <p>SELECT id,name,age,state FROM stu WHERE age = 1 AND state = 0</p> <p>//多个条件查询 OR</p> <p>SELECT id,name,age,state FROM stu WHERE age = 1 OR age = 2</p> <p>链接查询</p> <p>//内链接 inner join</p> <p>SELECT * FROM stu INNER JOIN course ON cid = ccid ORDER BY ccid DESC</p> <p>//使用USING</p> <p>//1.查询必须是等值连接。</p> <p>//2.等值连接中的列必须具有相同的名称和数据类型。</p> <p>SELECT * FROM stu INNER JOIN course USING(cid) ORDER BY cid DESC</p> <p>----------------------------------------------------------------------------</p> <p>//左链接</p> <p>SELECT * FROM stu LEFT JOIN course ON cid == ccid ORDER BY cid DESC</p> <p>//使用USING ,这里的c1和c2，在stu表和course表中都必须要相同类型的相同字段</p> <p>SELECT * FROM stu LEFT JOIN course USING(c1,c2) ORDER BY cid</p> <p>----------------------------------------------------------------------------</p> <p>//右链接</p> <p>SELECT * FROM stu RIGHT JOIN course ON cid = ccid ORDER BY cid DESC</p> <p>//使用USING</p> <p>SELECT * FROM stu RIGHT JOIN course USING(c1,c2) ORDER BY cid DESC</p> <p>----------------------------------------------------------------------------</p> <p>//笛卡尔积 CROSS JOIN</p> <p>SELECT * FROM stu CROSS JOIN course</p> <p>----------------------------------------------------------------------------</p> <p>//自身链接</p> <p>SELECT m.id ,c.name FROM stu AS m,LEFT JOIN stu AS c ON c.cid = m.pid</p> <p>Oracle 常用分页</p> <p>//1、通过MINUS分页</p> <p>SELECT * FROM STU WHERE ROWNUM &lt; 3 MINUS SELECT * FROM STU WHERE ROWNUM &lt; 2</p> <p>//2、通过ROWNUM分页</p> <p>SELECT * FROM STU WHERE ROWNUM &lt; 10</p> <p>//查询前10条</p> <p>SELECT * FROM (SELECT * FROM STU) WHERE ROWNUM &lt;= 10</p> <p>//3、通过BETWEEN分页 (查询1到10)</p> <p>SELECT * FROM STU WHERE ROWNUM BETWEEN 1 AND 10</p> <p>SELECT * FROM (SELECT a.*,ROWNUM RN FROM STU) WHERE RN &lt;=10</p> <p>Oracle 创建视图</p> <p>视图的优点有如下：</p> <p>对数据库的访问，因为视图可以有选择性的选取数据库里的一部分。</p> <p>用户通过简单的查询可以从复杂查询中得到结果。</p> <p>维护数据的独立性，试图可从多个表检索数据。</p> <p>对于相同的数据可产生不同的视图。</p> <p>视图分为简单视图和复杂视图：</p> <p>简单视图只从单表里获取数据，复杂视图从多表；</p> <p>简单视图不包含函数和数据组，复杂视图包含；</p> <p>简单视图可以实现DML操作，复杂视图不可以。</p> <p>CREATE [OR REPLACE] [FORCE|NOFORCE] VIEW view_name</p> <p>[(alias[, alias]...)]</p> <p>AS subquery</p> <p>[WITH CHECK OPTION [CONSTRAINT constraint]]</p> <p>[WITH READ ONLY]</p> <p>//创建视图</p> <p>CREATE OR REPLACE VIEW SV AS SELECT sid,sname FROM STU WITH READ ONLY</p> <p>//查询视图</p> <p>SELECT * FROM SV;</p> <p>//查询视图定义</p> <p>SELECT SV,text FROM SV;</p> <p>语法解析：</p> <p>OR REPLACE  ：若所创建的试图已经存在，则替换旧视图；</p> <p>FORCE：不管基表是否存在ORACLE都会自动创建该视图(即使基表不存在，也可以创建该视图，但是该视图不能正常使用，当基表创建成功后，视图才能正常使用)；</p> <p>NOFORCE ：如果基表不存在，无法创建视图，该项是默认选项(只有基表都存在ORACLE才会创建该视图)。</p> <p>alias：为视图产生的列定义的别名；</p> <p>subquery ：一条完整的SELECT语句，可以在该语句中定义别名；</p> <p>WITH CHECK OPTION ：插入或修改的数据行必须满足视图定义的约束；</p> <p>WITH READ ONLY    ：默认可以通过视图对基表执行增删改操作，但是有很多在基表上的限制(比如：基表中某列不能为空，但是该列没有出现在视图中，则不能通过视图执行insert操作)，WITH READ ONLY说明视图是只读视图，不能通过该视图进行增删改操作。现实开发中，基本上不通过视图对表中的数据进行增删改操作。</p> <p>删除视图</p> <p>DROP VIEW 视图名称;</p> <p>Oracle 中EXISTS 和 NOT EXISTS</p> <p>EXISTS （sql 返回结果集为真）</p> <p>NOT EXISTS (sql 不返回结果集为真）</p> <p>//如果有值就返回 EXISTS</p> <p>SELECT * FROM A WHERE EXISTS (SELECT * FROM B WHERE A.ID = B.ID)</p> <p>//如果有值就返回 NOT EXISTS</p> <p>SELECT * FROM A WHERE NOT EXISTS (SELECT * FROM B WHERE A.ID = B.ID)</p> <p>EXISTS 和 NOT EXISTS 用的也是比较多的，效率相对来收也比较优。</p> <p>IN、NOT IN的用法</p> <p>// IN的基本语法如下</p> <p>SELECT columns</p> <p>FROM tables</p> <p>WHERE column1 in (value1, value2, .... value_n);</p> <p>SELECT * FROM STU WHERE ID IN / NOT IN (SELECT ID FROM B WHERE state = 0)</p> <p>//举个例子来说明 “exists” 和 “in” 的效率问题</p> <p>SELECT * FROM B1 WHERE EXISTS(SELECT * FROM B2 WHERE B1.a = B2.a)</p> <p>//B1数据量小而B2数据量非常大时， B1 &lt;&lt; B2 时，查询效率高</p> <p>SELECT * FROM B1 WHERE B1.a in (SELECT a FROM B2)</p> <p>//B1的数据量非常大而B2数据量小时， B1 &gt;&gt; B2 时 查询效率高</p> <p>自定义函数</p> <p>//创建语法</p> <p>create [or replace] function function_name</p> <p>[(parameter_list)]</p> <p>return datatype</p> <p>{is/as}</p> <p>[local_declarations]</p> <p>begin</p> <p>executable_statements;</p> <p>[exception</p> <p>exception_handlers;]</p> <p>end;</p> <p>说明：</p> <p>function_name：函数名称。</p> <p>parameter_list：函数列表，可选。</p> <p>return 自居：指定函数的返回类型，不能指定大小。</p> <p>local_declarations：局部变量声明，可选。</p> <p>executable_statements：要执行的PL-SQL语句。</p> <p>exception_handlers：异常处理，可选。</p> <p>or repalce：是否覆盖，可选。</p> <p>参数的模式有3种:(如果没有注明, 参数默认的类型为 in.)</p> <p>in: 为只读模式, 在函数中, 参数的值只能被引用, 不能被改变;</p> <p>out: 为只写模式, 只能被赋值, 不能被引用;</p> <p>in out: 可读可写.</p> <p>//注意</p> <p>1.在Oracle自定义函数中, else if 的正确写法是 elsif 而不是 else if</p> <p>2.使用 if 需要加 then &quot;if 条件 then 操作&quot;</p> <p>/////////////////////////////////////////////////////////////</p> <p>例如，读入两个值，返回比较大的值</p> <p>create or replace function get_max(para1 in number, para2 in number)</p> <p>return number</p> <p>as</p> <p>begin</p> <p>if para1 &gt; para2 then</p> <p>return para1;</p> <p>else</p> <p>return para2;</p> <p>end if;</p> <p>end get_max;</p> <p>//使用</p> <p>select get_max(666, 333) from dual;</p> <p>///////////////////////////////////////////////////////////////</p> <p>CREATE or REPLACE FUNCTION useEasy(a1 in number,a2 in number) RETURN NUMBER IS</p> <p>fres NUMBER;</p> <p>BEGIN</p> <p>fres := a1 + a2;</p> <p>RETURN fres;</p> <p>END useEasy;</p> <p>//调用</p> <p>select useEasy(1,30) from dual;</p> <p>///////////////////////////////////////////////////////////////</p> <p>CREATE OR REPLACE FUNCTION get_emp_id(usernameq varchar2) RETURN NUMBER</p> <p>AS</p> <p>sid emp.id%TYPE;</p> <p>BEGIN</p> <p>SELECT id INTO sid FROM emp WHERE name = usernameq;</p> <p>RETURN sid;</p> <p>END get_emp_id;</p> <p>//调用</p> <p>select get_emp_id('张三') from dual;</p> <p>//注意</p> <p>在Oracle的存储过程和函数中，其实IS和AS是同义词，没有什么区别。</p> <p>还有在自定义类型（TPYE）和包（PACKAGE）时，使用IS和AS也并没有什么区别。</p> <p>但是在创建视图（VIEW）时，只能使用AS而不能使用IS。</p> <p>在声明游标（CURSOR）时，只能使用IS而不能使用AS。</p> <p>**1.**<strong>前言</strong></p> <p>有一定Linux/Unix操作系统、Oracle数据库基础的工程人员和维护人员，证券公司信息技术人员等。本手册可作为工具，Oralce运维提供帮助。</p> <p>**2.**<strong>简单命令使用</strong></p> <p>2.1进入SQL*Plus</p> <p>$sqlplus 用户名/密码</p> <p>2.2退出SQL*Plus</p> <p>SQL&gt;exit</p> <p>2.3在sqlplus下得到帮助信息</p> <p>列出全部SQL命令和SQL*Plus命令</p> <p>SQL&gt;help</p> <p>列出某个特定的命令的信息</p> <p>SQL&gt;help 命令名</p> <p>2.4显示表结构命令DESCRIBE</p> <p>SQL&gt;DESC 表名</p> <p>2.5SQL*Plus中的编辑命令</p> <p>显示SQL缓冲区命令</p> <p>SQL&gt;L</p> <p>修改SQL命令</p> <p>首先要将待改正行变为当前行</p> <p>SQL&gt;n</p> <p>用CHANGE命令修改内容</p> <p>SQL&gt;c/旧/新</p> <p>重新确认是否已正确</p> <p>SQL&gt;L</p> <p>使用INPUT命令可以在SQL缓冲区中增加一行或多行</p> <p>SQL&gt;i</p> <p>SQL&gt;输入内容</p> <p>2.6调用外部系统编辑器</p> <p>SQL&gt;edit 文件名</p> <p>可以使用DEFINE命令设置系统变量EDITOR来改变文本编辑器的类型，在login.sql文件中定义如下一行</p> <p>DEFINE_EDITOR=vi</p> <p>2.7运行命令文件</p> <p>SQL&gt;START test</p> <p>SQL&gt;@test</p> <p>2.8关于侦听</p> <p>1、新建/修改/删除侦听</p> <p>以oracle用户登录，运行netca，会跳出图形配置界面。</p> <p>2、打开侦听</p> <p>lsnrctl start</p> <p>3、查看侦听</p> <p>Lsnrctl status</p> <p>4、关闭侦听</p> <p>lsnrctl stop</p> <p><strong>3.ORACLE****的启动和关闭</strong></p> <p>3.1在单机环境下</p> <p>要想启动或关闭ORACLE系统必须首先切换到ORACLE用户，如下</p> <p>su - oracle</p> <p>启动oracle 数据库命令：</p> <p>$sqlplus/nolog</p> <p>SQL*Plus: Release 10.2.0.1.0- Production on 星期一 7月 16 16:09:40 2007</p> <p>Copyright (c) 1982, 2005, Oracle. All rights reserved.</p> <p>SQL&gt;conn / as sysdba</p> <p>已连接到空闲例程。</p> <p>SQL&gt;startup</p> <p>ORACLE 例程已经启动。</p> <p>Total System Global Area 369098752 bytes</p> <p>Fixed Size         1249080 bytes</p> <p>Variable Size       201326792 bytes</p> <p>Database Buffers     159383552 bytes</p> <p>Redo Buffers        7139328 bytes</p> <p>数据库装载完毕。</p> <p>数据库已经打开。</p> <p>关闭 oracle 数据库命令：</p> <p>$ sqlplus/nolog</p> <p>SQL*Plus: Release 10.2.0.1.0- Production on 星期一 7月 16 16:08:10 2007</p> <p>Copyright (c) 1982, 2005, Oracle. All rights reserved.</p> <p>SQL&gt;conn / as sysdba</p> <p>已连接。</p> <p>SQL&gt;shutdown immediate</p> <p>数据库已经关闭。</p> <p>已经卸载数据库。</p> <p>ORACLE 例程已经关闭。</p> <p>SQL&gt;</p> <p>3.2在双机环境下</p> <p>要想启动或关闭crs服务必须首先切换到root用户，如下</p> <p>su - root</p> <p>启动crs 服务：</p> <p>启动CRS</p> <p>#$CRS_HOME/crs/bin/crsctlstart crs</p> <p>查看CRS状态</p> <p>#$CRS_HOME/crs/bin/crsctlcheck crs</p> <p>关闭CRS</p> <p>#$CRS_HOME/crs/bin/crsctlstop crs</p> <p>查看CRS内部各资源状态</p> <p>#$CRS_HOME/crs/bin/crs_stat–t</p> <p>启动数据库服务</p> <p># srvctlstart database -d tdb       #tdb为数据库名</p> <p>**4.**<strong>数据库管理员日常工作</strong></p> <p>4.1检查alterSID.log</p> <p>这个日志文件位于参数BACKGROUND_DUMP_DEST指定的目录，可能通过以下命令来查看。</p> <p>SQL&gt; SHOW PARAMETER background_dump_dest</p> <p>在出现大故障前，数据库有可能会报一些警告或错误信息，应该充分重视这些信息，未雨绸缪，避免更大错误的发生。</p> <p>检查alterSID.log 的什么内容。</p> <p>检查数据库是否出现过宕机（可能在晚间重启而维护人员不知道）</p> <p>Oracle 出错信息，通过$grep ORA- alterSID.log查找</p> <p>产品有关的问题：ORA-00600/ORA-07445等错误</p> <p>相应的TRACE文件</p> <p>4.2环境确认</p> <p>数据库实例是否正常工作</p> <p>SQL &gt;select status from v$instance;</p> <p>数据库监听器是否正常工作</p> <p>-$ lsnrctl status</p> <p>是否存在故障表空间</p> <p>-SQL&gt; select tablespace_name,status fromdba_tablespace;</p> <p>控制文件、日志文件是否正常</p> <p>SQL&gt;select * from v$controlfile;</p> <p>SQL&gt;select * from v$log;</p> <p>SQL&gt;select * from v$logfile;</p> <p><strong>性能监测</strong></p> <p>每天按业务峰值情况，对数据库性能数据进行定时采集</p> <p>每天检查数据库的主要性能指标</p> <p>每天检查最消耗资源的SQL语句变化情况。</p> <p>每天检查是否有足够的资源</p> <p>检查所有表空间的剩余情况</p> <p>识别出一些异常的增长</p> <p>检查CPU、内存、网络等是否异常</p> <p>**5.**<strong>数据库日常操作SQL</strong></p> <p>5.1查看表空间物理文件的名称及大小</p> <p>select tablespace_name,</p> <p>file_id,</p> <p>file_name,</p> <p>round(bytes / (1024 * 1024), 0) filesize</p> <p>from dba_data_files</p> <p>orderby tablespace_name;</p> <p>5.2查询表空间使用情况</p> <p>select a.tablespace_name &quot;表空间名称&quot;,</p> <p>100 - round((nvl(b.bytes_free, 0) / a.bytes_alloc)* 100, 2) &quot;占用率(%)&quot;,</p> <p>round(a.bytes_alloc / 1024 / 1024, 2) &quot;容量(M)&quot;,</p> <p>round(nvl(b.bytes_free, 0) / 1024 / 1024, 2) &quot;空闲(M)&quot;,</p> <p>round((a.bytes_alloc -nvl(b.bytes_free, 0)) / 1024 / 1024, 2) &quot;使用(M)&quot;,</p> <p>to_char(sysdate, 'yyyy-mm-ddhh24:mi:ss')&quot;采样时间&quot;</p> <p>from (selectf.tablespace_name,</p> <p>sum(f.bytes)bytes_alloc,</p> <p>sum(decode(f.autoextensible,'YES', f.maxbytes, 'NO', f.bytes))maxbytes</p> <p>from dba_data_files f</p> <p>groupbytablespace_name) a,</p> <p>(select f.tablespace_name, sum(f.bytes)bytes_free</p> <p>from dba_free_space f</p> <p>groupbytablespace_name) b</p> <p>where a.tablespace_name =b.tablespace_name</p> <p>orderby2desc;</p> <p>5.3查询表空间的碎片程度</p> <p>select tablespace_name, count(tablespace_name)</p> <p>from dba_free_space</p> <p>groupby tablespace_name</p> <p>havingcount(tablespace_name) &gt; 10;</p> <p>altertablespace HS_USER_DATA coalesce;</p> <p>altertablenamedeallocateunused;</p> <p>5.4碎片程度</p> <p>select tablespace_name, count(tablespace_name)</p> <p>from dba_free_space</p> <p>groupby tablespace_name</p> <p>havingcount(tablespace_name) &gt; 10;</p> <p>altertablespacenamecoalesce;</p> <p>altertablenamedeallocateunused;</p> <p>createorreplaceview ts_blocks_v as</p> <p>select tablespace_name,block_id, bytes, blocks, segment_name</p> <p>from dba_free_space</p> <p>unionall</p> <p>select tablespace_name,block_id, bytes, blocks, segment_name</p> <p>from dba_extents;</p> <p>select * from ts_blocks_v;</p> <p>select tablespace_name, sum(bytes), max(bytes), count(block_id)</p> <p>from dba_free_space</p> <p>groupby tablespace_name;</p> <p>查看碎片程度高的表</p> <p>SELECT segment_name table_name, COUNT(*) extents</p> <p>FROM dba_segments</p> <p>WHERE owner NOTIN('SYS', 'SYSTEM')</p> <p>GROUPBY segment_name</p> <p>HAVINGCOUNT(<em>) = (SELECTMAX(COUNT(</em>))</p> <p>FROMdba_segments</p> <p>GROUPBY segment_name);</p> <p>5.5查看回滚段名称及大小</p> <p>select segment_name,</p> <p>tablespace_name,</p> <p>r.status,</p> <p>(initial_extent / 1024) InitialExtent,</p> <p>(next_extent / 1024) NextExtent,</p> <p>max_extents,</p> <p>v.curext CurExtent</p> <p>From dba_rollback_segs r,v$rollstat v</p> <p>Where r.segment_id = v.usn(+)</p> <p>orderby segment_name;</p> <p>5.6查看控制文件</p> <p>selectnamefromv$controlfile;</p> <p>5.7查看日志文件</p> <p>selectmemberfromv$logfile;</p> <p>5.8查看表空间的使用情况</p> <p>selectsum(bytes) / (1024 * 1024) as free_space, tablespace_name</p> <p>from dba_free_space</p> <p>groupby tablespace_name;</p> <p>SELECT A.TABLESPACE_NAME,</p> <p>A.BYTES TOTAL,</p> <p>B.BYTES USED,</p> <p>C.BYTES FREE,</p> <p>(B.BYTES * 100) / A.BYTES &quot;% USED&quot;,</p> <p>(C.BYTES * 100) / A.BYTES &quot;% FREE&quot;</p> <p>FROMSYS.SM$TS_AVAIL A, SYS.SM$TS_USEDB, SYS.SM$TS_FREE C</p> <p>WHERE A.TABLESPACE_NAME =B.TABLESPACE_NAME</p> <p>AND A.TABLESPACE_NAME =C.TABLESPACE_NAME;</p> <p>5.9查看数据库对象</p> <p>select owner, object_type, status, count(*)count#</p> <p>from all_objects</p> <p>groupby owner,object_type, status;</p> <p>5.10查看数据库的版本</p> <p>Select version</p> <p>FROM Product_component_version</p> <p>Where SUBSTR(PRODUCT, 1, 6) = 'Oracle';</p> <p>5.11查看Oracle字符集</p> <p>select * fromsys.props$ wherename= 'NLS_CHARACTERSET';</p> <p>5.12在某个用户下找所有的索引</p> <p>select user_indexes.table_name,</p> <p>user_indexes.index_name,</p> <p>uniqueness,</p> <p>column_name</p> <p>from user_ind_columns,user_indexes</p> <p>where user_ind_columns.index_name= user_indexes.index_name</p> <p>and user_ind_columns.table_name= user_indexes.table_name</p> <p>orderbyuser_indexes.table_type,</p> <p>​     user_indexes.table_name,</p> <p>​     user_indexes.index_name,</p> <p>​     column_position;</p> <p>5.13表、索引的存储情况检查</p> <p>select segment_name, sum(bytes), count(*)ext_quan</p> <p>from dba_extents</p> <p>where tablespace_name = '&amp;tablespace_name'</p> <p>and segment_type = 'TABLE'</p> <p>groupby tablespace_name,segment_name;</p> <p>select segment_name, count(*)</p> <p>from dba_extents</p> <p>where segment_type = 'INDEX'</p> <p>and owner = '&amp;owner'</p> <p>groupby segment_name;</p> <p>5.14查看数据库的创建日期和归档方式</p> <p>Select Created, Log_Mode, Log_Mode FromV$Database;</p> <p>5.15显示所有数据库对象的类别和大小</p> <p>selecttype,</p> <p>count(name)num_instances,</p> <p>sum(source_size)source_size,</p> <p>sum(parsed_size)parsed_size,</p> <p>sum(code_size) code_size,</p> <p>sum(error_size) error_size,</p> <p>sum(source_size) + sum(parsed_size)+ sum(code_size) +</p> <p>sum(error_size)size_required</p> <p>from dba_object_size</p> <p>groupbytype</p> <p>orderby1;</p> <p>5.16设置RAC为归档模式？</p> <p>步骤：</p> <p>1.以SYSDBA身份登陆2个节点，执行</p> <p>alter system set cluster_database=false scope =spfile sid=’*’;</p> <p>设置归档路径</p> <p>alter system set log_archive_start=true scope=spfile;</p> <p>2.2个节点</p> <p>shutdown immediate</p> <p>3.在一个节点上执行</p> <p>startup mount</p> <p>alter database archivelog;</p> <p>shutdown immediate;</p> <p>alter database open;</p> <p>alter system set cluster_database=true scope =spfile sid=’*’;</p> <p>shutdown immediate</p> <p>4、分别启动2个节点，修改完毕</p> <p><strong>6.AWR****报告</strong></p> <p>与9i 中的statspack相似，awr报告也需要两个快照，才能生成这两个时间点之间的性能报告。</p> <p>$sqlplus/ as sysdba</p> <p>生成快照一（10g中自动会每个整点都会生成一个快照）</p> <p>SQL&gt;exec dbms_workload_repository.create_snapshot();</p> <p>(间隔一段时间)生成快照二</p> <p>SQL&gt;exec dbms_workload_repository.create_snapshot();</p> <p>生成报告</p> <p>SQL&gt;@?/rdbms/admin/awrrpt.sql</p> <p>7.Troubleshooting</p> <p>常用性能相关SQL，监控数据库性能的SQL语句。</p> <p>7.1监控事务的等待</p> <p>select event,</p> <p>sum(decode(wait_Time, 0, 0, 1)) &quot;Prev&quot;,</p> <p>sum(decode(wait_Time, 0, 1, 0)) &quot;Curr&quot;,</p> <p>count(*) &quot;Totol&quot;</p> <p>from v$session_Wait</p> <p>groupby event</p> <p>orderby4;</p> <p>7.2查看一些等待信息：</p> <p>select sid,event</p> <p>from v$session_wait</p> <p>where event notlike'SQL%'</p> <p>and event notlike'%ipc%';</p> <p>查看是否存在下面等常见的等待事件：</p> <p>buffer busy waits，</p> <p>free buffer waits，</p> <p>db file sequentialread,</p> <p>db file scatteredread,</p> <p>enqueue,latch free,</p> <p>log file parallelwrite,</p> <p>log file sync</p> <p>7.3查看等待(wait)情况</p> <p>SELECT v$waitstat.class,</p> <p>v$waitstat.countcount,</p> <p>SUM(v$sysstat.value)sum_value</p> <p>FROM v$waitstat, v$sysstat</p> <p>WHERE v$sysstat.nameIN('dbblock gets', 'consistent gets')</p> <p>groupby v$waitstat.class,v$waitstat.count;</p> <p>7.4回滚段查看</p> <p>selectrownum,</p> <p>sys.dba_rollback_segs.segment_nameName,</p> <p>v$rollstat.extentsExtents,</p> <p>v$rollstat.rssize Size_in_Bytes,</p> <p>v$rollstat.xacts XActs,</p> <p>v$rollstat.gets Gets,</p> <p>v$rollstat.waits Waits,</p> <p>v$rollstat.writes Writes,</p> <p>sys.dba_rollback_segs.statusstatus</p> <p>from v$rollstat, sys.dba_rollback_segs,v$rollname</p> <p>where v$rollname.name(+) =sys.dba_rollback_segs.segment_name</p> <p>and v$rollstat.usn(+) =v$rollname.usn</p> <p>orderbyrownum;</p> <p>7.5回滚段的争用情况</p> <p>selectname, waits, gets, waits / gets &quot;Ratio&quot;</p> <p>from v$rollstat a, v$rollname b</p> <p>where a.usn = b.usn;</p> <p>7.6监控表空间的I/O 比例</p> <p>select df.tablespace_name name,</p> <p>df.file_name    &quot;file&quot;,</p> <p>f.phyrds      pyr,</p> <p>f.phyblkrd     pbr,</p> <p>f.phywrts     pyw,</p> <p>f.phyblkwrt    pbw</p> <p>from v$filestat f,dba_data_files df</p> <p>where f.file# = df.file_id</p> <p>orderbydf.tablespace_name;</p> <p>7.7监控文件系统的I/O 比例</p> <p>select substr(a.file#, 1, 2) &quot;#&quot;,</p> <p>substr(a.name, 1, 30) &quot;Name&quot;,</p> <p>a.status,</p> <p>a.bytes,</p> <p>b.phyrds,</p> <p>b.phywrts</p> <p>from v$datafile a, v$filestat b</p> <p>where a.file# = b.file#;</p> <p>7.8监控 SGA 的命中率</p> <p>select a.value + b.value&quot;logical_reads&quot;,</p> <p>c.value&quot;phys_reads&quot;,</p> <p>round(100 * ((a.value + b.value) - c.value) /(a.value + b.value)) &quot;BUFFER HIT RATIO&quot;</p> <p>from v$sysstat a, v$sysstat b,v$sysstat c</p> <p>where a.statistic# = 38 --physical read total multi block requests</p> <p>and b.statistic# = 39 --physical read total bytes</p> <p>and c.statistic# = 40; --physical write total IO requests</p> <p>7.9监控 SGA 中字典缓冲区的命中率</p> <p>select parameter,</p> <p>gets,</p> <p>Getmisses,</p> <p>getmisses / (gets + getmisses) * 100 &quot;miss ratio&quot;,</p> <p>(1 - (sum(getmisses) / (sum(gets) + sum(getmisses)))) *100 &quot;Hit ratio&quot;</p> <p>from v$rowcache</p> <p>where gets + getmisses &lt;&gt; 0</p> <p>groupby parameter, gets,getmisses;</p> <p>7.10监控 SGA 中共享缓存区的命中率，应该小于1%</p> <p>selectsum(pins) &quot;Total Pins&quot;,</p> <p>sum(reloads) &quot;TotalReloads&quot;,</p> <p>sum(reloads) / sum(pins)libcache</p> <p>from v$librarycache;</p> <p>selectsum(pinhits - reloads) / sum(pins) * 100 &quot;hitradio&quot;,</p> <p>sum(reloads) / sum(pins)&quot;reload percent&quot;</p> <p>from v$librarycache;</p> <p>7.11临控 SGA 中重做日志缓存区的命中率，应该小于1%</p> <p>SELECTname,</p> <p>gets,</p> <p>misses,</p> <p>immediate_gets,</p> <p>immediate_misses,</p> <p>Decode(gets, 0, 0, misses / gets * 100) ratio1,</p> <p>Decode(immediate_gets +immediate_misses,</p> <p>0,</p> <p>0,</p> <p>​       immediate_misses /(immediate_gets + immediate_misses) * 100) ratio2</p> <p>FROM v$latch</p> <p>WHEREnameIN ('redo allocation', 'redo copy');</p> <p>7.12监控内存和硬盘的排序比率，最好使它小于 0.10，增加 sort_area_size</p> <p>SELECTname, value</p> <p>FROM v$sysstat</p> <p>WHEREnameIN ('sorts (memory)', 'sorts (disk)');</p> <p>7.13监控当前数据库谁在运行什么SQL语句</p> <p>SELECT osuser, username, sql_text</p> <p>from v$session a, v$sqltext b</p> <p>where a.sql_address = b.address</p> <p>orderby address, piece;</p> <p>7.14监控字典缓冲区</p> <p>SELECT SUM(PINS) &quot;EXECUTIONS&quot;,</p> <p>SUM(RELOADS) &quot;CACHE MISSESWHILE EXECUTING&quot;,</p> <p>(SUM(PINS - RELOADS)) / SUM(PINS)&quot;LIB CACHE&quot;</p> <p>FROM V$LIBRARYCACHE;</p> <p>SELECT SUM(GETS) &quot;DICTIONARY GETS&quot;,</p> <p>SUM(GETMISSES) &quot;DICTIONARYCACHE GET MISSES&quot;,</p> <p>(SUM(GETS - GETMISSES - USAGE -FIXED)) / SUM(GETS) &quot;ROW CACHE&quot;</p> <p>FROM V$ROWCACHE;</p> <p>“LIB CACHE“与“ROW CACHE”越接近1.00超好，不要低于0.90。否则需要调大SGA的空间。</p> <p>7.15查看Lock</p> <p>select s.osuser,</p> <p>l.sid,</p> <p>s.serial#,</p> <p>s.username,</p> <p>s.terminal,</p> <p>decode(l.type,</p> <p>​       'TM',</p> <p>​       'TM - DML Enqueue',</p> <p>​       'TX',</p> <p>​       'TX - Trans Enqueue',</p> <p>​       'UL',</p> <p>​       'UL - User',</p> <p>​       l.type || ' - Other Type')LOCKTYPE,</p> <p>substr(t.name, 1, 10) OBJECT,</p> <p>u.name owner,</p> <p>l.id1,</p> <p>l.id2,</p> <p>decode(l.lmode,</p> <p>​       1,</p> <p>​       'No Lock',</p> <p>​       2,</p> <p>​       'Row Share',</p> <p>​       3,</p> <p>​       'Row Exclusive',</p> <p>​       4,</p> <p>​       'Share',</p> <p>​       5,</p> <p>​       'Shr Row Excl',</p> <p>​       6,</p> <p>​       'Exclusive',</p> <p>​       null) lmode,</p> <p>decode(l.request,</p> <p>​       1,</p> <p>​       'No Lock',</p> <p>​       2,</p> <p>​       'Row Share',</p> <p>​       3,</p> <p>​       'Row Excl',</p> <p>​       4,</p> <p>​       'Share',</p> <p>​       5,</p> <p>​       'Shr Row Excl',</p> <p>​       6,</p> <p>​       'Exclusive',</p> <p>​       null) request</p> <p>from v$lock l, v$session s, sys.user$u, sys.obj$ t</p> <p>where l.sid = s.sid</p> <p>and s.type != 'BACKGROUND'</p> <p>and t.obj# = l.id1</p> <p>and u.user# = t.owner#;</p> <p>7.16捕捉运行很久的SQL</p> <p>select username,</p> <p>sid,</p> <p>opname,</p> <p>round(sofar * 100 / totalwork, 0) || '%'asprogress,</p> <p>time_remaining,</p> <p>sql_text</p> <p>from v$session_longops, v$sql</p> <p>where time_remaining &lt;&gt; 0</p> <p>and sql_address = address</p> <p>and sql_hash_value =hash_value;</p> <p>7.17查看数据表的参数信息</p> <p>SELECT partition_name,</p> <p>table_name,</p> <p>high_value,</p> <p>high_value_length,</p> <p>tablespace_name,</p> <p>pct_free,</p> <p>pct_used,</p> <p>ini_trans,</p> <p>max_trans,</p> <p>initial_extent,</p> <p>next_extent,</p> <p>min_extent,</p> <p>max_extent,</p> <p>pct_increase,</p> <p>FREELISTS,</p> <p>freelist_groups,</p> <p>LOGGING,</p> <p>BUFFER_POOL,</p> <p>num_rows,</p> <p>blocks,</p> <p>empty_blocks,</p> <p>avg_space,</p> <p>chain_cnt,</p> <p>avg_row_len,</p> <p>sample_size,</p> <p>last_analyzed</p> <p>FROMsys.dba_tab_partitions</p> <p>WHERE table_owner = 'HS_HIS'ANDtable_name = 'HISBANKTRADE'</p> <p>--WHEREtable_name = :tname AND table_owner = :towner</p> <p>ORDERBYpartition_position,partition_name;</p> <p>7.18查看还没提交的事务</p> <p>select * from v$locked_object;</p> <p>select * from v$transaction;</p> <p>7.19查找object为哪些进程所用</p> <p>select p.spid,</p> <p>s.sid,</p> <p>s.serial# serial_num,</p> <p>s.username user_name,</p> <p>a.type object_type,</p> <p>s.osuser os_user_name,</p> <p>a.owner,</p> <p>a.object object_name,</p> <p>decode(sign(48 - command),</p> <p>1,</p> <p>​       to_char(command),</p> <p>'Action Code #' ||to_char(command)) action,</p> <p>p.program oracle_process,</p> <p>s.terminal terminal,</p> <p>s.program program,</p> <p>s.status session_status</p> <p>from v$session s, v$access a,v$process p</p> <p>where s.paddr = p.addr</p> <p>and s.type = 'USER'</p> <p>and a.sid = s.sid</p> <p>and a.object = 'FUNDREAL'</p> <p>orderby s.username,s.osuser;</p> <p>7.20查看catched object</p> <p>SELECT owner,</p> <p>name,</p> <p>db_link,</p> <p>namespace,</p> <p>type,</p> <p>sharable_mem,</p> <p>loads,</p> <p>executions,</p> <p>locks,</p> <p>pins,</p> <p>kept</p> <p>FROM v$db_object_cache whereowner LIKE'HS_%';</p> <p>7.21查看V$SQLAREA</p> <p>SELECT SQL_TEXT,</p> <p>SHARABLE_MEM,</p> <p>PERSISTENT_MEM,</p> <p>RUNTIME_MEM,</p> <p>SORTS,</p> <p>VERSION_COUNT,</p> <p>LOADED_VERSIONS,</p> <p>OPEN_VERSIONS,</p> <p>USERS_OPENING,</p> <p>EXECUTIONS,</p> <p>USERS_EXECUTING,</p> <p>LOADS,</p> <p>FIRST_LOAD_TIME,</p> <p>INVALIDATIONS,</p> <p>PARSE_CALLS,</p> <p>DISK_READS,</p> <p>BUFFER_GETS,</p> <p>ROWS_PROCESSED</p> <p>FROM V$SQLAREA;</p> <p>7.22有关connection的相关信息</p> <p>l查看有哪些用户连接</p> <p>select s.sid,</p> <p>s.serial# serial_num,</p> <p>s.osuser os_user_name,</p> <p>decode(sign(48 - command),</p> <p>1,</p> <p>​       to_char(command),</p> <p>'Action Code #' ||to_char(command)) action,</p> <p>p.program oracle_process,</p> <p>status session_status,</p> <p>s.terminal terminal,</p> <p>s.program program,</p> <p>s.username user_name,</p> <p>s.fixed_table_sequenceactivity_meter</p> <p>from v$session s, v$process p</p> <p>where s.paddr = p.addr</p> <p>and s.type = 'USER'orderbys.username, s.osuser;</p> <p>l2)根据v.sid查看对应连接的资源占用等情况</p> <p>select n.name, v.value, n.class,n.statistic#</p> <p>from v$statname n, v$sesstat v</p> <p>where v.sid = &amp;sid</p> <p>and v.statistic# = n.statistic#</p> <p>orderby n.class,n.statistic#;</p> <p>l3)根据sid查看对应连接正在运行的sql</p> <p>select/*+ PUSH_SUBQ */</p> <p>command_type,</p> <p>sql_text,</p> <p>sharable_mem,</p> <p>persistent_mem,</p> <p>runtime_mem,</p> <p>sorts,</p> <p>version_count,</p> <p>loaded_versions,</p> <p>open_versions,</p> <p>users_opening,</p> <p>executions,</p> <p>users_executing,</p> <p>loads,</p> <p>first_load_time,</p> <p>invalidations,</p> <p>parse_calls,</p> <p>disk_reads,</p> <p>buffer_gets,</p> <p>rows_processed,</p> <p>sysdate start_time,</p> <p>sysdate finish_time,</p> <p>'&gt;' || address sql_address,</p> <p>'N' status</p> <p>from v$sqlarea</p> <p>where address = (selectsql_address from v$session where sid = &amp;sid);</p> <h1 id="_10-参数优化"><a href="#_10-参数优化" class="header-anchor">#</a> 10.参数优化</h1> <h2 id="_10-1-设置内存相关参数"><a href="#_10-1-设置内存相关参数" class="header-anchor">#</a> 10.1 设置内存相关参数</h2> <p>OLTP 比较注重读</p> <p>OLAP 读写都比较集中</p> <p>OLTP数据库：SGA=系统内存*70%<em>80%, PGA=SGA</em>(10%~20%)</p> <p>OLAP数据库：SGA=系统内存*60%<em>80%, PGA=SGA</em>(45%~65%)</p> <p>OLTP SGA的大小设置为不超过物理内存的一半，PGA不超过3GB较为合适</p> <p>设置进程相关参数</p> <p>alter system set processes=500;</p> <p>设置DB_FILES参数</p> <p>默认值为200个，该参数为静态参数，需要重启数据库才能生效，设置过大的db_files参数也容易导致消耗过多的共享池和PGA内存</p> <p>设置BLOCK_SIZE和DB_FILE_MULTIBLOCK_READ_COUNT参数</p> <p>参数DB_BLOCK_SIZE表示Oracle默认的数据块大小，Oracle 11G中默认值为8KB</p> <p>一个典型的数据库参数文件</p> <p>*.processes=500</p> <p>*.job_queue_processes=10</p> <p>*.sga_target=16384M</p> <p>*.db_block_size=8192</p> <p>*.db_files=500</p> <p>*.open_cursors=500</p> <p>*.session_cached_cursors=100</p> <p>*.undo_management='AUTO'</p> <p>*.undo_tablespace= 'undotbs'</p> <p>1、生产数据库一般都有自动循环备份机制,所以,你首先应该问一下他们的备份策略
2、SHOW PARAMETERS SGA； 查看一下sga_max_size,sga_target的大小，一般就是要调这个参数的。
3、如果是windows服务器，可以直接调，如果是linux下，还要调节内核参数，这个你google一下
4、楼上的兄弟说的非常好，一定要备份控制文件和参数文件，否则一旦你调了参数，可能就起不来了，这时候参数文件就是救命的灵丹妙药了。
5、show parameters sga; 建议12G（服务器内存32G下）
show parameters session; 4000
show parameters process; 2000
show parameters open_cursors; 2600
show undo_retention; 7200
6、修改参数alter system set parameter=&quot;values'
7、要搞清楚spfile和pfile的区别，如果是裸设备，嘿嘿，一旦参数调节后，数据库起不来，而spfile是在裸设备上，你就惨了。准备restore,recover数据库吧。
所以，一定要搞到pfile再动手，即使改参数失败了，也可以startup pfile='path/你的pfile'来启动数据库再改回来。
解决前，一定要备份数据库，
或者冷备份，(关机后拷贝 所有的/oradata下文件）
或者热备份（exp/rman)
建议你冷备份加上exp备份比较保险。
修改sga参数的例子如下
把oracle 的线程数增大。
命令:
SQL&gt; alter system set processes=1000 scope=spfile;
调整SGA
SQL&gt; alter system set sga_max_size=10240M scope=spfile;
SQL&gt;alter system set job_queue_processes=15 scope=spfile;
SQL&gt;alter system set cursor_sharing=force;
修改归档空间大小
SQL&gt;alter system set db_recovery_file_dest_size =200G scope=both;
Oracle 服务器参数文件spfile_files 在什么路径下
一般在$ORACLE_HOME/dbs下
可以登录数据库查看:
sqlplus '/as sysdba'
SQL&gt;show parameter spfile
/home/oracle/app/oracle/product/11.2.0/dbhome_1/dbs/spfileorcl.ora
无备份的情况
有PFILE，可以直接恢复
如果当前数据库是以SPFILE启动的，重建SPFILE需要改名：
SQL &gt; Create spfile='/opt/oracle/product/10.2.0/dbs/spfile1.ora' from pfile=’/ opt/oracle/admin/order/scripts/init.ora’;
$ Mv spfile1.ora spfileORCL.ora
否则可以直接新建同名SPFILE：
SQL &gt; Create spfile='/opt/oracle/product/10.2.0/dbs/spfileORCL.ora' from pfile='/ opt/oracle/admin/order/scripts/init.ora';</p> <p>11g的处理方式：
SQL &gt; Create spfile = '<spfile name="">' from memory
数据库shutdown情况下：
SQL &gt; create spfile from pfile;
也可以反过来
SQL &gt; create pfile from spfile; --通常用于修改参数
另附:如果误修改导致数据库无法启动，按以下步骤处理：
(解决SGA_MAX_SIZE 的大小比 MEMORY_TARGET 大导致数据无法启动的错误)
由于数据库无法启动，只能调整编辑启动参数文件：
1,   根据错误的spfile创建pfile;
SQL&gt; create pfile='/tmp/pfile2021.txt' from spfile;
2,   编辑上面生成的pfile将memory_target的值修改成大于SGA_MAX_SIZE
3，备份以前的参数文件
4，恢复参数文件：
SQL&gt; create spfile from pfile='/tmp/pfile2021.txt';
5， 启动数据库：
SQL&gt; startup
OK，到此结束，数据库正常启动。</spfile></p> <p>数据文件管理</p> <p>1、单个数据文件不宜过大。对于自动扩展的数据文件最好设置MAXBYTES属性，一般建议单个数据文件不超过16GB</p> <p>2、对于自动扩展的数据文件，如果BLOCK SIZE为8KB，则数据文件最大不能超过32GB</p> <p>3、不要在业务高峰期添加数据文件。如果添加数据文件的会话挂起，不要随意KILL、Ctrl+C或硬性重启数据库。递归操作不能很好地保持事务原子性</p> <h1 id="_11-oracle性能优化方法论"><a href="#_11-oracle性能优化方法论" class="header-anchor">#</a> 11.oracle性能优化方法论</h1> <h2 id="_11-1-数据库性能优化的目标"><a href="#_11-1-数据库性能优化的目标" class="header-anchor">#</a> 11.1 数据库性能优化的目标</h2> <p>1、sql语句大规模优化，应用架构优化（难度最大，耗时最长）</p> <p>2、数据库并发加大，数据量增多引导起的，增加硬件投入来解决性能问题，优化难度一般</p> <p>3、突发性的数据库性能故障优化。难度最低，但需要快速解决</p> <p>4、事前优化，指的是系统设计、开发、产品优化、平台优化的全过程都很重要。实践经验表明，事前优化对系统的平衡运行有着根本性的影响，而且优化代价也最低。</p> <p>5、事后优化，指的是业务系统上线后的优化。由于事后优化受到宕机时间、代码 版本控制、代码内核不容易更改等因素影响，所以事后优化往往只能缓解系统性能下降的症状，治标不治本。如果爆发出大规模的性能问题，通常都会是灾难性的。</p> <p>一个性能优化项目的目标如下：</p> <p>增大数据库吞吐量。如通过数据库优化增加每秒执行的事务数。</p> <p>高效利用服务器硬件资源。如开启并行充分 利用CPU和存储I/O资源 加快执行速度</p> <h2 id="_11-2-建立数据库性能标准"><a href="#_11-2-建立数据库性能标准" class="header-anchor">#</a> 11.2 建立数据库性能标准</h2> <p>各项指标，包括主机资源和数据库资源的消耗情况。</p> <p>1、技术基线，主要指的是数字指标。通常由（CPU,内存，I/O,网络等）、并发性资源（系统解析数、事务数、归档量等）、TOP SESSION、TOP EVENT、TOP SQL组成</p> <p>2、感官基线，主要指的是人为感觉。比如在前端 单击业务按钮正常的情况下应该在多少时间内返回结果</p> <p>数据库优化的成果可以用两种方式表示：一种是技术成果，通常反映数据库性能统计值 来直观地表示数据库性能的状态；另外一种是用户体验，通常以用户的使用感觉来表示数据库性能状态</p> <h2 id="_11-3-寻找关键变化"><a href="#_11-3-寻找关键变化" class="header-anchor">#</a> 11.3 寻找关键变化</h2> <p>系统性能是什么时候开始变坏的</p> <p>所有业务模块都变坏了，还是局部模块变坏</p> <p>在变坏的时间点之前是否做过特殊的操作</p> <p>业务部门是否开展过什么特殊活动</p> <p>以前是否发生过同类型的性能故障</p> <p>硬件是否出现了故障</p> <h2 id="_11-4-检查操作系统资源"><a href="#_11-4-检查操作系统资源" class="header-anchor">#</a> 11.4 检查操作系统资源</h2> <p>1、查看CPU资源</p> <p>2、查看内存资源</p> <p>3、查看I/O资源</p> <p><strong>Oracle性能优化基本方法包括一下几个步骤，包括：</strong></p> <p>1）设立合理的Oracle性能优化目标。</p> <p>2）测量并记录当前的Oracle性能。</p> <p>3）确定当前Oracle性能瓶颈（Oracle等待什么、哪些SQL语句是该等待事件的成分）。</p> <p>4）把等待事件记入跟踪文件。</p> <p>5）确定当前的OS瓶颈。</p> <p>6）优化所需的成分（应用程序、数据库、I/O、争用、OS等）。</p> <p>7）跟踪并实施更改控制过程。</p> <p>8）测量并记录当前性能</p> <p>9）重复步骤3到7，直到满足优化目标</p> <p>下面来一一详述。</p> <p><strong>1.设立合理的Oracle性能优化目标</strong></p> <p>重点：关于设立目标的最重要的一点是它们必须是可量化和可达到的。</p> <p>方法：目标必须是当前性能和所需性能的的陈述形式的语句。</p> <p><strong>2.测量并记录当前Oracle性能重点：</strong></p> <p>1）需要在峰值活动时间获得当前系统性能快照</p> <p>2）关键是要在出现性能问题的时间段内采集信息</p> <p>3）必须在合理的时间段上采集，一般在峰值期间照几个为期15分钟的快照</p> <p><strong>3.确定当前Oracle性能瓶颈</strong>重点：从Oracle 等待接口v$system_event、v$session_event和v$session_wait中获得等待事件，进而找出影响性能的对象和sql语句。方法如下：</p> <p>1)首先，利用v$system_event视图执行下面的查询查看数据库中某些常见的等待事件：</p> <ol><li><p><strong>select</strong> * <strong>from</strong> v$system_event</p></li> <li><p><strong>where</strong> event in ('buffer busy waits',</p></li> <li><p>'db file sequential read',</p></li> <li><p>'db file scattered read',</p></li> <li><p>'enqueue',</p></li> <li><p>'free buffer waits',</p></li> <li><p>'latch free',</p></li> <li><p>'log file parallel write',</p></li> <li><p>'log file sync');</p></li></ol> <p>2)接着，利用下面对v$session_event和v$session视图进行的查询，研究具有对上面显示的内容有贡献的等待事件的会话：</p> <ol><li><p><strong>select</strong> se.sid,s.username,se.event,se.total_waits,se.time_waited,se.average_wait</p></li> <li><p><strong>from</strong> v$session s,v$session_event se</p></li> <li><p><strong>where</strong> s.sid = se.sid</p></li> <li><p>and se.event not like 'SQL*Net%'</p></li> <li><p>and s.status = 'ACTIVE'</p></li> <li><p>and s.username <strong>is</strong> not null;</p></li></ol> <p>3)使用下面查询找到与所连接的会话有关的当前等待事件。这些信息是动态的，为了查看一个会话的等待最多的事件是什么，需要多次执行此查询。</p> <ol><li><p><strong>select</strong> sw.sid,s.username,sw.event,sw.wait_time,sw.state,sw.seconds_in_wait SEC_IN_WAIT</p></li> <li><p><strong>from</strong> v$session s,v$session_wait sw</p></li> <li><p><strong>where</strong> s.sid = sw.sid</p></li> <li><p>and sw.event not like 'SQL*Net%'</p></li> <li><p>and s.username <strong>is</strong> not null</p></li> <li><p><strong>order</strong> <strong>by</strong> sw.wait_time <strong>desc</strong>;</p></li></ol> <p>4)查询会话等待事件的详细信息</p> <ol><li><p><strong>select</strong> sid,event,p1text,p1,p2text,p2,p3text,p3</p></li> <li><p><strong>from</strong> v$session_wait</p></li> <li><p><strong>where</strong> sid between &amp;1 and &amp;2</p></li> <li><p>and event not like '%SQL%'</p></li> <li><p>and event not like '%rdbms%';</p></li></ol> <p>5)利用P1、P2的信息，找出等待事件的相关的段</p> <ol><li><p><strong>select</strong> owner,segment_name,segment_type,tablespace_name</p></li> <li><p><strong>from</strong> dba_extents</p></li> <li><p><strong>where</strong> file_id = &amp;fileid_in</p></li> <li><p>and &amp;blockid_in between block_id and block_id + blocks - 1;</p></li></ol> <p>6)获得操作该段的sql语句：</p> <ol><li><p><strong>select</strong> sid, getsqltxt(sql_hash_value,sql_address)</p></li> <li><p><strong>from</strong> v$session</p></li> <li><p><strong>where</strong> sid = &amp;sid_in;</p></li></ol> <p>7)getsqltxt函数</p> <p>8)至此已经找到影响性能的对象和sql语句，可以有针对性地优化</p> <p><strong>4.把等待事件记入跟踪文件</strong></p> <p>重点：如果在跟踪系统上的等待事件时，由于某种原因遇到了麻烦，则可以将这些等待事件记入一个跟踪文件。方法如下：</p> <p>1)对于当前会话：</p> <ol><li><p><strong>alter</strong> session <strong>set</strong> timed_statistics=<strong>true</strong>;</p></li> <li><p><strong>alter</strong> session <strong>set</strong> max_dump_file_size=unlimited;</p></li> <li><p><strong>alter</strong> session <strong>set</strong> events '10046 trace name context forever, level 12';</p></li></ol> <p>2)执行应用程序，然后在USER_DUMP_DEST指出的目录中找到跟踪文件。</p> <p>3)查看文件中以词WAIT开始的所有行。</p> <p>4)对于其它的会话</p> <p>5)确定会话的进程ID（SPID）。下面的查询识别出名称以A开始的所有用户的会话进程ID：</p> <ol><li><p><strong>select</strong> S.Username, P.Spid <strong>from</strong> V$SESSION S, V$PROCESS P</p></li> <li><p><strong>where</strong> S.PADDR = P.ADDR and S.Username like 'A%';</p></li></ol> <p>6)以sysdba进入sqlplus执行</p> <ol><li><p><strong>alter</strong> session <strong>set</strong> timed_statistics=<strong>true</strong>;</p></li> <li><p><strong>alter</strong> session <strong>set</strong> max_dump_file_size=unlimited;</p></li> <li><p>oradebug setospid</p></li> <li><p>oradebug unlimit</p></li> <li><p>oradebug event 10046 trace <strong>name</strong> context forever, <strong>level</strong> X /* <strong>Where</strong> X = (1,4,8,12) */</p></li></ol> <p>7)跟踪某个时间间隔得会话应用程序。</p> <p>8)在USER_DUMP_DEST 的值指出的目录中利用SPID查看跟踪文件</p> <p>9)查看文件中以词WAIT开始的所有行。</p> <p><strong>5.确定当前OS瓶颈</strong>1）Windows NT上的监控</p> <p>使用控制面板-〉管理工具-〉性能即可</p> <p>2）UNIX上的监控</p> <p>使用通用性的工具，包括sar、iostat、cpustat、mpstat、netstat、top、osview等。</p> <p><strong>6．Oracle性能优化所需的成分（应用程序、数据库、I/O、争用、OS等）。</strong></p> <p><strong>7．跟踪并实施更改控制过程。</strong></p> <p><strong>8．测量并记录当前Oracle性能</strong></p> <p><strong>9．重复步骤3到7，直到满足优化目标</strong></p> <p>【编辑推荐】</p> <p><a href="http://database.51cto.com/art/201004/193929.htm" target="_blank" rel="noopener noreferrer">简单概述Oracle性能测试<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://database.51cto.com/art/201004/192760.htm" target="_blank" rel="noopener noreferrer">Oracle性能在调整中的要点介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://database.51cto.com/art/200906/132583.htm" target="_blank" rel="noopener noreferrer">使用资源管理器优化Oracle性能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://database.51cto.com/art/200906/126729.htm" target="_blank" rel="noopener noreferrer">Oracle性能优化借助分区技术实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://database.51cto.com/art/200904/121375.htm" target="_blank" rel="noopener noreferrer">浅谈Oracle性能优化可能出现的问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="_12-表空间配置"><a href="#_12-表空间配置" class="header-anchor">#</a> 12.表空间配置</h1> <p>查询表空间</p> <p>select * from dba_tablespaces;</p> <p>查询数据文件</p> <p>select * from dba_data_files</p> <p>oracle查询所有数据文件位置</p> <p>select name from v$datafile;</p> <p>可以查看到控制文件存放位置</p> <p>select name from v$controlfile;</p> <p>查询表空间是否为自增</p> <p>select tablespace_name,file_name,autoextensible from dba_data_files where autoextensible='YES';</p> <p>SELECT T.TABLESPACE_NAME,D.FILE_NAME,</p> <p>D.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS</p> <p>FROM DBA_TABLESPACES T,DBA_DATA_FILES D</p> <p>WHERE T.TABLESPACE_NAME =D.TABLESPACE_NAME</p> <p>ORDER BY TABLESPACE_NAME,FILE_NAME;</p> <p>1、查看表空间的名称及大小</p> <p>select t.tablespace_name, round(sum(bytes/(1024*1024)),0) ts_size</p> <p>from dba_tablespaces t, dba_data_files d</p> <p>where t.tablespace_name = d.tablespace_name</p> <p>group by t.tablespace_name;</p> <p>2、查看表空间物理文件的名称及大小</p> <p>select tablespace_name, file_id, file_name,</p> <p>round(bytes/(1024*1024),0) total_space</p> <p>from dba_data_files</p> <p>order by tablespace_name;</p> <p>3、查看回滚段名称及大小</p> <p>select segment_name, tablespace_name, r.status,</p> <p>(initial_extent/1024) InitialExtent,(next_extent/1024) NextExtent,</p> <p>max_extents, v.curext CurExtent</p> <p>From dba_rollback_segs r, v$rollstat v</p> <p>Where r.segment_id = v.usn(+)</p> <p>order by segment_name ;</p> <p>oracle表空间设置自动扩展</p> <p>开启自动扩展功能语法：</p> <p>alter database datafile '对应的数据文件路径信息' autoextend on;</p> <p>关闭自动扩展功能语法：</p> <p>alter database datafile '对应的数据文件路径信息' autoextend off;</p> <p>数据文件设置</p> <p>--创建表空间,数据文件为'F:\app\zang\oradata\orcl\charge_zang.dbf'，初始大小50M，递增10M，最大递增到2G</p> <p>create tablespace charge_zang datafile 'F:\app\zang\oradata\orcl\charge_zang.dbf'</p> <p>size 50M</p> <p>autoextend on next 10M</p> <p>maxsize 2048M;</p> <p>修改表空间已经存在的数据文件大小</p> <p>ALTER DATABASE DATAFILE 'C:\ORACLE\PRODUCT\10.2.0\ORADATA\ORCL\ex_data' AUTOEXTEND ON NEXT 50M;</p> <p>注：该方法是不修改原来表空间的前提下进行的。</p> <p>放开表空间大小限制</p> <p>ALTER USER YTH_DATA_TBS QUOTA UNLIMITED ON YTH_DATA_TBS;</p> <p>--为表空间增加数据文件</p> <p>alter tablespace JC_DATA</p> <p>add datafile 'F:\app\oracle\oradata\orcl\JC_DATA02.dbf' size 50m</p> <p>autoextend on next 50m maxsize 32767m;</p> <p>注：该命令修改原来的表空间。</p> <p><strong>1.</strong> <strong>2.</strong> <strong>扩大****db_block_size</strong></p> <p>根据oracle的算法，我们很容易想到这个解决方法。数目衡定，但是db_block_size可以更改（db_block_size的最大大小为32KB）。如果把db_block_size扩大到32KB，那么我们的系统就可以支持单个数据文件最大128GB。</p> <p><img src="https://cdn.jsdelivr.net/gh/opersdev/image/i/2022/06/24/62b52d69694ef.png" alt="https://images2018.cnblogs.com/blog/1001990/201808/1001990-20180829211452157-103970196.png"></p> <p>这个方案听起来好像很迷人，但是实际上并不是那么回事。因为要修改db_block_size并不是很容易的事。因为这个db_block_size在创建实例的时候就要指定。而且不能通过简单修改参数来指定db_block_size。db_block_size的默认值为8192 bytes，是不能被用户修改的。因为db_block_size对应于一个实例，所以意味着在数据库创建（建库）以后是不能修改的，如需修改，可行的方式是重新建库并把原库的数据export到新库。当然最好的方式是在建数据库之前就规划好，一般如果是OLTP系统，可以保持默认值；OLAP环境可以考虑适当调大。</p> <p>不幸的是, 不同操作系统不同Oracle版本对其物理文件的最大值限制是不一样的. 如果物理文件超过了某 个限制大小, ORACLE数据库将会出现内核错误并崩溃.</p> <p><strong>2.</strong> <strong>3.</strong> <strong>创建<strong><strong>bigfile</strong></strong>表空间</strong></p> <p>在oracle11g中引进了bigfile表空间，他充分利用了64位CPU的寻址能力，使oracle可以管理的数据文件总量达到8EB。单个数据文件的大小达到128TB，即使默认8K的db_block_size也达到了32TB。</p> <p><img src="https://cdn.jsdelivr.net/gh/opersdev/image/i/2022/06/24/62b52d69a9aa2.png" alt="https://images2018.cnblogs.com/blog/1001990/201808/1001990-20180829212417437-1215130406.png"></p> <p>创建bigfile的表空间使用的sql语句和创建表空间的语句使用基本相同。</p> <p>create bigfile tablespace···</p> <p>需要注意的是使用bigfile表空间，它只能支持一个数据文件。也就是说这个文件的最大大小就是表空间最大大小，你不可能通过增加数据文件来扩大该表空间的大小。</p> <h1 id="_13-数据库的物理备份"><a href="#_13-数据库的物理备份" class="header-anchor">#</a> 13.数据库的物理备份</h1> <p>拒绝备份的理由：数据库太大，没有空间备份等</p> <p>充足的空间是数据库备份的重要前提，但是即使系统空间紧张，至少还是要备份重要的表、业务表结构或者是SYSTEM表空间下的数据文件</p> <p>如果数据库处于关闭状态，那么物理备份数据库和备份普通的文件没有任何区别，即只需要将数据文件、在线日志文件、控制文件物理复制到其他地方即可。</p> <p>正在运行的数据库备份需要考虑一致性的问题，一种是使用操作系统命令备份，另一种是通过RMAN命令备份。使用操作系统命令主要用于数据库的冷备份和手动热备份。</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/613b69/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">postgresql安装</div></a> <a href="/pages/765fc1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">opengauss笔记</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/613b69/" class="prev">postgresql安装</a></span> <span class="next"><a href="/pages/765fc1/">opengauss笔记</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/613b69/"><div>
            postgresql安装
            <!----></div></a> <span class="date">06-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/765fc1/"><div>
            opengauss笔记
            <!----></div></a> <span class="date">06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/82abc5/"><div>
            达梦笔记
            <!----></div></a> <span class="date">06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:48211701@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/opersdev" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://all.xnuo.top" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>kevin | <a href="https://github.com/opersdev" target="_blank">小诺运维</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.38f1b0a4.js" defer></script><script src="/assets/js/2.6beb1dc7.js" defer></script><script src="/assets/js/51.94c41d82.js" defer></script>
  </body>
</html>
